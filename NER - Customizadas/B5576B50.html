<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B5576B50 - Manutenção Tabela Espelho(PIS/COFINS)<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: Manutenção Tabela Espelho(PIS/COFINS) - [AlterarTabelaEspelho]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576B50 - Estrutura de Dados da função B5576B50                       </B><BR>BF cErrorCode [ERRC]<BR>BF mnNotaFiscalNumber [BNNF]<BR>BF szNotaFiscalSeries [BSER]<BR>BF mnNextNumber001 [N001]<BR>BF szDocumentType [DCT]<BR>BF mnDocVoucherInvoiceE [DOC]<BR>BF szEdiDocumentType [EDCT]<BR>BF szItemNumber [ITEM]<BR>BF szCompanyKey [KCO]<BR>BF szCostCenter [MCU]<BR>BF szObjectAccount [OBJ]<BR>BF szSubsidiary [SUB]<BR>BF szAccountId [AID]<BR>BF mnAddressNumber [AN8]<BR>BF szNonTaxAuthorTypes [TN]<BR>BF jdNotaFiscalDate [BRADEJ]<BR>BF szSuffixTransactionNature [BSOP]<BR>BF mnAmountNotaFiscalTotals [BVTN]<BR>BF szAlphaSpecData04 [AA04]<BR>BF szDescricaoLinha1 [DSC1]<BR>BF szDescricaoLinha2 [DSC2]<BR>BF szStatus [TRTY]<BR>BF szUserId [USER]<BR>BF szProgramId [PID]<BR>BF szWorkStationId [JOBN]<BR>BF jdDateUpdated [UPMJ]<BR>BF mnTimeLastUpdated [UPMT]<BR>BF szCodeTransactionNature [BRNOP]<BR>BF cEverestEventPoint01 [EV01]<BR>BF cInverteValoresPisCofins [EV01]<BR>BF mnTaxaPis [BPCT]<BR>BF mnTaxaCofins [BPCT]<BR>BF mnFiscalYear1 [FY]<BR>BF mnPeriodNoGeneralLedge [PN]<BR>BF cBloco [EV01]<BR>BF cDebitoCredito [EV01]<BR>BF szDescricaoLinha3 [DSC3]<BR></div><pre><div class='dstrmembers'><B>Header File: b5576b50.h</B><BR></div><br/>/*****************************************************************************<br/> *    Header File:  B5576B50.h<br/> *<br/> *    Description:  Manutenção Tabela Espelho(PIS/COFINS) Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 29/12/10                Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/><br/>#ifndef __B5576B50_H<br/>#define __B5576B50_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf5576b50.h&gt<br/>#include &ltf5576b01.h&gt<br/>#include &ltf5576b11.h&gt<br/>#include &ltf5504pt0.h&gt<br/>#include &ltf76b200.h&gt<br/>#include &ltf5504rr0.h&gt<br/>#include &ltf570117.h&gt<br/>#include &ltf570116.h&gt<br/>#include &ltf570112.h&gt<br/>#include &ltf0005.h&gt<br/>#include &ltf0901.h&gt<br/>#include &ltf5576b40.h&gt<br/>#include &ltf5504rr0.h&gt<br/>#include &ltf5504rr5.h&gt<br/>#include &ltf5504pt3.h&gt<br/>/*****************************************************************************<br/> * External Business Function Header Inclusions<br/> ****************************************************************************/<br/>#include &ltn5500001.h&gt<br/>#include &ltb9800100.h&gt<br/>#include &ltx00022.h&gt<br/>#include &ltn5576epc.h&gt<br/>/*****************************************************************************<br/> * Global Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: Estrutura de Dados da função B5576B50<br/> *    Template ID:   D5576B50<br/> *    Generated:     Wed Mar 16 14:09:17 2011<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D5576B50<br/>#define DATASTRUCTURE_D5576B50<br/><br/>typedef struct tagDSD5576B50<br/>{<br/>  JCHAR              cErrorCode;                          <br/>  MATH_NUMERIC      mnNotaFiscalNumber;                  <br/>  JCHAR              szNotaFiscalSeries[3];               <br/>  MATH_NUMERIC      mnNextNumber001;                     <br/>  JCHAR              szDocumentType[3];                   <br/>  MATH_NUMERIC      mnDocVoucherInvoiceE;                <br/>  JCHAR              szEdiDocumentType[3];                <br/>  JCHAR              szItemNumber[7];                     <br/>  JCHAR              szCompanyKey[6];                     <br/>  JCHAR              szCostCenter[13];                    <br/>  JCHAR              szObjectAccount[7];                  <br/>  JCHAR              szSubsidiary[9];                     <br/>  JCHAR              szAccountId[9];                      <br/>  MATH_NUMERIC      mnAddressNumber;                     <br/>  JCHAR              szNonTaxAuthorTypes[11];             <br/>  JDEDATE           jdNotaFiscalDate;                    <br/>  JCHAR              szSuffixTransactionNature[3];        <br/>  MATH_NUMERIC      mnAmountNotaFiscalTotals;            <br/>  JCHAR              szAlphaSpecData04[5];                <br/>  JCHAR              szDescricaoLinha1[31];               <br/>  JCHAR              szDescricaoLinha2[31];               <br/>  JCHAR              szStatus[4];                         <br/>  JCHAR              szUserId[11];                        <br/>  JCHAR              szProgramId[11];                     <br/>  JCHAR              szWorkStationId[11];                 <br/>  JDEDATE           jdDateUpdated;                       <br/>  MATH_NUMERIC      mnTimeLastUpdated;                   <br/>  JCHAR              szCodeTransactionNature[6];          <br/>  JCHAR              cEverestEventPoint01;                <br/>  JCHAR              cInverteValoresPisCofins;            <br/>  MATH_NUMERIC      mnTaxaPis;                           <br/>  MATH_NUMERIC      mnTaxaCofins;                        <br/>  MATH_NUMERIC      mnFiscalYear1;                       <br/>  MATH_NUMERIC      mnPeriodNoGeneralLedge;              <br/>  JCHAR              cBloco;                              <br/>  JCHAR              cDebitoCredito;                      <br/>  JCHAR              szDescricaoLinha3[31];               <br/>} DSD5576B50, *LPDSD5576B50;<br/><br/>#define IDERRcErrorCode_1                         1L<br/>#define IDERRmnNotaFiscalNumber_3                 3L<br/>#define IDERRszNotaFiscalSeries_4                 4L<br/>#define IDERRmnNextNumber001_5                    5L<br/>#define IDERRszDocumentType_6                     6L<br/>#define IDERRmnDocVoucherInvoiceE_7               7L<br/>#define IDERRszEdiDocumentType_8                  8L<br/>#define IDERRszItemNumber_9                       9L<br/>#define IDERRszCompanyKey_10                      10L<br/>#define IDERRszCostCenter_11                      11L<br/>#define IDERRszObjectAccount_12                   12L<br/>#define IDERRszSubsidiary_13                      13L<br/>#define IDERRszAccountId_14                       14L<br/>#define IDERRmnAddressNumber_15                   15L<br/>#define IDERRszNonTaxAuthorTypes_16               16L<br/>#define IDERRjdNotaFiscalDate_17                  17L<br/>#define IDERRszSuffixTransactionNature_19         19L<br/>#define IDERRmnAmountNotaFiscalTotals_20          20L<br/>#define IDERRszAlphaSpecData04_21                 21L<br/>#define IDERRszDescricaoLinha1_22                 22L<br/>#define IDERRszDescricaoLinha2_23                 23L<br/>#define IDERRszStatus_24                          24L<br/>#define IDERRszUserId_25                          25L<br/>#define IDERRszProgramId_26                       26L<br/>#define IDERRszWorkStationId_27                   27L<br/>#define IDERRjdDateUpdated_28                     28L<br/>#define IDERRmnTimeLastUpdated_29                 29L<br/>#define IDERRszCodeTransactionNature_30           30L<br/>#define IDERRcEverestEventPoint01_31              31L<br/>#define IDERRcInverteValoresPisCofins_32          32L<br/>#define IDERRmnTaxaPis_33                         33L<br/>#define IDERRmnTaxaCofins_34                      34L<br/>#define IDERRmnFiscalYear1_35                     35L<br/>#define IDERRmnPeriodNoGeneralLedge_36            36L<br/>#define IDERRcBloco_37                            37L<br/>#define IDERRcDebitoCredito_38                    38L<br/>#define IDERRszDescricaoLinha3_39                 39L<br/><br/>#endif<br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI AlterarTabelaEspelho             (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI DeletarTabelaEspelho             (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI IncluirTabelaEspelho             (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS);<br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/>ID     I5576B50_IncluiLinhasImpostos(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro);<br/>double I5576B50_RetornaAliquota(HUSER hUser, JCHAR *Taxa);<br/>void   I5576B50_TipoOperacao(HUSER hUser, JCHAR *SY, JCHAR *RT, JCHAR *KY, JCHAR *TipoOperacao);<br/>void   I5576B50_RemoveSurroundingBlanks(JCHAR * szString);<br/>void   I5576B50_strpadl (JCHAR *lpszString, const JCHAR *szPad, size_t nLen);<br/>void   I5576B50_strpadr (JCHAR *lpszString, const JCHAR *szPad, size_t nLen);<br/>void   I5576B50_BuscaCodigoTransacao(HUSER hUser, JCHAR *BNOP, JCHAR *bsop, JCHAR *fco, JCHAR *CodigoTransacao);<br/>BOOL   I5576B50_Comulativo(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros, JCHAR *KY, JCHAR *CO);<br/>void   I5576B50_PopulaF5576B01(LPDSD5576B50 Parametros, F5576B01 *RegistroF5576B01, double ValorBase, double ValorImposto, JCHAR *Imposto);<br/>void   I5576B50_PopulaF5576B11(LPDSD5576B50 Parametros, F5576B11 *RegistroF5576B11, double ValorBase, double ValorImposto, double TaxaImposto, JCHAR *Imposto, JCHAR *Tipo);<br/>ID     I5576B50_DeletarLinhasImpostos(HUSER hUser, F5576B50 Registro);<br/>void   I5576B50_PopulaF5576B50(LPDSD5576B50 Parametros, F5576B50 *RegistroF5576B50);<br/>ID     I5576B50_AlterarLinhasImpostos(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros);<br/>void   I5576B50_PopulaAuditoria(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro);<br/>void   I5576B50_GeraTXT(HUSER hUser, LPDSD5576B50 Registro, JCHAR *NomeArquivo);<br/>void   I5576B50_GravaLog(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro, JCHAR *Tabela, JCHAR Operacao);<br/>BOOL   I5576B50_ValidaNota(LPDSD5576B50 Parametros);<br/>void   I5576B50_BuscaIdConta(HUSER hUser, JCHAR *MCU, JCHAR *OBJ, JCHAR *SUB, JCHAR *IdConta);<br/>void   I5576B50_BuscaAliquotaPisCofins(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros, double *TaxaPis, double *TaxaCofins, JCHAR *TipoOperacao);<br/>void   I5576B50_BuscaProximoNumero(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, MATH_NUMERIC *ProximoNumero);<br/>void   I5576B50_BuscaNaturezaOperacao(HUSER hUser, MATH_NUMERIC mnDOC, JCHAR *szEDCT, JCHAR *szFCO, JCHAR *CFOP);<br/>void   I5576B50_BuscaNaturezaOperacaoSetupPisCofins(HUSER hUser, JCHAR *szEDCT, JCHAR *szFCO, JCHAR *CFOP);<br/>BOOL   I5576B50_SetaSelecao(LPDSD5576B50 lpDS, SELECTSTRUCT *Selecao);<br/>short  I5576B50_PegaNumChaves(LPDSD5576B50 lpDS);<br/>BOOL   I5576B50_VerificaCentroCusto(HUSER hUser, LPDSD5576B50 lpDS, double *TaxaPis, double *TaxaCofins);<br/>BOOL   I5576B50_VerificaCia(HUSER hUser, JCHAR *szCO, JCHAR *szOBJ, JCHAR *szSUB, double *TaxaPis, double *TaxaCofins);<br/>BOOL   I5576B50_VerificaCiaSetupExclusao(HUSER hUser, JCHAR *szCO, JCHAR *Imposto);<br/>BOOL   I5576B50_VerificaPessoaJuridica(HUSER hUser, MATH_NUMERIC Pessoa);<br/>BOOL   I5575B50_SetupInformacoesAdicionais(HUSER hUser, JCHAR *szCO, JCHAR *szMCU, JCHAR *szOBJ, JCHAR *szSUB, F5504PT3 *Registro);<br/>#endif    /* __B5576B50_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b5576b50.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b5576b50_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b5576b50<br/> *<br/> *    Description:  Manutenção Tabela Espelho(PIS/COFINS) Source File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 29/12/10                Unknown  - Created  <br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb5576b50.h&gt<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  AlterarTabelaEspelho<br/> *<br/> *        Description:  Alterar Tabela Espelho<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD5576B50        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI AlterarTabelaEspelho (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HREQUEST                     hF5576B50                 = (HREQUEST)NULL;   <br/>	KEY1_F5576B50				 ChaveF5576B50			   = {0};<br/>	F5576B50                     RegistroF5576B50          = {0};<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>        (lpVoid    == (LPVOID)    NULL) ||<br/>        (lpDS      == (LPDSD5576B50)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/>    <br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_MANUAL);<br/>    <br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>    <br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B50, 0, NULL, 0, NULL, &hF5576B50);<br/>	if (idJDEDBReturn) <br/>	{<br/>		<br/>		I5576B50_PopulaAuditoria(hUser, lpBhvrCom, lpVoid, lpDS);<br/>		<br/>		MathCopy(&ChaveF5576B50.thbnnf, &lpDS-&gtmnNotaFiscalNumber);<br/>		jdeStrncpyTerminate(ChaveF5576B50.thbser, lpDS-&gtszNotaFiscalSeries, DIM(lpDS-&gtszNotaFiscalSeries));		<br/>		MathCopy(&ChaveF5576B50.thn001, &lpDS-&gtmnNextNumber001);<br/>		jdeStrncpyTerminate(ChaveF5576B50.thdct, lpDS-&gtszDocumentType, DIM(lpDS-&gtszDocumentType));<br/>		<br/>		I5576B50_PopulaF5576B50(lpDS, &RegistroF5576B50);<br/>		idJDEDBReturn = JDB_UpdateTable(hF5576B50, NID_F5576B50, (ID) 0, ID_F5576B50_PK, &ChaveF5576B50, 4, &RegistroF5576B50);<br/>		if (idJDEDBReturn) <br/>		{<br/>			<br/>			if (I5576B50_ValidaNota(lpDS)) {<br/>				<br/>				idJDEDBReturn = I5576B50_AlterarLinhasImpostos(hUser, lpBhvrCom, lpVoid, lpDS);<br/>				if (!idJDEDBReturn) <br/>				{<br/>					<br/>					JDB_RollbackUser(hUser);<br/>					return (ER_ERROR);<br/>					<br/>				}<br/>				<br/>			}<br/>			<br/>		} else {<br/>			<br/>			JDB_RollbackUser(hUser);<br/>			return (ER_ERROR);<br/>			<br/>		}<br/>				<br/>	} else {<br/>		<br/>	    JDB_RollbackUser(hUser);<br/>		return (ER_ERROR);<br/>		<br/>	}<br/>	<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	JDB_CommitUser(hUser);<br/>	if (hUser)<br/>	{<br/>		JDB_FreeBhvr(hUser);<br/>	}<br/>    return (ER_SUCCESS);<br/>}<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  DeletarTabelaEspelho<br/> *<br/> *        Description:  Deletar da Tabela Espeho<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD5576B50        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI DeletarTabelaEspelho (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HREQUEST                     hF5576B50                 = (HREQUEST)NULL;   <br/>	KEY1_F5576B50				 ChaveF5576B50			   = {0};<br/>	SELECTSTRUCT                 *SelecaoF5576B50          = (SELECTSTRUCT *)NULL;<br/>	F5576B50                     RegistroF5576B50          = {0};<br/>	short                        NumChaves                 =  0 ;<br/>    <br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL)  ||<br/>       (lpDS      == (LPDSD5576B50)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/>    <br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_MANUAL);<br/>    <br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>    <br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B50, 0, NULL, 0, NULL, &hF5576B50);<br/>	if (idJDEDBReturn) <br/>	{<br/>		<br/>		NumChaves = I5576B50_PegaNumChaves(lpDS);<br/>		SelecaoF5576B50 = jdeAlloc(COMMON_POOL, NumChaves * sizeof (SELECTSTRUCT), MEM_ZEROINIT); <br/>		I5576B50_SetaSelecao(lpDS, SelecaoF5576B50);<br/>		<br/>		JDB_ClearSelection(hF5576B50);<br/>		idJDEDBReturn = JDB_SetSelection(hF5576B50, SelecaoF5576B50, NumChaves, JDEDB_SET_REPLACE);<br/>		<br/>		if (idJDEDBReturn == JDEDB_PASSED) <br/>		{<br/>			<br/>			idJDEDBReturn = JDB_SelectKeyed(hF5576B50,0, NULL, 0);<br/>			<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				while (JDB_Fetch( hF5576B50, &RegistroF5576B50, 0 ) == JDEDB_PASSED)<br/>				{<br/>					MathCopy(&ChaveF5576B50.thbnnf, &RegistroF5576B50.thbnnf);<br/>					jdeStrncpyTerminate(ChaveF5576B50.thbser, RegistroF5576B50.thbser, DIM(RegistroF5576B50.thbser));		<br/>					MathCopy(&ChaveF5576B50.thn001, &RegistroF5576B50.thn001);<br/>					jdeStrncpyTerminate(ChaveF5576B50.thdct, RegistroF5576B50.thdct, DIM(RegistroF5576B50.thdct));<br/>					<br/>					idJDEDBReturn = JDB_DeleteTable(hF5576B50, NID_F5576B50, ID_F5576B50_PK, (ID)NULL, &ChaveF5576B50, 4);<br/>					if (idJDEDBReturn == JDEDB_PASSED) <br/>					{<br/>						<br/>						/*deleta F5576B01/F5576B11	*/<br/>						idJDEDBReturn = I5576B50_DeletarLinhasImpostos(hUser, RegistroF5576B50);<br/>						if (idJDEDBReturn != JDEDB_PASSED) <br/>						{<br/>							<br/>							JDB_CloseTable(hF5576B50);<br/>							JDB_RollbackUser(hUser);<br/>							if (hUser) <br/>							{<br/>								JDB_FreeBhvr(hUser);<br/>							}<br/>							return (ER_ERROR);<br/>							<br/>						}<br/>						<br/>					}<br/>					<br/>				}<br/>				<br/>			} else {<br/>				<br/>				JDB_CloseTable(hF5576B50);<br/>				JDB_RollbackUser(hUser);		<br/>				if (hUser) <br/>				{<br/>					JDB_FreeBhvr(hUser);<br/>				}<br/>				return ER_ERROR;<br/>				<br/>			}<br/>		} else {<br/>			<br/>			JDB_CloseTable(hF5576B50);<br/>			JDB_RollbackUser(hUser);		<br/>			if (hUser) <br/>			{<br/>				JDB_FreeBhvr(hUser);<br/>			}<br/>			return (ER_ERROR);<br/>			<br/>		}<br/>		   <br/>	} else {<br/>		<br/>		JDB_CloseTable(hF5576B50);<br/>		JDB_RollbackUser(hUser);		<br/>		if (hUser) <br/>		{<br/>			JDB_FreeBhvr(hUser);<br/>		}<br/>		return (ER_ERROR);<br/>		<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	JDB_CloseTable(hF5576B50);<br/>	JDB_CommitUser(hUser);<br/>    if (hUser) <br/>	{<br/>		JDB_FreeBhvr(hUser);<br/>	}<br/>    return (ER_SUCCESS);<br/>}<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  IncluirTabelaEspelho<br/> *<br/> *        Description:  Inlcluir na Tabela Espelho<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD5576B50        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI IncluirTabelaEspelho (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HREQUEST                     hF5576B50                 = (HREQUEST)NULL;<br/>    ID                           idJDEDBReturn             = ER_SUCCESS;<br/>	F5576B50                     RegistroF5576B50          = {0};<br/>	F5504PT3                     RegistroF5504PT3          = {0};<br/>	KEY1_F5576B50				 ChaveF5576B50			   = {0};<br/>	<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>        (lpVoid    == (LPVOID)    NULL) ||<br/>        (lpDS      == (LPDSD5576B50)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/>    <br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_MANUAL);<br/>    <br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>    <br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	/*Verifica se ja existe o registro na F5576B50*/<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B50, 0, NULL, 0, NULL, &hF5576B50);<br/>	if (idJDEDBReturn) {<br/>		<br/>		I5576B50_PopulaAuditoria(hUser, lpBhvrCom, lpVoid, lpDS);<br/>		MathCopy(&ChaveF5576B50.thbnnf, &lpDS-&gtmnNotaFiscalNumber);<br/>		jdeStrncpyTerminate(ChaveF5576B50.thbser, lpDS-&gtszNotaFiscalSeries, DIM(lpDS-&gtszNotaFiscalSeries));		<br/>		jdeStrncpyTerminate(ChaveF5576B50.thdct, lpDS-&gtszDocumentType, DIM(lpDS-&gtszDocumentType));<br/>		<br/>		if (!I5576B50_ValidaNota(lpDS)) <br/>		{<br/>			<br/>			I5576B50_BuscaProximoNumero(hUser, lpBhvrCom, lpVoid, &lpDS-&gtmnNextNumber001);<br/>			if (MathZeroTest(&lpDS-&gtmnNextNumber001) == 0)<br/>			{<br/>				<br/>				lpDS-&gtcErrorCode = _J('S');<br/>				JDB_CloseTable(hF5576B50);<br/>				JDB_RollbackUser(hUser);<br/>				JDB_FreeBhvr(hUser);<br/>				return (ER_ERROR);<br/>				<br/>			}<br/>			<br/>		}<br/>		/*atualiza a chave depois do teste de next number*/<br/>		MathCopy(&ChaveF5576B50.thn001, &lpDS-&gtmnNextNumber001);<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5576B50,ID_F5576B50_PK, &ChaveF5576B50, 4, &RegistroF5576B50, FALSE);<br/>		if (idJDEDBReturn != JDEDB_PASSED) <br/>		{			<br/>			/*Não existe, inclui*/<br/>			I5576B50_PopulaF5576B50(lpDS, &RegistroF5576B50);			<br/>			/*Verifica se conta no setup de unformações adicionais*/<br/>			I5575B50_SetupInformacoesAdicionais(hUser, RegistroF5576B50.thkco, RegistroF5576B50.thmcu, RegistroF5576B50.thobj, RegistroF5576B50.thsub, &RegistroF5504PT3);<br/>			<br/>			jdeStrcpy(&RegistroF5576B50.thev01, &RegistroF5504PT3.iaev01);<br/>			<br/>			idJDEDBReturn = JDB_InsertTable(hF5576B50, _J("F5576B50"), (ID)0, (void *)&RegistroF5576B50);<br/>			if (idJDEDBReturn == JDEDB_PASSED) {<br/>				/*segue o baile e inclui as tabelas de impostos*/<br/>				idJDEDBReturn = I5576B50_IncluiLinhasImpostos(hUser, lpBhvrCom, lpVoid, lpDS);<br/>				<br/>				if (idJDEDBReturn != JDEDB_PASSED) <br/>				{<br/>					<br/>					lpDS-&gtcErrorCode = _J('I'); /*Erro ao incluir "I"mpostos*/<br/>					JDB_CloseTable(hF5576B50);<br/>					JDB_RollbackUser(hUser);<br/>					JDB_FreeBhvr(hUser);<br/>					return (ER_ERROR);<br/>					<br/>				} else {<br/>					/*Atualiza as informações faltantes na tabela espelho*/<br/>					I5576B50_PopulaF5576B50(lpDS, &RegistroF5576B50);<br/>					idJDEDBReturn = JDB_UpdateTable(hF5576B50, _J("F5576B50"), (ID) 0, ID_F5576B50_PK, (void *) &ChaveF5576B50, 4,<br/>									(void *) &RegistroF5576B50);<br/>					<br/>				}<br/>				<br/>			} else {<br/>				/*da erro e cai fora*/<br/>				lpDS-&gtcErrorCode = _J('E'); /*Erro na Inserção da tabela "E"spelho*/<br/>				JDB_CloseTable(hF5576B50);<br/>				JDB_RollbackUser(hUser);<br/>				JDB_FreeBhvr(hUser);<br/>				return (ER_ERROR);<br/>			}<br/>		} else {<br/>			/*ja existe, da erro e cai fora*/<br/>			lpDS-&gtcErrorCode = _J('D'); /*Erro de "D"uplicidade na tabela espelho*/<br/>			JDB_CloseTable(hF5576B50);<br/>			JDB_RollbackUser(hUser);<br/>			JDB_FreeBhvr(hUser);<br/>			return (ER_ERROR);<br/>		}<br/>		<br/>	} else {<br/>		/*Não conseguiu abrir a tabela, da erro e cai fora*/<br/>		lpDS-&gtcErrorCode = _J('O'); /*Erro de "O"pen na tabela espelho*/<br/>		JDB_RollbackUser(hUser);<br/>		JDB_FreeBhvr(hUser);<br/>		return (ER_ERROR);<br/>	}<br/>    	<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	JDB_CloseTable(hF5576B50);<br/>	JDB_CommitUser(hUser);<br/>	/*Grava LOG*/<br/>	/*I5576B50_GravaLog(hUser, lpBhvrCom, lpVoid, lpDS, (char *)"F5576B50", 'I');*/<br/>    if (hUser) {<br/>		JDB_FreeBhvr(hUser);<br/>	}<br/>	lpDS-&gtcErrorCode = _J('N');<br/>    return (ER_SUCCESS);<br/>}<br/><br/>/* Funcoes Internas */<br/>/**************************************************************************<br/> *   Function:  I5576B50_AlterarLinhasImpostos<br/> **************************************************************************/<br/>ID I5576B50_AlterarLinhasImpostos(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros)<br/>{<br/>  /********************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  F5576B50        RegistroF5576B50  = {0};<br/>  /********************************************************************************************************************/<br/>  I5576B50_PopulaF5576B50(Parametros, &RegistroF5576B50);<br/>  idJDEDBReturn = I5576B50_DeletarLinhasImpostos(hUser, RegistroF5576B50);<br/>  if (idJDEDBReturn)<br/>  {<br/>	  <br/>	  idJDEDBReturn = I5576B50_IncluiLinhasImpostos(hUser, lpBhvrCom, lpVoid, Parametros);<br/>	  if (idJDEDBReturn)<br/>	  {<br/>		  <br/>		  return (JDEDB_PASSED);<br/>		  <br/>	  } else {<br/>		  <br/>		  return (JDEDB_FAILED);<br/>		  <br/>	  }<br/>	  <br/>  } else {<br/>	  <br/>	  return (JDEDB_FAILED);<br/>	  <br/>  }<br/><br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_DeletarLinhasImpostos<br/> **************************************************************************/<br/>ID I5576B50_DeletarLinhasImpostos(HUSER hUser, F5576B50 Registro)<br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  HREQUEST        hF5576B01         = (HREQUEST)NULL;<br/>  HREQUEST        hF5576B11         = (HREQUEST)NULL;<br/>  KEY1_F5576B01   ChaveF5576B01     = {0};<br/>  KEY1_F5576B11   ChaveF5576B11     = {0};<br/>  /*******************************************************************************************************************/<br/>  idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B01, 0, NULL, 0, NULL, &hF5576B01);<br/>  if (idJDEDBReturn == JDEDB_PASSED) <br/>  {<br/>	  <br/>	  MathCopy(&ChaveF5576B01.thbnnf , &Registro.thbnnf);<br/>	  jdeStrncpyTerminate(ChaveF5576B01.thbser,  Registro.thbser, DIM(ChaveF5576B01.thbser));<br/>	  MathCopy(&ChaveF5576B01.thn001,  &Registro.thn001);<br/>	  jdeStrncpyTerminate(ChaveF5576B01.thdct,   Registro.thdct ,DIM(ChaveF5576B01.thdct));<br/>	  idJDEDBReturn = JDB_DeleteTable(hF5576B01, NID_F5576B01, ID_F5576B01_NOTA_FISCAL_NUMBER, (ID)NULL, &ChaveF5576B01, 4);<br/>	  if (idJDEDBReturn == JDEDB_PASSED) <br/>	  {<br/>		  <br/>		  idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B11, 0, NULL, 0, NULL, &hF5576B11);<br/>		  if (idJDEDBReturn == JDEDB_PASSED) <br/>		  {<br/>			  <br/>			  MathCopy(&ChaveF5576B11.tdbnnf , &Registro.thbnnf);<br/>			  jdeStrncpyTerminate(ChaveF5576B11.tdbser, Registro.thbser, DIM(ChaveF5576B11.tdbser));<br/>			  MathCopy(&ChaveF5576B11.tdn001, &Registro.thn001);<br/>			  jdeStrncpyTerminate(ChaveF5576B11.tddct, Registro.thdct ,DIM(ChaveF5576B11.tddct));<br/>			  idJDEDBReturn = JDB_DeleteTable(hF5576B11, NID_F5576B11, ID_F5576B11_NOTA_FISCAL_NUMBER, (ID)NULL, &ChaveF5576B11, 4);<br/>			  if (idJDEDBReturn == JDEDB_PASSED) <br/>			  {				  <br/>				  <br/>				  JDB_CloseTable(hF5576B01);<br/>				  JDB_CloseTable(hF5576B11);<br/>				  return (JDEDB_PASSED);<br/>				  <br/>			  } else {<br/>				  <br/>				  JDB_CloseTable(hF5576B01);<br/>				  JDB_CloseTable(hF5576B11);<br/>				  return (JDEDB_FAILED);<br/>				  <br/>			  }<br/>			  	<br/>		  } else {<br/>			  <br/>			  JDB_CloseTable(hF5576B01);<br/>			  JDB_CloseTable(hF5576B11);<br/>			  return (JDEDB_FAILED);<br/>			  <br/>		  }<br/>		  <br/>	  } else {<br/>		  <br/>		  JDB_CloseTable(hF5576B01);<br/>		  JDB_CloseTable(hF5576B11);<br/>		  return (JDEDB_FAILED);<br/>		  <br/>	  }<br/>	  <br/>  } else {<br/>	  <br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>	  <br/>  }<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_IncluiLinhasImpostos<br/> **************************************************************************/<br/>ID I5576B50_IncluiLinhasImpostos(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro) <br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  HREQUEST        hF5576B01         = (HREQUEST)NULL;<br/>  HREQUEST        hF5576B11         = (HREQUEST)NULL;<br/>  F5576B01        RegistroF5576B01  = {0};<br/>  F5576B11        RegistroF5576B11  = {0};<br/>  double          dAliquotaPIS     = 0;<br/>  double          dAliquotaCOFINS  = 0;<br/>  double          dValorPis        = 0;<br/>  double          dValorCofins     = 0;<br/>  double          dValorBase       = 0;<br/>  JCHAR            TipoOperacao[3] = {0};<br/>  JCHAR            RT[10];<br/>  JCHAR            CodigoTransacao[5];<br/>  JCHAR            CodigoSufixoTransacao[10];<br/>  <br/>  /*******************************************************************************************************************/<br/>  idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B01, 0, NULL, 0, NULL, &hF5576B01);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  <br/>	  return (JDEDB_FAILED);<br/>	  <br/>  }	 <br/>  idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B11, 0, NULL, 0, NULL, &hF5576B11);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  <br/>	  return (JDEDB_FAILED);<br/>	  <br/>  }	 <br/>  <br/>  if (Registro-&gtcInverteValoresPisCofins == _J('S')) <br/>  {<br/>	  <br/>	  dValorBase = (MathNumericToDouble(&Registro-&gtmnAmountNotaFiscalTotals) * -1);	  <br/>	  <br/>  } else {<br/>	  <br/>	  dValorBase = MathNumericToDouble(&Registro-&gtmnAmountNotaFiscalTotals);<br/>	  <br/>  }<br/>  <br/>  if (jdeIsBlankOrNull(Registro-&gtszCodeTransactionNature))<br/>  {<br/>	  if (MathZeroTest(&Registro-&gtmnDocVoucherInvoiceE) != 0 && !jdeIsBlankOrNull(Registro-&gtszEdiDocumentType))<br/>	  {<br/>		  <br/>		  /*if (jdestrcmp((char *)(Registro-&gtszEdiDocumentType),(char *)("RI"))==0){<br/>			  */<br/>			  /*I5576B50_BuscaNaturezaOperacaoSetupPisCofins(hUser, Registro-&gtszEdiDocumentType, Registro-&gtszCompanyKey, Registro-&gtszCodeTransactionNature);*/<br/>	<br/>		  /*} else {*/<br/>			  <br/>			  I5576B50_BuscaNaturezaOperacao(hUser, Registro-&gtmnDocVoucherInvoiceE, Registro-&gtszEdiDocumentType, Registro-&gtszCompanyKey, Registro-&gtszCodeTransactionNature);<br/>			  <br/>		  /*}*/<br/>		  <br/>		  I5576B50_RemoveSurroundingBlanks(Registro-&gtszCodeTransactionNature);<br/>		  <br/>		  if (!jdeIsBlankOrNull(Registro-&gtszCodeTransactionNature))<br/>		  {<br/>			  <br/>			  I5576B50_BuscaAliquotaPisCofins(hUser, lpBhvrCom, lpVoid, Registro, &dAliquotaPIS, &dAliquotaCOFINS, (JCHAR *)&TipoOperacao);<br/>			  <br/>		  } else {<br/>			  <br/>			  if (!I5576B50_VerificaCentroCusto(hUser, Registro, &dAliquotaPIS, &dAliquotaCOFINS))<br/>			  {<br/>				  <br/>				  if (!I5576B50_VerificaCia(hUser, Registro-&gtszCompanyKey, Registro-&gtszObjectAccount, Registro-&gtszSubsidiary, &dAliquotaPIS, &dAliquotaCOFINS))<br/>				  {<br/>					  idJDEDBReturn = I5576B50_VerificaCia(hUser, (JCHAR *)_J("00999"), Registro-&gtszObjectAccount, Registro-&gtszSubsidiary, &dAliquotaPIS, &dAliquotaCOFINS);<br/>					  if (idJDEDBReturn != JDEDB_PASSED)<br/>					  {<br/>						  JDB_CloseTable(hF5576B01);<br/>						  JDB_CloseTable(hF5576B11);<br/>						  return (JDEDB_FAILED);<br/>					  }<br/>					 <br/>				  }<br/>				 <br/>			  }<br/>			 <br/>		  }<br/>		 <br/>	  } else {<br/>		  <br/>		  if (!I5576B50_VerificaCentroCusto(hUser, Registro, &dAliquotaPIS, &dAliquotaCOFINS))<br/>		  {<br/>			  <br/>			  if (!I5576B50_VerificaCia(hUser, Registro-&gtszCompanyKey, Registro-&gtszObjectAccount, Registro-&gtszSubsidiary, &dAliquotaPIS, &dAliquotaCOFINS))<br/>			  {<br/>				  idJDEDBReturn = I5576B50_VerificaCia(hUser, (JCHAR *)_J("00999"), Registro-&gtszObjectAccount, Registro-&gtszSubsidiary, &dAliquotaPIS, &dAliquotaCOFINS);<br/>				  if (idJDEDBReturn != JDEDB_PASSED)<br/>				  {<br/>					  JDB_CloseTable(hF5576B01);<br/>					  JDB_CloseTable(hF5576B11);<br/>					  return (JDEDB_FAILED);<br/>				  }<br/>				 <br/>			  }<br/>			 <br/>		  }<br/>		 	  <br/>	  }<br/>  } else {<br/>	  <br/>	  I5576B50_BuscaAliquotaPisCofins(hUser, lpBhvrCom, lpVoid, Registro, &dAliquotaPIS, &dAliquotaCOFINS, (JCHAR *)&TipoOperacao);<br/>	  <br/>  }<br/>  <br/>  if (dAliquotaPIS == 0 && dAliquotaCOFINS == 0) <br/>  {<br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>  }<br/>  /*Calcula Valor do imposto e insere linha */<br/>  dValorPis = (dValorBase * dAliquotaPIS)/100;<br/>  dValorCofins = (dValorBase * dAliquotaCOFINS)/100;<br/>  <br/>  I5576B50_PopulaF5576B01(Registro, &RegistroF5576B01, dValorBase, dValorPis, (JCHAR *)_J("05"));<br/>  idJDEDBReturn = JDB_InsertTable(hF5576B01, NID_F5576B01, (ID)0, (void *)&RegistroF5576B01);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>  }<br/>  I5576B50_PopulaF5576B11(Registro, &RegistroF5576B11, dValorBase, dValorPis, dAliquotaPIS, (JCHAR *)_J("05"), TipoOperacao);<br/>  idJDEDBReturn = JDB_InsertTable(hF5576B11, NID_F5576B11, (ID)0, (void *)&RegistroF5576B11);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>  }<br/>  <br/>  I5576B50_PopulaF5576B01(Registro, &RegistroF5576B01, dValorBase, dValorCofins, (JCHAR *)_J("06"));<br/>  idJDEDBReturn = JDB_InsertTable(hF5576B01, NID_F5576B01, (ID)0, (void *)&RegistroF5576B01);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>  }<br/>  I5576B50_PopulaF5576B11(Registro, &RegistroF5576B11, dValorBase, dValorCofins, dAliquotaCOFINS, (JCHAR *)_J("06"), TipoOperacao);<br/>  idJDEDBReturn = JDB_InsertTable(hF5576B11, NID_F5576B11, (ID)0, (void *)&RegistroF5576B11);<br/>  if (idJDEDBReturn != JDEDB_PASSED)<br/>  {<br/>	  JDB_CloseTable(hF5576B01);<br/>	  JDB_CloseTable(hF5576B11);<br/>	  return (JDEDB_FAILED);<br/>  }<br/>  <br/>  JDB_CloseTable(hF5576B01);<br/>  JDB_CloseTable(hF5576B11);<br/>  return (JDEDB_PASSED);<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_PopulaAuditoria<br/> **************************************************************************/<br/>void I5576B50_PopulaAuditoria(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro)<br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  DSD9800100      dsAuditInfo       = {0};<br/>  /*******************************************************************************************************************/<br/>  idJDEDBReturn = jdeCallObject (_J("GetAuditInfo"), (LPFNBHVR) NULL, lpBhvrCom, lpVoid, <br/>                  (LPVOID) &dsAuditInfo, (CALLMAP *) NULL, (int) 0,<br/>                  (JCHAR *) NULL, (JCHAR *) NULL, (int) 0 );<br/>  <br/>  if (jdeIsBlankOrNull(Registro-&gtszUserId))<br/>  {<br/>	  jdeStrncpyTerminate(Registro-&gtszUserId, dsAuditInfo.szUserName, DIM(Registro-&gtszUserId));<br/>  }<br/>  if (IsJDEDATENull(&Registro-&gtjdDateUpdated))<br/>  {<br/>	  memcpy(&Registro-&gtjdDateUpdated, &dsAuditInfo.jdDate, sizeof(JDEDATE));<br/>  }<br/>  if (jdeIsBlankOrNull(Registro-&gtszWorkStationId)) <br/>  {<br/>	  jdeStrncpyTerminate(Registro-&gtszWorkStationId, dsAuditInfo.szWorkstation_UserId, DIM(Registro-&gtszWorkStationId));<br/>  }<br/>  if (jdeIsBlankOrNull(Registro-&gtszProgramId)) <br/>  {<br/>	  jdeStrncpyTerminate(Registro-&gtszProgramId, (JCHAR *)_J("B5576B50"), DIM(Registro-&gtszProgramId));<br/>  }  	  <br/>  if (MathZeroTest(&Registro-&gtmnTimeLastUpdated) == 0)<br/>  {<br/>	  MathCopy(&Registro-&gtmnTimeLastUpdated, &dsAuditInfo.mnTime);<br/>  }<br/>  <br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_PopulaF5576B50<br/> **************************************************************************/<br/>void I5576B50_PopulaF5576B50(LPDSD5576B50 Parametros, F5576B50 *RegistroF5576B50)<br/>{<br/>	<br/>	MathCopy(&RegistroF5576B50-&gtthbnnf, &Parametros-&gtmnNotaFiscalNumber);<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthbser, Parametros-&gtszNotaFiscalSeries, DIM(RegistroF5576B50-&gtthbser));<br/>	MathCopy(&RegistroF5576B50-&gtthn001, &Parametros-&gtmnNextNumber001);<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthdct, Parametros-&gtszDocumentType, DIM(RegistroF5576B50-&gtthdct));<br/>	MathCopy(&RegistroF5576B50-&gtthdoc, &Parametros-&gtmnDocVoucherInvoiceE);<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthedct, Parametros-&gtszEdiDocumentType, DIM(RegistroF5576B50-&gtthedct));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthitem, Parametros-&gtszItemNumber, DIM(RegistroF5576B50-&gtthitem));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthkco, Parametros-&gtszCompanyKey, DIM(RegistroF5576B50-&gtthkco));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthmcu, Parametros-&gtszCostCenter, DIM(RegistroF5576B50-&gtthmcu));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthobj, Parametros-&gtszObjectAccount, DIM(RegistroF5576B50-&gtthobj));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthsub, Parametros-&gtszSubsidiary, DIM(RegistroF5576B50-&gtthsub));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthaid, Parametros-&gtszAccountId, DIM(RegistroF5576B50-&gtthaid));<br/>	MathCopy(&RegistroF5576B50-&gtthan8, &Parametros-&gtmnAddressNumber);<br/>	MathCopy(&RegistroF5576B50-&gtthbvtn, &Parametros-&gtmnAmountNotaFiscalTotals);<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthtn, Parametros-&gtszNonTaxAuthorTypes, DIM(RegistroF5576B50-&gtthtn));<br/>	memcpy((void *)&RegistroF5576B50-&gtthbradej, (const void *)&Parametros-&gtjdNotaFiscalDate, sizeof(JDEDATE));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthaa04, Parametros-&gtszAlphaSpecData04, DIM(RegistroF5576B50-&gtthaa04));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthdsc1, Parametros-&gtszDescricaoLinha1, DIM(RegistroF5576B50-&gtthdsc1));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthdsc2, Parametros-&gtszDescricaoLinha2, DIM(RegistroF5576B50-&gtthdsc2));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthdsc3, Parametros-&gtszDescricaoLinha3, DIM(RegistroF5576B50-&gtthdsc3));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthtrty, Parametros-&gtszStatus, DIM(RegistroF5576B50-&gtthtrty));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthbsop, Parametros-&gtszSuffixTransactionNature, DIM(RegistroF5576B50-&gtthbsop));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthbrnop, Parametros-&gtszCodeTransactionNature, DIM(RegistroF5576B50-&gtthbrnop));<br/>	<br/>	RegistroF5576B50-&gtthev01 = Parametros-&gtcBloco;<br/>	RegistroF5576B50-&gtthev02 = Parametros-&gtcDebitoCredito;<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthuser, Parametros-&gtszUserId, DIM(RegistroF5576B50-&gtthuser));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthpid, Parametros-&gtszProgramId, DIM(RegistroF5576B50-&gtthpid));<br/>	jdeStrncpyTerminate(RegistroF5576B50-&gtthjobn, Parametros-&gtszWorkStationId, DIM(RegistroF5576B50-&gtthjobn));<br/>	MathCopy(&RegistroF5576B50-&gtthupmt, &Parametros-&gtmnTimeLastUpdated);<br/>	MathCopy(&RegistroF5576B50-&gtthfy, &Parametros-&gtmnFiscalYear1);<br/>	MathCopy(&RegistroF5576B50-&gtthpn, &Parametros-&gtmnPeriodNoGeneralLedge);<br/>	memcpy((void *)&RegistroF5576B50-&gtthupmj, (const void *)&Parametros-&gtjdDateUpdated, sizeof(JDEDATE));<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_PopulaF5576B01<br/> **************************************************************************/<br/>void I5576B50_PopulaF5576B01(LPDSD5576B50 Parametros, F5576B01 *RegistroF5576B01, double ValorBase, double ValorImposto, JCHAR *Imposto)<br/>{<br/>	<br/>	MathCopy(&RegistroF5576B01-&gtthbnnf, &Parametros-&gtmnNotaFiscalNumber);<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtthbser, Parametros-&gtszNotaFiscalSeries, DIM(RegistroF5576B01-&gtthbser));<br/>	MathCopy(&RegistroF5576B01-&gtthn001, &Parametros-&gtmnNextNumber001);<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtthdct, Parametros-&gtszDocumentType, DIM(RegistroF5576B01-&gtthdct));<br/>	<br/>	DoubleToMathNumeric(ValorBase, &RegistroF5576B01-&gtth55brtxb);<br/>	DoubleToMathNumeric(ValorImposto, &RegistroF5576B01-&gtth55brtxa);<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtth55brtx, Imposto, DIM(RegistroF5576B01-&gtth55brtx));<br/>	<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtthuser, Parametros-&gtszUserId, DIM(RegistroF5576B01-&gtthuser));<br/>	memcpy(&RegistroF5576B01-&gtthupmj, &Parametros-&gtjdDateUpdated, sizeof(JDEDATE));<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtthjobn, Parametros-&gtszWorkStationId, DIM(RegistroF5576B01-&gtthjobn));<br/>	jdeStrncpyTerminate(RegistroF5576B01-&gtthpid, Parametros-&gtszProgramId, DIM(RegistroF5576B01-&gtthpid));<br/>	MathCopy(&RegistroF5576B01-&gtthupmt, &Parametros-&gtmnTimeLastUpdated);<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_PopulaF5576B11<br/> **************************************************************************/<br/>void I5576B50_PopulaF5576B11(LPDSD5576B50 Parametros, F5576B11 *RegistroF5576B11, double ValorBase, double ValorImposto, double TaxaImposto, JCHAR *Imposto, JCHAR *Tipo)<br/>{		<br/>		<br/>	MathCopy(&RegistroF5576B11-&gttdbnnf, &Parametros-&gtmnNotaFiscalNumber);<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttdbser, Parametros-&gtszNotaFiscalSeries, DIM(RegistroF5576B11-&gttdbser));<br/>	MathCopy(&RegistroF5576B11-&gttdn001, &Parametros-&gtmnNextNumber001);<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttddct, Parametros-&gtszDocumentType, DIM(RegistroF5576B11-&gttddct));<br/>	ParseNumericString(&RegistroF5576B11-&gttdukid, _J("1"));<br/>	<br/>	DoubleToMathNumeric(ValorBase,    &RegistroF5576B11-&gttd55brtxb);<br/>	DoubleToMathNumeric(ValorImposto, &RegistroF5576B11-&gttd55brtxa);<br/>	DoubleToMathNumeric(TaxaImposto,  &RegistroF5576B11-&gttd55brtxr);	<br/>	<br/>	if (jdeIsBlankOrNull(Tipo))<br/>	{<br/>		if (ValorBase &lt 0 )<br/>		{<br/>			<br/>			//jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("50"), DIM(_J("50")));<br/>			jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("50"), DIM(RegistroF5576B11-&gttd55brtx2));<br/>			<br/>		}else {<br/>			<br/>			//jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("01"), DIM(_J("01")));<br/>			jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("01"), DIM(RegistroF5576B11-&gttd55brtx2));<br/>		}		<br/>		<br/>		/*<br/>		if (jdestrcmp((char *)Imposto, "05") == 0)<br/>		{<br/>			<br/>			if (TaxaImposto &lt 1)<br/>			{<br/>				<br/>				jdeStrcpy(RegistroF5576B11-&gttd55brtx2, "01", sizeof("01"));<br/>				<br/>			} else {<br/>				<br/>				jdeStrcpy(RegistroF5576B11-&gttd55brtx2, "50", sizeof("50"));<br/>				<br/>			}<br/>			<br/>		} else if (jdestrcmp((char *)Imposto, "06") == 0)<br/>		{<br/>		<br/>			if (TaxaImposto &lt 5)<br/>			{<br/>				<br/>				jdeStrcpy(RegistroF5576B11-&gttd55brtx2, "01", sizeof("01"));<br/>				<br/>			} else {<br/>				<br/>				jdeStrcpy(RegistroF5576B11-&gttd55brtx2, "50", sizeof("50"));<br/>				<br/>			}<br/>			<br/>		} */<br/>		<br/>	} else { <br/>		<br/>		if ((ValorBase &lt 0) && (*Tipo &lt _Z('50')))<br/>		{<br/>			<br/>			//jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("50"), DIM(_J("50")));<br/>			jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("50"), DIM(RegistroF5576B11-&gttd55brtx2));<br/>			<br/>		}else if (ValorBase &gt 0 && (*Tipo &gt= _Z('50'))){			<br/>				<br/>				//jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("01"), DIM(_J("01")));<br/>				jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, _J("01"), DIM(RegistroF5576B11-&gttd55brtx2));<br/>				<br/>		}else {		<br/>				<br/>				jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx2, Tipo, DIM(RegistroF5576B11-&gttd55brtx2));		<br/>				<br/>		}		<br/>	}<br/>	<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttd55brtx, Imposto, DIM(RegistroF5576B11-&gttd55brtx));<br/>	<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttduser, Parametros-&gtszUserId, DIM(RegistroF5576B11-&gttduser));<br/>	memcpy(&RegistroF5576B11-&gttdupmj, &Parametros-&gtjdDateUpdated, sizeof(JDEDATE));<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttdjobn, Parametros-&gtszWorkStationId, DIM(RegistroF5576B11-&gttdjobn));<br/>	jdeStrncpyTerminate(RegistroF5576B11-&gttdpid, Parametros-&gtszProgramId, DIM(RegistroF5576B11-&gttdpid));<br/>	MathCopy(&RegistroF5576B11-&gttdupmt, &Parametros-&gtmnTimeLastUpdated);<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_RetornaAliquota<br/> **************************************************************************/<br/>double I5576B50_RetornaAliquota(HUSER hUser, JCHAR *Taxa)<br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn = ER_SUCCESS;<br/>  HREQUEST        hF5504PT0     = (HREQUEST)NULL;<br/>  F5504PT0        RegistroF5504PT0 = {0};<br/>  KEY1_F5504PT0   ChaveF5504PT0    = {0};<br/>  /*******************************************************************************************************************/<br/>  idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504PT0, ID_F5504PT0_CHVIMPOSTO, NULL, 0, NULL, &hF5504PT0);	<br/>  if (idJDEDBReturn == JDEDB_PASSED) <br/>  {<br/>	  <br/>	  jdeStrncpyTerminate(ChaveF5504PT0.tctg01, Taxa, DIM(ChaveF5504PT0.tctg01));<br/>      <br/>	  idJDEDBReturn = JDB_FetchKeyed(hF5504PT0, ID_F5504PT0_CHVIMPOSTO, &ChaveF5504PT0, 1, &RegistroF5504PT0, FALSE);<br/>	  if (idJDEDBReturn == JDEDB_PASSED) <br/>	  {<br/>		  <br/>		  JDB_CloseTable(hF5504PT0);<br/>		  return MathNumericToDouble(&RegistroF5504PT0.tcbpct);<br/>		  <br/>	  } else {<br/>		  <br/>		  JDB_CloseTable(hF5504PT0);<br/>		  return -1;<br/>		  <br/>	  }<br/>	  <br/>  } else {<br/>	  <br/>	  JDB_CloseTable(hF5504PT0);<br/>	  return -1;<br/>	  <br/>  }<br/>}<br/>/*Busca udc - tipo operação*/<br/>/**************************************************************************<br/> *   Function:  I5576B50_TipoOperacao<br/> **************************************************************************/<br/>void I5576B50_TipoOperacao(HUSER hUser, JCHAR *SY, JCHAR *RT, JCHAR *KY, JCHAR *TipoOperacao)<br/>{<br/>	ID              idJDEDBReturn = ER_SUCCESS;<br/>	HREQUEST        hF0005        = (HREQUEST)NULL;<br/>	KEY1_F0005      ChaveF0005    = {0};<br/>	F0005           RegistroF0005 = {0};<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F0005, ID_F0005_SYSTEM__TYPE__CODE, NULL, 0, NULL, &hF0005);	<br/>	<br/>	if (idJDEDBReturn == JDEDB_PASSED) <br/>	{<br/>		<br/>		jdeStrncpyTerminate(ChaveF0005.drsy, SY, DIM(ChaveF0005.drsy));<br/>		jdeStrncpyTerminate(ChaveF0005.drrt, RT, DIM(ChaveF0005.drrt));<br/>		jdeStrncpyTerminate(ChaveF0005.drky, KY, DIM(ChaveF0005.drky));<br/>		I5576B50_RemoveSurroundingBlanks((JCHAR *)&ChaveF0005.drky);<br/>		<br/>	    idJDEDBReturn = JDB_FetchKeyed(hF0005, ID_F0005_SYSTEM__TYPE__CODE, &ChaveF0005, 3, &RegistroF0005, FALSE);<br/>	    if (idJDEDBReturn == JDEDB_PASSED) <br/>		{<br/>			<br/>			JDB_CloseTable(hF0005);<br/>			jdeStrncpyTerminate(TipoOperacao, RegistroF0005.drdl02, 3);<br/>			<br/>		} else {<br/>			<br/>			JDB_CloseTable(hF0005);<br/>			<br/>		}<br/>		<br/>	} else {<br/>		  <br/>		  JDB_CloseTable(hF0005);<br/>		  <br/>	}<br/>}<br/>/*copiada de outra função*/<br/>/**************************************************************************<br/> *   Function:  I5576B50_RemoveSurroundingBlanks<br/> **************************************************************************/<br/>void I5576B50_RemoveSurroundingBlanks(JCHAR * szString)<br/>{<br/>	<br/>	unsigned int	ni;<br/>	JCHAR	*p;<br/>	JCHAR	*s;<br/>	JCHAR	*pi;<br/> <br/>	ni = jdeStrlen(szString);		/* Get initial length of string */<br/>	s = (JCHAR *) calloc(ni+1, sizeof(*s));  /* allow for the null char at end of string */<br/>	jdeStrncpy(s, (const JCHAR *) szString, ni);<br/>	pi = s;<br/><br/>	if (*s != _J('\0'))<br/>	{	while (jdeIsspace(*s) && *s != _J('\0'))	/* Skip leading spaces */<br/>			++s;<br/>		p = s;<br/>		<br/>		if (*s)								/* Proceed if remaining string is not null */<br/>		{<br/>			for (;*s != _J('\0'); ++s);			/* go to end of string */<br/>			--s;							/* back up one char to point to last char in string */<br/>			while (jdeIsspace(*s))				/* remove spaces from end of string */<br/>			{<br/>				*s = _J('\0');<br/>				--s;<br/>			}<br/>		}<br/>		jdeStrncpy(szString, (const JCHAR *) p, ni);<br/>	}<br/>	free(pi);<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_strpadl<br/> **************************************************************************/<br/>void I5576B50_strpadl (JCHAR *lpszString, const JCHAR *szPad, size_t nLen) <br/>{<br/>   JCHAR     szS2[255];<br/>   int      nCount   = 0;<br/>   int      nBefore  = 0;<br/>   int      nSize    = 0;<br/>   <br/>   nSize = jdeStrlen(lpszString);<br/>   nBefore = (nLen - nSize);<br/>   <br/>   if (nBefore &gt= 0)<br/>   {<br/>      for (nCount = 1; nCount &lt= nBefore; nCount++)<br/>      {<br/>         jdeStrcat ((JCHAR *)szS2,(JCHAR *)szPad);<br/>      }<br/>      jdeStrcat ((JCHAR *)szS2, (JCHAR *)lpszString);<br/>   }<br/>   else<br/>   {<br/>      jdeStrncpy((JCHAR *)lpszString, (JCHAR *)lpszString, nLen);<br/>   }<br/>   <br/>   jdeStrcpy((JCHAR *)lpszString, (JCHAR *)szS2);<br/>   <br/>   return;<br/><br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_strpadr<br/> **************************************************************************/<br/>void I5576B50_strpadr (JCHAR *lpszString, const JCHAR *szPad, size_t nLen) <br/>{<br/>   int      nCount   = 0;<br/>   int      nAfter   = 0;<br/>   int      nSize    = 0;<br/>   <br/>   nSize = jdeStrlen(lpszString);<br/>   nAfter = (nLen - nSize);<br/>   <br/>   if (nAfter &gt= 0)<br/>   {<br/>      for (nCount = 1; nCount &lt= nAfter; nCount++)<br/>      {<br/>         jdeStrcat ((JCHAR *)lpszString, (JCHAR *)szPad);<br/>      }<br/>   }<br/>   else<br/>   {<br/>      jdeStrncpy((JCHAR *)lpszString, (JCHAR *)lpszString, nLen);<br/>   }<br/>   return;<br/><br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_BuscaCodigoTransacao<br/> **************************************************************************/<br/>void I5576B50_BuscaCodigoTransacao(HUSER hUser, JCHAR *BNOP, JCHAR *bsop, JCHAR *fco, JCHAR *CodigoTransacao)<br/>{<br/>	ID              idJDEDBReturn   = ER_SUCCESS;<br/>	HREQUEST        hF76B200        = (HREQUEST)NULL;<br/>	KEY1_F76B200    ChaveF76B200    = {0};<br/>	KEY2_F76B200    Chave2F76B200   = {0};  <br/>	F76B200         RegistroF76B200 = {0};<br/>	int             Tamanho         = 0;<br/>	short           NumChaves       = 2;<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F76B200, 0, NULL, 0, NULL, &hF76B200);	<br/>	<br/>	if (idJDEDBReturn == JDEDB_PASSED) <br/>	{<br/>		<br/>		Tamanho = jdeStrlen(BNOP);<br/>		if (Tamanho &gt 3)<br/>		{<br/>			<br/>			jdeStrncpyTerminate(Chave2F76B200.dpbrnop, BNOP, DIM(Chave2F76B200.dpbrnop));<br/>			if (!jdeIsBlankOrNull(bsop))<br/>			{<br/>				jdeStrncpyTerminate(Chave2F76B200.dpbsop, bsop, DIM(Chave2F76B200.dpbsop));<br/>			} else {<br/>				NumChaves -= 1;<br/>			};<br/>			/*idJDEDBReturn = JDB_FetchKeyed(hF76B200, ID_F76B200_NOVOCFOP__SUFIXO, &Chave2F76B200, 2, &RegistroF76B200, FALSE);*/<br/>			idJDEDBReturn = JDB_SelectKeyed(hF76B200, ID_F76B200_NOVOCFOP__SUFIXO, &Chave2F76B200, NumChaves);<br/>			if (idJDEDBReturn == JDEDB_PASSED) <br/>			{<br/>				idJDEDBReturn = JDB_FetchMatchingKey(hF76B200, &Chave2F76B200, NumChaves, &RegistroF76B200, FALSE);<br/>				if (idJDEDBReturn == JDEDB_PASSED) <br/>				{<br/>					<br/>					JDB_CloseTable(hF76B200);<br/>					I5576B50_RemoveSurroundingBlanks(RegistroF76B200.dpbrnop);<br/>					jdeStrncpyTerminate (CodigoTransacao, RegistroF76B200.dpbrnop, DIM(RegistroF76B200.dpbrnop)); <br/>				    jdeStrncpyTerminate (bsop, RegistroF76B200.dpbsop, DIM(RegistroF76B200.dpbsop)); <br/>					<br/>				} else {<br/>					<br/>					JDB_CloseTable(hF76B200);<br/>					<br/>				}<br/>				<br/>			} else {<br/>				<br/>				JDB_CloseTable(hF76B200);<br/>				<br/>			}<br/>			<br/>		} else {<br/>			<br/>			ParseNumericString(&ChaveF76B200.dpbnop, BNOP);<br/>			jdeStrncpyTerminate(ChaveF76B200.dpbsop, bsop, DIM(ChaveF76B200.dpbsop));<br/>			jdeStrncpyTerminate(ChaveF76B200.dpfco, fco, DIM(ChaveF76B200.dpfco));<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF76B200, ID_F76B200_CFOP__SUFIXO__COMPANHIA, &ChaveF76B200, 3, &RegistroF76B200, FALSE);<br/>		    if (idJDEDBReturn == JDEDB_PASSED) <br/>			{<br/>				<br/>				JDB_CloseTable(hF76B200);<br/>				jdeStrncpyTerminate (CodigoTransacao, RegistroF76B200.dpbrnop, DIM(RegistroF76B200.dpbrnop)); <br/>				<br/>			} else {<br/>				<br/>				jdeStrncpyTerminate(ChaveF76B200.dpfco, (JCHAR *)_J("00999"), DIM(ChaveF76B200.dpfco));<br/>				idJDEDBReturn = JDB_FetchKeyed(hF76B200, ID_F76B200_CFOP__SUFIXO__COMPANHIA, &ChaveF76B200, 3, &RegistroF76B200, FALSE);<br/>				if (idJDEDBReturn == JDEDB_PASSED) <br/>				{<br/>					<br/>					JDB_CloseTable(hF76B200);<br/>					jdeStrncpyTerminate (CodigoTransacao, RegistroF76B200.dpbrnop, DIM(RegistroF76B200.dpbrnop)); <br/>					<br/>				} else {<br/>					JDB_CloseTable(hF76B200);<br/>				}<br/>				<br/>			}<br/>			<br/>		}<br/>		<br/>	}<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_Comulativo<br/> **************************************************************************/<br/>BOOL I5576B50_Comulativo(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros, JCHAR *KY, JCHAR *CO)<br/>{<br/>	ID              idJDEDBReturn    = ER_SUCCESS;<br/>	HREQUEST        hF5504RR0        = (HREQUEST)NULL;<br/>	HREQUEST        hF5504RR5        = (HREQUEST)NULL;<br/>	KEY1_F5504RR0   ChaveF5504RR0    = {0};<br/>	KEY1_F5504RR5   ChaveF5504RR5    = {0};<br/>	F5504RR0        RegistroF5504RR0 = {0};<br/>	F5504RR5        RegistroF5504RR5 = {0};<br/>/*	DSD5576EPCA		dsDefineContaLF = {0};*/<br/>	JCHAR            szCentroCusto[13];<br/>	JCHAR			szCia[6] = _J("");<br/>	int				x,y,tam;<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504RR5, 0, NULL, 0, NULL, &hF5504RR5);	<br/>	<br/>	if (idJDEDBReturn == JDEDB_PASSED) <br/>	{<br/>		<br/>		jdeStrncpyTerminate(ChaveF5504RR5.trmcu, Parametros-&gtszCostCenter, DIM(ChaveF5504RR5.trmcu));<br/>		jdeStrncpyTerminate(ChaveF5504RR5.trobj, Parametros-&gtszObjectAccount, DIM(ChaveF5504RR5.trobj));<br/>		jdeStrncpyTerminate(ChaveF5504RR5.trsub, Parametros-&gtszSubsidiary, DIM(ChaveF5504RR5.trsub));<br/>		<br/>		/*Verifica a Nivel de Centro de Custo se é "Não Cumulativo"*/<br/>		jdeStrncpyTerminate(ChaveF5504RR5.trky, KY, DIM(ChaveF5504RR5.trky));<br/>		jdeStrncpyTerminate(ChaveF5504RR5.trco, CO, DIM(ChaveF5504RR5.trco));<br/>		<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &ChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>		if (idJDEDBReturn == JDEDB_PASSED)<br/>		{<br/>			JDB_CloseTable(hF5504RR5);<br/>			return FALSE;<br/>			<br/>		}else{<br/>			<br/>			/*Verifica a Nivel de Centro de Custo se é "Cumulativo"*/<br/>			jdeStrncpyTerminate(ChaveF5504RR5.trky, _J("PIS"), DIM(ChaveF5504RR5.trky));<br/>			jdeStrncpyTerminate(ChaveF5504RR5.trco, _J("00999"), DIM(ChaveF5504RR5.trco));<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &ChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>			if (idJDEDBReturn == JDEDB_PASSED)<br/>			{	<br/>				JDB_CloseTable(hF5504RR5);<br/>				return TRUE;<br/>				<br/>			}else{<br/>				<br/>				idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504RR0, 0, NULL, 0, NULL, &hF5504RR0);<br/>				if (idJDEDBReturn == JDEDB_PASSED)<br/>				{	<br/>					/*LTRIM - Retirando os espaços em branco a esquerda do "CentroCusto".*/<br/>					jdeStrncpyTerminate(szCentroCusto, Parametros-&gtszCostCenter, DIM(szCentroCusto));<br/>					tam = jdeStrlen(szCentroCusto);<br/>					while(szCentroCusto[0] == _J(' '))<br/>					{<br/>						for(y=0; y &lt tam; y++)<br/>						 szCentroCusto[y] = szCentroCusto[y+1];																		<br/>					}					<br/>					<br/>					/*SUBSTR - Pegando a Empresa do "CentroCusto"*/<br/>					for(x=0; x &lt 3; x++)<br/>					{<br/>						szCia[x]= szCentroCusto[x];<br/>					}<br/>					<br/>					/*LPAD*/<br/>					I5576B50_strpadl( szCia, _J("0") , 5);					<br/>					<br/>					/*Verifica a Empresa se é "Não Cumulativo"*/<br/>					jdeStrncpyTerminate(ChaveF5504RR0.trky, KY, DIM(ChaveF5504RR0.trky));<br/>					jdeStrncpyTerminate(ChaveF5504RR0.trco, szCia, DIM(ChaveF5504RR0.trco));<br/>					ParseNumericString(&ChaveF5504RR0.tridln, _J("1"));						<br/>					idJDEDBReturn = JDB_SelectKeyed(hF5504RR0, ID_F5504RR0_CHVPRINCIPAL, &ChaveF5504RR0, 2);<br/>					if (idJDEDBReturn == JDEDB_PASSED) <br/>					{<br/>						idJDEDBReturn = JDB_FetchMatchingKey(hF5504RR0, &ChaveF5504RR0, 2, &RegistroF5504RR0, FALSE);<br/>						if (idJDEDBReturn == JDEDB_PASSED) <br/>						{<br/>							<br/>							/*Não Cumulativo*/<br/>							JDB_CloseTable(hF5504RR5);<br/>							JDB_CloseTable(hF5504RR0);<br/>							return FALSE;<br/>							<br/>						}else{<br/>							<br/>							/*Cumulativo*/<br/>							JDB_CloseTable(hF5504RR5);<br/>							JDB_CloseTable(hF5504RR0);<br/>							return TRUE;<br/>							<br/>						}<br/>						<br/>					}else{<br/><br/>						JDB_CloseTable(hF5504RR5);<br/>						JDB_CloseTable(hF5504RR0);<br/>						return TRUE;<br/>						<br/>					}<br/>					<br/>				}else{	<br/>					<br/>					JDB_CloseTable(hF5504RR5);<br/>					JDB_CloseTable(hF5504RR0);				<br/>					return TRUE;<br/><br/>				}	<br/>								<br/>			}<br/>			<br/>		}	<br/>		<br/>	} else {<br/>		<br/>		JDB_CloseTable(hF5504RR5);<br/>		return TRUE;<br/>		<br/>	}<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_GeraTXT<br/> **************************************************************************/<br/>void I5576B50_GeraTXT(HUSER hUser, LPDSD5576B50 Registro, JCHAR *NomeArquivo)<br/>{<br/>	/*************************************************************/<br/>	ID              idJDEDBReturn    = ER_SUCCESS;<br/>	HREQUEST        hF5576B50        = (HREQUEST)NULL;<br/>	F5576B50        RegistroF5576B50 = {0};<br/>	FILE            *Arquivo         = NULL;<br/>	/*************************************************************/<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B50, 0, NULL, 0, NULL, &hF5576B50);	<br/>	<br/>	if (idJDEDBReturn == JDEDB_PASSED) <br/>	{<br/>		<br/>		idJDEDBReturn = JDB_SelectAll(hF5576B50);<br/>		if (idJDEDBReturn == JDEDB_PASSED) <br/>		{<br/>			<br/>			Arquivo = jdeFopen(NomeArquivo, _J("w+"));<br/>			<br/>			while (JDB_Fetch(hF5576B50, &RegistroF5576B50, 0) == JDEDB_PASSED) <br/>			{<br/>				<br/>				jdeFprintf(Arquivo, _J("%ls,s%,s%,s%,s%,s%,s%,s%"), RegistroF5576B50.thbnnf.String, RegistroF5576B50.thbser, RegistroF5576B50.thn001.String, RegistroF5576B50.thdct,<br/>						RegistroF5576B50.thdoc.String, RegistroF5576B50.thedct, RegistroF5576B50.thitem, RegistroF5576B50.thkco, RegistroF5576B50.thmcu, RegistroF5576B50.thobj,<br/>						RegistroF5576B50.thsub, RegistroF5576B50.thaid, RegistroF5576B50.than8.String);<br/>				<br/>			}<br/>		<br/>			jdeFclose(Arquivo);<br/>			<br/>		} else {<br/>			<br/>			JDB_CloseTable(hF5576B50);<br/>			<br/>		}<br/>		<br/>	} else {<br/>		<br/>		JDB_CloseTable(hF5576B50);<br/>		<br/>	}<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_GravaLog<br/> **************************************************************************/<br/>void I5576B50_GravaLog(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Registro, JCHAR *Tabela, JCHAR Operacao)<br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  DSD550000001    dsGeraLog         = {0};<br/>  /*******************************************************************************************************************/<br/>  <br/>  jdeStrncpyTerminate(dsGeraLog.NomedaTabela, Tabela, DIM(dsGeraLog.NomedaTabela));	<br/>  dsGeraLog.Operacao = Operacao;<br/>  jdeStrncpyTerminate(dsGeraLog.String1, Registro-&gtszNotaFiscalSeries, DIM(dsGeraLog.String1));	<br/>  jdeStrncpyTerminate(dsGeraLog.String2, Registro-&gtszDocumentType, DIM(dsGeraLog.String2));	<br/>  jdeStrncpyTerminate(dsGeraLog.String3, Registro-&gtszEdiDocumentType, DIM(dsGeraLog.String3));	<br/>  jdeStrncpyTerminate(dsGeraLog.String4, Registro-&gtszCompanyKey, DIM(dsGeraLog.String4));	<br/>  <br/>  MathCopy(&dsGeraLog.Numeric1 ,&Registro-&gtmnNotaFiscalNumber);<br/>  MathCopy(&dsGeraLog.Numeric2 ,&Registro-&gtmnNextNumber001);<br/>  MathCopy(&dsGeraLog.Numeric3 ,&Registro-&gtmnDocVoucherInvoiceE);<br/>  MathCopy(&dsGeraLog.Numeric4 ,&Registro-&gtmnAddressNumber);<br/>  MathCopy(&dsGeraLog.Numeric5 ,&Registro-&gtmnAmountNotaFiscalTotals);<br/>  <br/>  memcpy(&dsGeraLog.Date1, &Registro-&gtjdNotaFiscalDate, sizeof(JDEDATE));<br/>  <br/>  idJDEDBReturn = jdeCallObject (_J("Gera_Log"), (LPFNBHVR) NULL, lpBhvrCom, lpVoid, <br/>                  (LPVOID) &dsGeraLog, (CALLMAP *) NULL, (int) 0,<br/>                  (JCHAR *) NULL, (JCHAR *) NULL, (int) 0 );<br/>  <br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_ValidaNota<br/> **************************************************************************/<br/>BOOL I5576B50_ValidaNota(LPDSD5576B50 Parametros)<br/>{<br/>	<br/>	/*if (MathZeroTest(&Parametros-&gtmnNotaFiscalNumber) == 0)<br/>	{<br/>		return FALSE;<br/>	} else if (jdeIsBlankOrNull(Parametros-&gtszNotaFiscalSeries)) {<br/>		return FALSE;<br/>	} else if (MathZeroTest(&Parametros-&gtmnNextNumber001) == 0) {<br/>		return FALSE;<br/>	} else if (jdeIsBlankOrNull(Parametros-&gtszDocumentType)) {<br/>		return FALSE;<br/>	}*/<br/>    <br/>	if (MathZeroTest(&Parametros-&gtmnNextNumber001) == 0) {<br/>		return FALSE;<br/>	}<br/>	return TRUE;<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_BuscaIdConta<br/> **************************************************************************/<br/>void I5576B50_BuscaIdConta(HUSER hUser, JCHAR *MCU, JCHAR *OBJ, JCHAR *SUB, JCHAR *IdConta)<br/>{<br/>  /*******************************************************************************************************************/<br/>  ID              idJDEDBReturn     = ER_SUCCESS;<br/>  HREQUEST        hF0901 	        = (HREQUEST)NULL;<br/>  KEY2_F0901      ChaveF0901        = {0};<br/>  F0901           RegistroF0901     = {0};<br/>  /*******************************************************************************************************************/<br/>  idJDEDBReturn = JDB_OpenTable(hUser, NID_F0901, 0, NULL, 0, NULL, &hF0901);<br/>  <br/>  if (idJDEDBReturn == JDEDB_PASSED)<br/>  {<br/>	  <br/>	  jdeStrncpyTerminate(ChaveF0901.gmmcu, MCU, DIM(ChaveF0901.gmmcu));	<br/>	  jdeStrncpyTerminate(ChaveF0901.gmobj, OBJ, DIM(ChaveF0901.gmobj));	<br/>	  jdeStrncpyTerminate(ChaveF0901.gmsub, SUB, DIM(ChaveF0901.gmsub));	<br/>	  <br/>	  idJDEDBReturn = JDB_FetchKeyed(hF0901, ID_F0901_BUSINESS_UNIT__OBJECT, &ChaveF0901, 3, &RegistroF0901, FALSE);<br/>	  if (idJDEDBReturn == JDEDB_PASSED)<br/>	  {<br/>		  jdeStrncpyTerminate(IdConta, RegistroF0901.gmaid, DIM(RegistroF0901.gmaid));<br/>	  }<br/>	  <br/>  }<br/>  <br/>  if (hF0901)<br/>  {<br/>	JDB_CloseTable(hF0901);<br/>  }<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_BuscaAliquotaPisCofins<br/> **************************************************************************/ <br/>void I5576B50_BuscaAliquotaPisCofins(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576B50 Parametros, double *TaxaPis, double *TaxaCofins, JCHAR *TipoOperacao)<br/>{<br/>    /*******************************************************************************************************************/<br/>    /*ID              idJDEDBReturn     = ER_SUCCESS;*/<br/>	JCHAR            szTipoOperacao[3]           = _J("");<br/>    JCHAR            CodigoTransacao[5]        = _J("");<br/>    JCHAR            CodigoSufixoTransacao[10] = _J("");<br/>    /*******************************************************************************************************************/<br/>	<br/>    I5576B50_BuscaCodigoTransacao(hUser, Parametros-&gtszCodeTransactionNature, (JCHAR *)&Parametros-&gtszSuffixTransactionNature, Parametros-&gtszCompanyKey, (JCHAR *)&CodigoTransacao);<br/>    <br/>    if (!jdeIsBlankOrNull(CodigoTransacao)) <br/>	{<br/>		<br/>	    I5576B50_RemoveSurroundingBlanks(CodigoTransacao);<br/>	    <br/>        jdeStrcpy(CodigoSufixoTransacao, CodigoTransacao);<br/>	    jdeStrcat(CodigoSufixoTransacao, _J("."));<br/>	    jdeStrcat(CodigoSufixoTransacao, Parametros-&gtszSuffixTransactionNature);<br/>	    	  <br/>	    I5576B50_TipoOperacao(hUser, (JCHAR *)_J("55"), (JCHAR *)_J("IO"), CodigoSufixoTransacao, (JCHAR *)&szTipoOperacao);<br/>		jdeStrcpy(TipoOperacao, szTipoOperacao);<br/>		<br/>	    if (jdeStrcmp(TipoOperacao,_J("01")) == 0 || jdeStrcmp(TipoOperacao,_J("50")) == 0)<br/>		{<br/>			if (MathZeroTest(&Parametros-&gtmnTaxaPis) == 0)<br/>			{<br/>				/*Verifica se o Imposto é cumulativo*/<br/>			    if (I5576B50_Comulativo(hUser, lpBhvrCom, lpVoid, Parametros, (JCHAR *)_J("PIS CRD"), Parametros-&gtszCompanyKey)) <br/>				{<br/>					<br/>				    /*Busca Aliquota de PIS*/<br/>				    *TaxaPis = I5576B50_RetornaAliquota(hUser, (JCHAR *)_J("PIS E C"));<br/>				    <br/>				} else {<br/>				   <br/>				   /*Busca Aliquota de PIS*/<br/>				   *TaxaPis = I5576B50_RetornaAliquota(hUser, (JCHAR *)_J("PIS E Ñ"));<br/>				   <br/>				}<br/>			    <br/>			} else {<br/>			  <br/>			  *TaxaPis = MathNumericToDouble(&Parametros-&gtmnTaxaPis);<br/>			  <br/>			}<br/>		    <br/>		    if (MathZeroTest(&Parametros-&gtmnTaxaCofins) == 0)<br/>			{<br/>		 		<br/>			    if (I5576B50_Comulativo(hUser, lpBhvrCom, lpVoid, Parametros, (JCHAR *)_J("COFINS CRD"), Parametros-&gtszCompanyKey)) <br/>				{<br/>					<br/>				    /*Busca Aliquota de COFINS*/<br/>				    *TaxaCofins = I5576B50_RetornaAliquota(hUser, (JCHAR *)_J("COFINS E C"));<br/>				    <br/>				} else {<br/>					<br/>	   			    /*Busca Aliquota de COFINS*/<br/>				    *TaxaCofins = I5576B50_RetornaAliquota(hUser, (JCHAR *)_J("COFINS E Ñ"));<br/>				    <br/>				}	<br/>			    <br/>			} else {<br/>				<br/>			    *TaxaCofins = MathNumericToDouble(&Parametros-&gtmnTaxaCofins);<br/>			    <br/>			}<br/>		    <br/>		}<br/>		<br/>	}<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_BuscaProximoNumero<br/> **************************************************************************/<br/>void I5576B50_BuscaProximoNumero(HUSER hUser, LPBHVRCOM lpBhvrCom, LPVOID lpVoid, MATH_NUMERIC *ProximoNumero)<br/>{<br/>    /*******************************************************************************************************************/<br/>    ID              idJDEDBReturn     = ER_SUCCESS;<br/>	DSDX00022A		dsProximoNumero   = {0};<br/>    /*******************************************************************************************************************/<br/>	<br/>	jdeStrncpyTerminate(dsProximoNumero.szObjectName, (JCHAR *)_J("F5576B50"), DIM(dsProximoNumero.szObjectName));<br/>	idJDEDBReturn = jdeCallObject (_J("GetNextUniqueKeyID"), (LPFNBHVR) NULL, lpBhvrCom, lpVoid, <br/>                  (LPVOID) &dsProximoNumero, (CALLMAP *) NULL, (int) 0,<br/>                  (JCHAR *) NULL, (JCHAR *) NULL, (int) 0 );<br/>	if (idJDEDBReturn == ER_SUCCESS)<br/>	{<br/>		<br/>		MathCopy(ProximoNumero, &dsProximoNumero.mnUniqueKeyID);<br/>		<br/>	} else {<br/>		<br/>		ZeroMathNumeric(ProximoNumero);<br/>		<br/>	}<br/>	<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I5576B50_BuscaNaturezaOperacao<br/> **************************************************************************/<br/>void I5576B50_BuscaNaturezaOperacao(HUSER hUser, MATH_NUMERIC mnDOC, JCHAR *szEDCT, JCHAR *szFCO, JCHAR *CFOP)<br/>{<br/>    /*******************************************************************************************************************/<br/>    ID              idJDEDBReturn     = ER_SUCCESS;<br/>	HREQUEST        hV570117R         = (HREQUEST)NULL;<br/>	SELECTSTRUCT    dsSelecao[3];<br/>	DBREF           dsDbRefBRCFOP     = {0};<br/>    JCHAR            szCFOP[6]         = _J("");<br/>    /*******************************************************************************************************************/<br/>	<br/>	memset((void *)dsSelecao,(int)_J('\0'),sizeof(dsSelecao));<br/>    jdeNIDcpy(dsDbRefBRCFOP.szTable, NID_F570117);<br/>    jdeNIDcpy(dsDbRefBRCFOP.szDict,  NID_BRCFOP);<br/>	<br/>	idJDEDBReturn = JDB_OpenView(hUser, _J("V570117R"), NULL, &hV570117R);<br/>	<br/>	if (idJDEDBReturn == JDEDB_PASSED)<br/>	{<br/>		<br/>	    jdeNIDcpy(dsSelecao[0].Item1.szDict, NID_DOC);<br/>	    jdeNIDcpy(dsSelecao[0].Item1.szTable, NID_F570116);<br/>	    dsSelecao[0].lpValue        = &mnDOC;<br/>	    dsSelecao[0].nValues        = (ushort)1;<br/>	    dsSelecao[0].nCmp           = JDEDB_CMP_EQ;<br/>	    dsSelecao[0].nAndOr         = JDEDB_ANDOR_AND;   <br/>		<br/>	    jdeNIDcpy(dsSelecao[1].Item1.szDict, NID_EDCT);<br/>	    jdeNIDcpy(dsSelecao[1].Item1.szTable, NID_F570112);<br/>	    dsSelecao[1].lpValue        = (void *)szEDCT;<br/>	    dsSelecao[1].nValues        = (ushort)1;<br/>	    dsSelecao[1].nCmp           = JDEDB_CMP_EQ;<br/>	    dsSelecao[1].nAndOr         = JDEDB_ANDOR_AND;        <br/>		<br/>	    jdeNIDcpy(dsSelecao[2].Item1.szDict, NID_CO);<br/>	    jdeNIDcpy(dsSelecao[2].Item1.szTable, NID_F570112);<br/>	    dsSelecao[2].lpValue        = (void *)szFCO;<br/>	    dsSelecao[2].nValues        = (ushort)1;<br/>	    dsSelecao[2].nCmp           = JDEDB_CMP_EQ;<br/>	    dsSelecao[2].nAndOr         = JDEDB_ANDOR_AND;        <br/>		<br/>		idJDEDBReturn = JDB_SetSelection(hV570117R, dsSelecao, 3, JDEDB_SET_REPLACE);<br/>		if (idJDEDBReturn == JDEDB_PASSED)<br/>		{<br/>			<br/>			idJDEDBReturn = JDB_SelectKeyed( hV570117R, 0, NULL, 0);<br/>			if (idJDEDBReturn == JDEDB_PASSED)<br/>			{<br/>				<br/>				JDB_Fetch( hV570117R, NULL, 0 );<br/>				if (idJDEDBReturn == JDEDB_PASSED)<br/>				{<br/>					<br/>					jdeStrncpyTerminate(szCFOP, (PJSTR)JDB_GetTableColValue( hV570117R, dsDbRefBRCFOP), DIM(szCFOP));<br/>					<br/>				} else {<br/>					<br/>					<br/>				}<br/>				<br/>			} else {<br/>				<br/>				<br/>			}<br/>			<br/>		} else {<br/>			<br/>			<br/>		}<br/>		<br/>	} else {<br/>		<br/>		<br/>	}<br/>	<br/>	jdeStrncpyTerminate(CFOP, szCFOP, DIM(szCFOP));<br/>	<br/>	JDB_CloseView(hV570117R);<br/>}<br/><br/>void I5576B50_BuscaNaturezaOperacaoSetupPisCofins(HUSER hUser, JCHAR *szEDCT, JCHAR *szFCO, JCHAR *CFOP)<br/>{<br/>    /*******************************************************************************************************************/<br/>    ID              idJDEDBReturn     = ER_SUCCESS;<br/>	HREQUEST        hF5576B40         = (HREQUEST)NULL;<br/>	KEY1_F5576B40   ChaveF5576B40     = {0};<br/>	F5576B40        RegistroF5576B40  = {0};<br/>    JCHAR            szCFOP[6]         = _J("");<br/>	short           NumChaves         = 3;<br/>    /*******************************************************************************************************************/<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5576B40, 0, NULL, 0, NULL, &hF5576B40);<br/>	if (idJDEDBReturn == JDEDB_PASSED) <br/>	{<br/>		<br/>		jdeStrncpyTerminate(ChaveF5576B40.pctg01, (JCHAR *)_J("PISCOFINS"), DIM(ChaveF5576B40.pctg01));<br/>		jdeStrncpyTerminate(ChaveF5576B40.pckco, szFCO, DIM(ChaveF5576B40.pckco));<br/>		if (!jdeIsBlankOrNull(szEDCT))<br/>		{<br/>			<br/>			jdeStrncpyTerminate(ChaveF5576B40.pcdct, szEDCT, DIM(ChaveF5576B40.pcdct));<br/>			<br/>		} else {<br/>			<br/>			NumChaves -= 1;<br/>			<br/>		}<br/>		<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5576B40,ID_F5576B40_PK, &ChaveF5576B40, NumChaves, &RegistroF5576B40, FALSE);<br/>		<br/>		if (idJDEDBReturn == JDEDB_PASSED) <br/>		{<br/>			<br/>			jdeStrncpyTerminate(szCFOP, RegistroF5576B40.pcbrnop, DIM(szCFOP));<br/>			<br/>		} else {<br/>			<br/>			<br/>		}<br/>		<br/>	} else {<br/>		<br/>		<br/>	}<br/>	<br/>	jdeStrncpyTerminate(CFOP, szCFOP, DIM(szCFOP));<br/>	JDB_CloseTable(hF5576B40);<br/>	<br/>}<br/><br/>BOOL I5576B50_SetaSelecao(LPDSD5576B50 lpDS, SELECTSTRUCT *Selecao)<br/>{<br/>	<br/>	short NumIndice = 0;<br/>	short NumChaves = I5576B50_PegaNumChaves(lpDS);<br/>	<br/>	if ((!jdeIsBlankOrNull((JCHAR *) lpDS-&gtmnNotaFiscalNumber.String)) && (MathZeroTest(&lpDS-&gtmnNotaFiscalNumber) != 0)) <br/>    {<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_BNNF);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnNotaFiscalNumber;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszNotaFiscalSeries)) <br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_BSER);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszNotaFiscalSeries;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull((JCHAR*)lpDS-&gtmnNextNumber001.String) && MathZeroTest(&lpDS-&gtmnNextNumber001) != 0)<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_N001);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnNextNumber001;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDocumentType))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DCT);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszDocumentType;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull((JCHAR*)lpDS-&gtmnDocVoucherInvoiceE.String) && MathZeroTest(&lpDS-&gtmnDocVoucherInvoiceE) != 0)<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DOC);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnDocVoucherInvoiceE;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszEdiDocumentType))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_EDCT);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszEdiDocumentType;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszItemNumber))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_ITEM);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszItemNumber;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCompanyKey))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_KCO);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszCompanyKey;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCostCenter))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_MCU);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszCostCenter;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszObjectAccount))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_OBJ);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszObjectAccount;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszSubsidiary))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_SUB);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszSubsidiary;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszAccountId))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_AID);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszAccountId;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull((JCHAR*)lpDS-&gtmnAddressNumber.String) && MathZeroTest(&lpDS-&gtmnAddressNumber) != 0)<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_AN8);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnAddressNumber;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!IsJDEDATENull(&lpDS-&gtjdNotaFiscalDate))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_BRADEJ);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtjdNotaFiscalDate;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszSuffixTransactionNature))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_BSOP);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszSuffixTransactionNature;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszAlphaSpecData04))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_AA04);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszAlphaSpecData04;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha1))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DSC1);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszDescricaoLinha1;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha2))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DSC2);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszDescricaoLinha2;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha3))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DSC3);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszDescricaoLinha3;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszStatus))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_TRTY);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszStatus;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszUserId))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_USER);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszUserId;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszProgramId))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_PID);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszProgramId;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszWorkStationId))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_JOBN);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszWorkStationId;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!IsJDEDATENull(&lpDS-&gtjdDateUpdated))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_UPMJ);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtjdDateUpdated;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull((JCHAR*)lpDS-&gtmnTimeLastUpdated.String) && MathZeroTest(&lpDS-&gtmnTimeLastUpdated) != 0)<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_DOC);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnTimeLastUpdated;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCodeTransactionNature))<br/>	{<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_BRNOP);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtszCodeTransactionNature;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull( (JCHAR*)lpDS-&gtmnFiscalYear1.String) && MathZeroTest(&lpDS-&gtmnFiscalYear1) != 0) <br/>    {<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_FY);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnFiscalYear1;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull((JCHAR*)lpDS-&gtmnPeriodNoGeneralLedge.String) && MathZeroTest(&lpDS-&gtmnPeriodNoGeneralLedge) != 0) <br/>    {<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szDict, NID_PN);<br/>		jdeNIDcpy(Selecao[NumIndice].Item1.szTable, NID_F5576B50);<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szDict, _J(""));<br/>		jdeNIDcpy(Selecao[NumIndice].Item2.szTable, _J(""));<br/>		Selecao[NumIndice].Item1.idInstance = 0;<br/>		Selecao[NumIndice].lpValue = &lpDS-&gtmnPeriodNoGeneralLedge;<br/>		Selecao[NumIndice].nAndOr = JDEDB_ANDOR_AND;<br/>		Selecao[NumIndice].nCmp   = JDEDB_CMP_EQ;<br/>		Selecao[NumIndice].nValues = 1;<br/>		NumIndice++;<br/>	}<br/>	if (NumIndice &gt NumChaves) {<br/>		return FALSE;<br/>	}<br/>	<br/>	return TRUE;<br/>}<br/><br/>short  I5576B50_PegaNumChaves(LPDSD5576B50 lpDS)<br/>{<br/>	short NumIndice = 0;<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnNotaFiscalNumber) != 0) <br/>    {<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszNotaFiscalSeries))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnNextNumber001) != 0) <br/>    {<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDocumentType))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnDocVoucherInvoiceE) != 0) <br/>    {<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszEdiDocumentType))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszItemNumber))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCompanyKey))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCostCenter))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszObjectAccount))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszSubsidiary))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszAccountId))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnAddressNumber) != 0) <br/>    {<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszNonTaxAuthorTypes))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	if (!IsJDEDATENull(&lpDS-&gtjdNotaFiscalDate))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszSuffixTransactionNature))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszAlphaSpecData04))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha1))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha2))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszDescricaoLinha3))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszStatus))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszUserId))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszProgramId))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszWorkStationId))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!IsJDEDATENull(&lpDS-&gtjdDateUpdated))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnTimeLastUpdated) != 0) <br/>    {<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (!jdeIsBlankOrNull(lpDS-&gtszCodeTransactionNature))<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnFiscalYear1) != 0)<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	if (MathZeroTest(&lpDS-&gtmnPeriodNoGeneralLedge) != 0)<br/>	{<br/>		NumIndice++;<br/>	}<br/>	<br/>	return NumIndice;<br/>}<br/><br/>BOOL   I5576B50_VerificaCentroCusto(HUSER hUser, LPDSD5576B50 lpDS, double *TaxaPis, double *TaxaCofins)<br/>{<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	KEY1_F5504RR5                dsChaveF5504RR5           = {0};<br/>	HREQUEST                     hF5504RR5                 = (HREQUEST)NULL;   <br/>	F5504RR5					 RegistroF5504RR5          = {0};<br/>	JCHAR                         Imposto[11]               = {0};<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504RR5, 0, NULL, 0, NULL, &hF5504RR5);<br/>	if (idJDEDBReturn) <br/>	{<br/>		/*Monta Chave */ 					<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trmcu, lpDS-&gtszCostCenter,    DIM(dsChaveF5504RR5.trmcu));		<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trobj, lpDS-&gtszObjectAccount, DIM(dsChaveF5504RR5.trobj));		<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trsub, lpDS-&gtszSubsidiary,    DIM(dsChaveF5504RR5.trsub));		<br/>		<br/>		/*Ve se exists PIS*/<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trco,  _J("00999"),               DIM(dsChaveF5504RR5.trco));<br/>		jdeStrcpy(Imposto, _J("PIS"));<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trky,  Imposto,               DIM(dsChaveF5504RR5.trky));		<br/>     	<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &dsChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>		if (idJDEDBReturn) <br/>		{<br/>			<br/>			*TaxaPis = I5576B50_RetornaAliquota(hUser, _J("PIS"));<br/>			<br/>		} else {<br/>			<br/>			/*Ve se existe PIS CRD*/ <br/>			jdeStrncpyTerminate(dsChaveF5504RR5.trco,  lpDS-&gtszCompanyKey, DIM(dsChaveF5504RR5.trco));<br/>			jdeStrcpy(Imposto, _J("PIS CRD"));<br/>			jdeStrncpyTerminate(dsChaveF5504RR5.trky,  Imposto,               DIM(dsChaveF5504RR5.trky));		<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &dsChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>			<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				*TaxaPis = I5576B50_RetornaAliquota(hUser, _J("PIS CRD"));<br/>				<br/>			} else {<br/>				<br/>				JDB_CloseTable(hF5504RR5);<br/>				return FALSE;<br/>				<br/>			}<br/>			<br/>		}<br/>		<br/>		<br/>		/*Ve se exists COFINS*/<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trco,  _J("00999"),               DIM(dsChaveF5504RR5.trco));<br/>		jdeStrcpy(Imposto, _J("COFINS"));<br/>		jdeStrncpyTerminate(dsChaveF5504RR5.trky,  Imposto,               DIM(dsChaveF5504RR5.trky));		<br/>     	<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &dsChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>		if (idJDEDBReturn) <br/>		{<br/>			<br/>			*TaxaCofins = I5576B50_RetornaAliquota(hUser, _J("COFINS"));<br/>			<br/>		} else {<br/>			<br/>			/*Ve se existe COFINS CRD*/<br/>			jdeStrncpyTerminate(dsChaveF5504RR5.trco,  lpDS-&gtszCompanyKey, DIM(dsChaveF5504RR5.trco));<br/>			jdeStrcpy(Imposto, _J("COFINS CRD"));<br/>			jdeStrncpyTerminate(dsChaveF5504RR5.trky,  Imposto,               DIM(dsChaveF5504RR5.trky));		<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504RR5,ID_F5504RR5_CHVPRINCIPAL, &dsChaveF5504RR5, 5, &RegistroF5504RR5, FALSE);<br/>			<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				*TaxaCofins = I5576B50_RetornaAliquota(hUser, _J("COFINS CRD"));<br/>				<br/>			} else {<br/>				<br/>				JDB_CloseTable(hF5504RR5);<br/>				return FALSE;<br/>				<br/>			}<br/>			<br/>		}<br/>		<br/>	} else {<br/>		<br/>	    JDB_CloseTable(hF5504RR5);<br/>		return FALSE;<br/>		<br/>	}<br/>	<br/>	JDB_CloseTable(hF5504RR5);<br/>	return TRUE;<br/>}<br/><br/>BOOL   I5576B50_VerificaCia(HUSER hUser, JCHAR *szCO, JCHAR *szOBJ, JCHAR *szSUB, double *TaxaPis, double *TaxaCofins)<br/>{<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	KEY1_F5504RR0                dsChaveF5504RR0           = {0};<br/>	HREQUEST                     hF5504RR0                 = (HREQUEST)NULL;   <br/>	F5504RR0					 RegistroF5504RR0          = {0};<br/>	JCHAR                         Imposto[11]               = {0};<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504RR0, 0, NULL, 0, NULL, &hF5504RR0);<br/>	if (idJDEDBReturn) <br/>	{<br/>		/*Monta Chave*/<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trco,  szCO,  DIM(dsChaveF5504RR0.trco));				<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trobj, szOBJ, DIM(dsChaveF5504RR0.trobj));		<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trsub, szSUB, DIM(dsChaveF5504RR0.trsub));		<br/>		ParseNumericString(&dsChaveF5504RR0.tridln, _J("1"));<br/>		<br/>		/*Ve se existe PIS*/<br/>		jdeStrcpy(Imposto, _J("PIS"));<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>     	<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>		if (idJDEDBReturn) <br/>		{<br/>			<br/>			if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("PIS")))<br/>			{<br/>				<br/>				*TaxaPis = I5576B50_RetornaAliquota(hUser, _J("PIS"));<br/>				<br/>			} else {<br/>				<br/>				*TaxaPis = 0;<br/>				<br/>			}			<br/>			<br/>		} else {<br/>			<br/>			/*Ve se existe PIS CRD*/<br/>			jdeStrcpy(Imposto, _J("PIS CRD"));<br/>			jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>			<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("PIS CRD")))<br/>				{<br/>					<br/>					*TaxaPis = I5576B50_RetornaAliquota(hUser, _J("PIS CRD"));<br/>					<br/>				} else {<br/>					<br/>					*TaxaPis = 0;<br/>					<br/>				}<br/>				<br/>			} else {<br/>				<br/>				/*Ve se existe PIS RF*/<br/>				jdeStrcpy(Imposto, _J("PIS RF"));<br/>				jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>				<br/>				idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>				<br/>				if (idJDEDBReturn) <br/>				{<br/>					<br/>					if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("PIS RF")))<br/>					{<br/>						<br/>						*TaxaPis = I5576B50_RetornaAliquota(hUser, _J("PIS RF"));<br/>						<br/>					} else {<br/>						<br/>						*TaxaPis = 0;<br/>						<br/>					}					<br/>					<br/>				} else {<br/>					<br/>					*TaxaPis = 0;<br/>					<br/>				}<br/>				<br/>			}<br/>			<br/>		}<br/>		<br/>		/*Ve se exists COFINS*/<br/>		jdeStrcpy(Imposto, _J("COFINS"));<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>     	<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>		if (idJDEDBReturn) <br/>		{<br/>			<br/>			if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("COFINS")))<br/>			{<br/>				<br/>				*TaxaCofins = I5576B50_RetornaAliquota(hUser, _J("COFINS"));<br/>				<br/>			} else {<br/>				<br/>				*TaxaCofins = 0;<br/>				<br/>			}<br/>			<br/>		} else {<br/>			<br/>			/*Ve se existe COFINS CRD*/<br/>			jdeStrcpy(Imposto, _J("COFINS CRD"));<br/>			jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>			<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("COFINS CRD")))<br/>				{<br/>					<br/>					*TaxaCofins = I5576B50_RetornaAliquota(hUser, _J("COFINS CRD"));<br/>					<br/>				} else {<br/>					<br/>					*TaxaCofins = 0;<br/>					<br/>				}<br/>				<br/>			} else {<br/>				<br/>				/*Ve se existe COFINS RF*/<br/>				jdeStrcpy(Imposto, _J("COFINS RF"));<br/>				jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto,               DIM(dsChaveF5504RR0.trky));		<br/>				<br/>				idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>				<br/>				if (idJDEDBReturn) <br/>				{<br/>				    <br/>					if (!I5576B50_VerificaCiaSetupExclusao(hUser, szCO, _J("COFINS")))<br/>					{<br/>						<br/>						*TaxaCofins = I5576B50_RetornaAliquota(hUser, _J("COFINS RF"));<br/>						<br/>					} else {<br/>						<br/>						*TaxaCofins = 0;<br/>						<br/>					}<br/>					<br/>				} else {<br/>					<br/>					*TaxaCofins =  0;<br/>					<br/>				}<br/>				<br/>			}<br/>			<br/>		}<br/>		<br/>	} else {<br/>		<br/>		JDB_CloseTable(hF5504RR0);<br/>		return FALSE;<br/>		<br/>	}<br/>	<br/>	JDB_CloseTable(hF5504RR0);<br/>	if (*TaxaPis == 0 && *TaxaCofins == 0)<br/>	{<br/>		<br/>		return FALSE;<br/>		<br/>	} else {<br/>		<br/>		return TRUE;<br/>		<br/>	}<br/>	<br/>}<br/><br/>BOOL   I5576B50_VerificaCiaSetupExclusao(HUSER hUser, JCHAR *szCO, JCHAR *Imposto)<br/>{<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	KEY1_F5504RR0                dsChaveF5504RR0           = {0};<br/>	HREQUEST                     hF5504RR0                 = (HREQUEST)NULL;   <br/>	F5504RR0					 RegistroF5504RR0          = {0};<br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504RR0, 0, NULL, 0, NULL, &hF5504RR0);<br/>	if (idJDEDBReturn) <br/>	{<br/>		/*Monta Chave*/<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trco,   szCO,		 DIM(dsChaveF5504RR0.trco));				<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trobj, _J("999999"),	 DIM(dsChaveF5504RR0.trobj));		<br/>		jdeStrncpyTerminate(dsChaveF5504RR0.trsub, _J("99999999"), DIM(dsChaveF5504RR0.trsub));		<br/>		ParseNumericString(&dsChaveF5504RR0.tridln, _J("1"));<br/>	} else {<br/>		JDB_CloseTable(hF5504RR0);<br/>		return (FALSE);<br/>	}<br/>	<br/>	jdeStrncpyTerminate(dsChaveF5504RR0.trky,  Imposto, DIM(dsChaveF5504RR0.trky));		<br/>    <br/>	idJDEDBReturn = JDB_FetchKeyed(hF5504RR0,ID_F5504RR0_CHVPRINCIPAL, &dsChaveF5504RR0, 5, &RegistroF5504RR0, FALSE);<br/>    if (idJDEDBReturn) {<br/>		<br/>		JDB_CloseTable(hF5504RR0);<br/>		return (TRUE);<br/>		<br/>	} else {<br/>		<br/>		JDB_CloseTable(hF5504RR0);<br/>		return (FALSE);<br/>		<br/>	}<br/>	<br/>}<br/><br/>BOOL  I5576B50_VerificaPessoaJuridica(HUSER hUser, MATH_NUMERIC Pessoa)<br/>{<br/>	return (TRUE);<br/>}<br/><br/>BOOL I5575B50_SetupInformacoesAdicionais(HUSER hUser, JCHAR *szCO, JCHAR *szMCU, JCHAR *szOBJ, JCHAR *szSUB, F5504PT3 *Registro)<br/>{<br/>	ID							 idJDEDBReturn			   = ER_SUCCESS;<br/>	KEY1_F5504PT3                dsChaveF5504PT3           = {0};<br/>	HREQUEST                     hF5504PT3                 = (HREQUEST)NULL;   <br/>	<br/>	idJDEDBReturn = JDB_OpenTable(hUser, NID_F5504PT3, 0, NULL, 0, NULL, &hF5504PT3);<br/>	if (idJDEDBReturn) <br/>	{<br/>		<br/>		/*Monta Chave*/<br/>		jdeStrncpyTerminate(dsChaveF5504PT3.iaobj, szOBJ,	DIM(dsChaveF5504PT3.iaobj));		<br/>		jdeStrncpyTerminate(dsChaveF5504PT3.iasub, szSUB, DIM(dsChaveF5504PT3.iasub));		     <br/>		jdeStrncpyTerminate(dsChaveF5504PT3.iaco,  szCO,	DIM(dsChaveF5504PT3.iaco));				<br/>		jdeStrncpyTerminate(dsChaveF5504PT3.iamcu, szMCU,	DIM(dsChaveF5504PT3.iamcu));				<br/>		<br/>		idJDEDBReturn = JDB_FetchKeyed(hF5504PT3,ID_F5504PT3_PK, &dsChaveF5504PT3, 4, &Registro, FALSE);<br/>	    if (idJDEDBReturn) <br/>		{<br/>			<br/>			/*jdeStrcpy(Registro., RegistroF5504PT3.iacodtpregra , sizeof(RegistroF5504PT3.iacodtpregra));*/<br/>			<br/>		} else {<br/>			<br/>			/*Monta Chave*/<br/>			jdeStrncpyTerminate(dsChaveF5504PT3.iaobj, szOBJ,	DIM(dsChaveF5504PT3.iaobj));		<br/>			jdeStrncpyTerminate(dsChaveF5504PT3.iasub, szSUB, DIM(dsChaveF5504PT3.iasub));		     <br/>			jdeStrncpyTerminate(dsChaveF5504PT3.iaco,  szCO,	DIM(dsChaveF5504PT3.iaco));				<br/>			jdeStrncpyTerminate(dsChaveF5504PT3.iamcu, _J("         999"),	DIM(_J("         999")));				<br/>			<br/>			idJDEDBReturn = JDB_FetchKeyed(hF5504PT3,ID_F5504PT3_PK, &dsChaveF5504PT3, 4, &Registro, FALSE);<br/>			if (idJDEDBReturn) <br/>			{<br/>				<br/>				/*jdeStrcpy(Tipo, RegistroF5504PT3.iacodtpregra , sizeof(RegistroF5504PT3.iacodtpregra));*/<br/>				<br/>			} else {<br/>				<br/>				/*Monta Chave*/<br/>				jdeStrncpyTerminate(dsChaveF5504PT3.iaobj, szOBJ,	DIM(dsChaveF5504PT3.iaobj));		<br/>				jdeStrncpyTerminate(dsChaveF5504PT3.iasub, szSUB, DIM(dsChaveF5504PT3.iasub));		     <br/>				jdeStrncpyTerminate(dsChaveF5504PT3.iaco,  _J("00999"),	DIM(_J("00999")));				<br/>				jdeStrncpyTerminate(dsChaveF5504PT3.iamcu, _J("         999"),	DIM(_J("         999")));				<br/>				<br/>				idJDEDBReturn = JDB_FetchKeyed(hF5504PT3,ID_F5504PT3_PK, &dsChaveF5504PT3, 4, &Registro, FALSE);<br/>				if (idJDEDBReturn) <br/>				{<br/>					<br/>					/*jdeStrcpy(Tipo, RegistroF5504PT3.iacodtpregra , sizeof(RegistroF5504PT3.iacodtpregra));*/<br/>					<br/>				} else {<br/>					<br/>					JDB_CloseTable(hF5504PT3);<br/>					return (FALSE);<br/>					<br/>				}<br/>				<br/>			}	<br/>			<br/>		}<br/>		<br/>	} else {<br/>		JDB_CloseTable(hF5504PT3);<br/>		return (FALSE);<br/>	}<br/>	<br/>	JDB_CloseTable(hF5504PT3);<br/>	return (TRUE); <br/>}<br/></pre></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: Manutenção Tabela Espelho(PIS/COFINS) - [DeletarTabelaEspelho]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576B50 - Estrutura de Dados da função B5576B50                       </B><BR>BF cErrorCode [ERRC]<BR>BF mnNotaFiscalNumber [BNNF]<BR>BF szNotaFiscalSeries [BSER]<BR>BF mnNextNumber001 [N001]<BR>BF szDocumentType [DCT]<BR>BF mnDocVoucherInvoiceE [DOC]<BR>BF szEdiDocumentType [EDCT]<BR>BF szItemNumber [ITEM]<BR>BF szCompanyKey [KCO]<BR>BF szCostCenter [MCU]<BR>BF szObjectAccount [OBJ]<BR>BF szSubsidiary [SUB]<BR>BF szAccountId [AID]<BR>BF mnAddressNumber [AN8]<BR>BF szNonTaxAuthorTypes [TN]<BR>BF jdNotaFiscalDate [BRADEJ]<BR>BF szSuffixTransactionNature [BSOP]<BR>BF mnAmountNotaFiscalTotals [BVTN]<BR>BF szAlphaSpecData04 [AA04]<BR>BF szDescricaoLinha1 [DSC1]<BR>BF szDescricaoLinha2 [DSC2]<BR>BF szStatus [TRTY]<BR>BF szUserId [USER]<BR>BF szProgramId [PID]<BR>BF szWorkStationId [JOBN]<BR>BF jdDateUpdated [UPMJ]<BR>BF mnTimeLastUpdated [UPMT]<BR>BF szCodeTransactionNature [BRNOP]<BR>BF cEverestEventPoint01 [EV01]<BR>BF cInverteValoresPisCofins [EV01]<BR>BF mnTaxaPis [BPCT]<BR>BF mnTaxaCofins [BPCT]<BR>BF mnFiscalYear1 [FY]<BR>BF mnPeriodNoGeneralLedge [PN]<BR>BF cBloco [EV01]<BR>BF cDebitoCredito [EV01]<BR>BF szDescricaoLinha3 [DSC3]<BR></div></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: Manutenção Tabela Espelho(PIS/COFINS) - [IncluirTabelaEspelho]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576B50 - Estrutura de Dados da função B5576B50                       </B><BR>BF cErrorCode [ERRC]<BR>BF mnNotaFiscalNumber [BNNF]<BR>BF szNotaFiscalSeries [BSER]<BR>BF mnNextNumber001 [N001]<BR>BF szDocumentType [DCT]<BR>BF mnDocVoucherInvoiceE [DOC]<BR>BF szEdiDocumentType [EDCT]<BR>BF szItemNumber [ITEM]<BR>BF szCompanyKey [KCO]<BR>BF szCostCenter [MCU]<BR>BF szObjectAccount [OBJ]<BR>BF szSubsidiary [SUB]<BR>BF szAccountId [AID]<BR>BF mnAddressNumber [AN8]<BR>BF szNonTaxAuthorTypes [TN]<BR>BF jdNotaFiscalDate [BRADEJ]<BR>BF szSuffixTransactionNature [BSOP]<BR>BF mnAmountNotaFiscalTotals [BVTN]<BR>BF szAlphaSpecData04 [AA04]<BR>BF szDescricaoLinha1 [DSC1]<BR>BF szDescricaoLinha2 [DSC2]<BR>BF szStatus [TRTY]<BR>BF szUserId [USER]<BR>BF szProgramId [PID]<BR>BF szWorkStationId [JOBN]<BR>BF jdDateUpdated [UPMJ]<BR>BF mnTimeLastUpdated [UPMT]<BR>BF szCodeTransactionNature [BRNOP]<BR>BF cEverestEventPoint01 [EV01]<BR>BF cInverteValoresPisCofins [EV01]<BR>BF mnTaxaPis [BPCT]<BR>BF mnTaxaCofins [BPCT]<BR>BF mnFiscalYear1 [FY]<BR>BF mnPeriodNoGeneralLedge [PN]<BR>BF cBloco [EV01]<BR>BF cDebitoCredito [EV01]<BR>BF szDescricaoLinha3 [DSC3]<BR></div></div></div></body></html>