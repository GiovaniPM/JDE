<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B5576BX2 - XML Process Inbound  NFe for National - 76B<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: XML Process Inbound  NFe for National - 76B - [ProcessNFeForNA_55]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576BX002 - Process BRNFI-NA transactions - 76B                         </B><BR>BF szVersion [VERS]<BR>BF szFormAction [FATN]<BR>BF idAPIs [GENLNG]<BR>BF idDoc [GENLNG]<BR>BF idDocElement [GENLNG]<BR>BF cModeFinalOrProof_10 [EV01]<BR>BF szEdiUserId [EDUS]<BR>BF szEdiBatchNumber [EDBT]<BR>BF szEdiTransactNumber [EDTN]<BR>BF mnEdiLineNumber [EDLN]<BR>BF szTypeTransaction [TYTN]<BR>BF jdEdiTransmissionDate [EDDT]<BR>BF szTransactionAction [TNAC]<BR>BF szXMLTransactionGroup [55XTG]<BR>BF szXMLInternalReference [55INRE]<BR>BF szXMLAdditionalCode [55XCD]<BR>BF cXMLDocumentStatus [55XDOS]<BR>BF szXMLVersion [55XMLV]<BR>BF szXMLAttributeStrGeneric1 [55XSG1]<BR>BF szXMLAttributeStrGeneric2 [55XSG2]<BR>BF szXMLAttributeStrGeneric3 [55XSG3]<BR>BF mnXMLAttributeNumGeneric1 [55XNG1]<BR>BF mnXMLAttributeNumGeneric2 [55XNG2]<BR>BF mnXMLAttributeNumGeneric3 [55XNG3]<BR>BF jdXMLAttributeDatGeneric1 [55XDG1]<BR>BF jdXMLAttributeDatGeneric2 [55XDG2]<BR>BF jdXMLAttributeDatGeneric3 [55XDG3]<BR>BF idXMLAttributeIntGeneric1 [55XIG1]<BR>BF cXMLAttributeChrGeneric1 [55XCG1]<BR>BF cXMLAttributeChrGeneric2 [55XCG2]<BR>BF cXMLAttributeChrGeneric3 [55XCG3]<BR>BF mnXMLAddressNumber [AN8]<BR>BF szXMLCostCenter [MCU]<BR>BF szXMLCompany [CO]<BR>BF szXMLDocumentType [DCT]<BR>BF szUserReservedCode [URCD]<BR>BF jdUserReservedDate [URDT]<BR>BF mnUserReservedAmount [URAT]<BR>BF mnUserReservedNumber [URAB]<BR>BF szUserReservedReference [URRF]<BR>BF szTransactionOriginator [TORG]<BR>BF cSuppressErrorMessage [SUPPS]<BR>BF szErrorCode [DTAI]<BR>BF szXMLErrorCode [55XECD]<BR>BF cUpdateXMLDocumentYN [EV01]<BR>BF cNewXMLDocStatus [55XDOS]<BR>BF szAuditInfoUserId [USER]<BR>BF szAuditInfoProgramId [PID]<BR>BF szAuditInfoWorkStationId [JOBN]<BR>BF jdAuditInfoDateUpdated [UPMJ]<BR>BF mnAuditInfoTimeLastUpdated [UPMT]<BR></div><pre><div class='dstrmembers'><B>Header File: b5576bx2.h</B><BR></div><br/>/*****************************************************************************<br/> *    Header File:  B5576BX2.h<br/> *<br/> *    Description:  XML Process Inbound  NFe for National - 76B Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 23/02/07    Unknown     Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/><br/>#ifndef __B5576BX2_H<br/>#define __B5576BX2_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf7601b.h&gt<br/>#include &ltf5576b0e.h&gt<br/>#include &ltf5576b2e.h&gt<br/>#include &ltf7601b.h&gt<br/>#include &ltf7611b.h&gt<br/>/*****************************************************************************<br/> * External Business Function Header Inclusions<br/> ****************************************************************************/<br/>#include &ltb76b9001.h&gt<br/>#include &ltn76b9000.h&gt<br/>#include &ltb55xml02.h&gt<br/><br/>/*****************************************************************************<br/> * Global Definitions<br/> ****************************************************************************/<br/><br/><br/>/* HEADER */<br/><br/>#define  XML_HDR02_NAME						_J("eoTransaction-Header")<br/>#define  XML_HDR02_QTY_ELEMENTS				10<br/><br/>#define  XML_HDR02_LegalNumber					_J("LegalNumber                             ")<br/>#define  XML_HDR02_LegalNumberDate				_J("LegalNumberDate                         ")<br/>#define  XML_HDR02_LegalNumberTime				_J("LegalNumberTime                         ")<br/>#define  XML_HDR02_VerificationCode				_J("VerificationCode                        ")<br/>#define  XML_HDR02_DocumentStatus					_J("DocumentStatus                          ")<br/>#define  XML_HDR02_DocumentStatusDate				_J("DocumentStatusDate                      ")<br/>#define  XML_HDR02_ErrorCode						_J("ErrorCode                               ")<br/>#define  XML_HDR02_ErrorDescription				_J("ErrorDescription                        ")<br/>#define  XML_HDR02_ErrorDescriptionExt			_J("ErrorDescriptionExt                     ")<br/>#define  XML_HDR02_ReceiptSerie      			_J("ReceiptSerie                            ")<br/><br/>#define  XML_HDR02_SeqLegalNumber				0<br/>#define  XML_HDR02_SeqLegalNumberDate			1<br/>#define  XML_HDR02_SeqLegalNumberTime			2<br/>#define  XML_HDR02_SeqVerificationCode			3<br/>#define  XML_HDR02_SeqDocumentStatus			4<br/>#define  XML_HDR02_SeqDocumentStatusDate		5<br/>#define  XML_HDR02_SeqErrorCode					6<br/>#define  XML_HDR02_SeqErrorDescription			7<br/>#define  XML_HDR02_SeqErrorDescriptionExt		8<br/>#define  XML_HDR02_SeqReceiptSerie				9<br/><br/><br/>/* File Structure */<br/><br/>typedef struct<br/>{<br/><br/>  /* F7601B Key */<br/><br/>  MATH_NUMERIC      mnNotaFiscalNumber;                  <br/>  JCHAR              szNotaFiscalSeries[3];               <br/>  MATH_NUMERIC      mnNextNumber001;                     <br/>  JCHAR              szDocumentType[3];      <br/>  <br/>  /* Internal Reference */<br/><br/>  JCHAR              szNFEInternalReferenceOfXML[61]; <br/><br/>  /* F5576B0E */<br/><br/><br/>  HREQUEST		    hReqF5576B0E;<br/>  BOOL				bF5576B0E_OpenYN;<br/>  F5576B0E			dsF5576B0E; <br/>  KEY1_F5576B0E		dsF5576B0EKey1;<br/><br/><br/>  /* F5576B2E */<br/><br/><br/>  HREQUEST		    hReqF5576B2E;<br/>  BOOL				bF5576B2E_OpenYN;<br/>  F5576B2E			dsF5576B2E; <br/>  KEY4_F5576B2E		dsF5576B2EKey2;<br/><br/>  /* F7601B */<br/><br/><br/>  HREQUEST		    hReqF7601B;<br/>  BOOL				bF7601B_OpenYN;<br/>  F7601B			dsF7601B; <br/>  KEY1_F7601B		dsF7601BKey1;<br/><br/>  /* F7611B */<br/><br/><br/>  HREQUEST		    hReqF7611B;<br/>  BOOL				bF7611B_OpenYN;<br/>  F7611B			dsF7611B; <br/>  KEY1_F7611B		dsF7611BKey1;<br/>  KEY1_F7611B		dsF7611BKey2;<br/><br/><br/>  /* PO */<br/><br/>  JCHAR              szPOStatusCodeNextFrom[4];             <br/>  JCHAR              szPOStatusCodeNextTo[4];               <br/>  JCHAR              szPOOverrideStatusCodeSO[4];           <br/>  JCHAR              szPOOverrideStatusCodeNF[4];           <br/>  JCHAR              cPOPreventNextStatUpdate; <br/><br/><br/>  /* Next Status Validation  */<br/><br/><br/>  BOOL				bUpdateF7611BAndF7601B;<br/><br/>  BOOL				bLegalNumberInformed;<br/><br/>  <br/>} DSWorkingVariables02, *LPDSWorkingVariables02;<br/><br/><br/>typedef struct<br/>{<br/><br/>	ID                idAPIs;                              <br/>	ID                idDoc;                               <br/>	ID                idRootElement; <br/>	ID				  idHeaderElement; <br/>	ID				  idDetailElement; <br/>	ID				  idNFLineElement;<br/>	MATH_NUMERIC      mnNFLineQtyLines; <br/>	JCHAR			  szElementName[257];<br/>	JCHAR			  szElementValue[257];<br/>	                    <br/>	  <br/>} DSXMLfields02, *LPDSXMLfields02;<br/><br/><br/>/* Header */<br/><br/>typedef struct tagHeaderElementName02<br/>{<br/>  JCHAR             szElementName[41];<br/>} DSHeaderElementName02, FAR *LPDSHeaderElementName02;<br/><br/><br/>typedef struct tagHeaderMandatory02<br/>{<br/>  BOOL             bMandatory;<br/>} DSHeaderMandatory02, FAR *LPDSHeaderMandatory02;<br/><br/><br/>typedef struct tagHeaderElementValue02<br/>{<br/>  JCHAR             szElementValue[257];<br/>} DSHeaderElementValue02, FAR *LPDSHeaderElementValue02;<br/><br/><br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: Bus. Function DS DE76BX01<br/> *    Template ID:   DE76BX01<br/> *    Generated:     Mon Mar 05 08:04:07 2007<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_DE76BX01<br/>#define DATASTRUCTURE_DE76BX01<br/><br/>typedef struct tagDSDE76BX01<br/>{<br/>  JCHAR              szElementName[257];                  <br/>  JCHAR              szElementValue[257];                 <br/>} DSDE76BX01, *LPDSDE76BX01;<br/><br/>#define IDERRszElementName_1                      1L<br/>#define IDERRszElementValue_2                     2L<br/><br/>#endif<br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: XML Element Error Data Structure - 76B<br/> *    Template ID:   DE76BX02<br/> *    Generated:     Wed Mar 07 11:49:40 2007<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_DE76BX02<br/>#define DATASTRUCTURE_DE76BX02<br/><br/>typedef struct tagDSDE76BX02<br/>{<br/>  JCHAR              szObjectName[11];                    <br/>} DSDE76BX02, *LPDSDE76BX02;<br/><br/>#define IDERRszObjectName_3                       3L<br/><br/>#endif<br/><br/><br/><br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: PO TRANSACTION BRNF-NA - 76B<br/> *    Template ID:   T5576BX002<br/> *    Generated:     Tue Mar 13 13:16:29 2007<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_T5576BX002<br/>#define DATASTRUCTURE_T5576BX002<br/><br/>typedef struct tagDST5576BX002<br/>{<br/>  JCHAR              szStatusCodeNextFrom[4];             <br/>  JCHAR              szStatusCodeNextTo[4];               <br/>  JCHAR              szOverrideStatusCodeSO[4];           <br/>  JCHAR              szOverrideStatusCodeNF[4];           <br/>  JCHAR              cPreventNextStatUpdate;              <br/>} DST5576BX002, *LPDST5576BX002;<br/><br/>#define IDERRszStatusCodeNextFrom_1               1L<br/>#define IDERRszStatusCodeNextTo_2                 2L<br/>#define IDERRszOverrideStatusCodeSO_3             3L<br/>#define IDERRszOverrideStatusCodeNF_4             4L<br/>#define IDERRcPreventNextStatUpdate_5             5L<br/><br/>#endif<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: Process BRNFI-NA transactions - 76B<br/> *    Template ID:   D5576BX002<br/> *    Generated:     Fri Sep 03 16:38:13 2010<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D5576BX002<br/>#define DATASTRUCTURE_D5576BX002<br/><br/>typedef struct tagDSD5576BX002<br/>{<br/>  JCHAR              szVersion[11];                       <br/>  JCHAR              szFormAction[4];                     <br/>  ID                idAPIs;                              <br/>  ID                idDoc;                               <br/>  ID                idDocELement;                        <br/>  JCHAR              cModeFinalOrProof_10;                <br/>  JCHAR              szEdiUserId[11];                     <br/>  JCHAR              szEdiBatchNumber[16];                <br/>  JCHAR              szEdiTransactNumber[23];             <br/>  MATH_NUMERIC      mnEdiLineNumber;                     <br/>  JCHAR              szTypeTransaction[9];                <br/>  JDEDATE           jdEdiTransmissionDate;               <br/>  JCHAR              szTransactionAction[3];              <br/>  JCHAR              szXMLTransactionGroup[11];           <br/>  JCHAR              szXMLInternalReference[61];          <br/>  JCHAR              szXMLAditionalCode[11];              <br/>  JCHAR              cXMLDocumentStatus;                  <br/>  JCHAR              szXMLVersion[5];                     <br/>  JCHAR              szXMLAttributeStrGeneric1[61];       <br/>  JCHAR              szXMLAttributeStrGeneric2[61];       <br/>  JCHAR              szXMLAttributeStrGeneric3[61]; //Estava com tamanho 101.     <br/>  MATH_NUMERIC      mnXMLAttributeNumGeneric1;           <br/>  MATH_NUMERIC      mnXMLAttributeNumGeneric2;           <br/>  MATH_NUMERIC      mnXMLAttributeNumGeneric3;           <br/>  JDEDATE           jdXMLAttributeDatGeneric1;           <br/>  JDEDATE           jdXMLAttributeDatGeneric2;           <br/>  JDEDATE           jdXMLAttributeDatGeneric3;           <br/>  ID                idXMLAttributeIntGeneric1;           <br/>  JCHAR              cXMLAttributeChrGeneric1;            <br/>  JCHAR              cXMLAttributeChrGeneric2;            <br/>  JCHAR              cXMLAttributeChrGeneric3;            <br/>  MATH_NUMERIC      mnXMLAddressNumber;                  <br/>  JCHAR              szXMLCostCenter[13];                 <br/>  JCHAR              szXMLCompany[6];                     <br/>  JCHAR              szXMLDocumentType[3];                <br/>  JCHAR              szUserReservedCode[3];               <br/>  JDEDATE           jdUserReservedDate;                  <br/>  MATH_NUMERIC      mnUserReservedAmount;                <br/>  MATH_NUMERIC      mnUserReservedNumber;                <br/>  JCHAR              szUserReservedReference[16];         <br/>  JCHAR              szTransactionOriginator[11];         <br/>  JCHAR              cSuppressErrorMessage;               <br/>  JCHAR              szErrorCode[11];                     <br/>  JCHAR              szXMLErrorCode[4];                   <br/>  JCHAR              cUpdateXMLDocumentYN;                <br/>  JCHAR              cNewXMLDocStatus;                    <br/>  JCHAR              szAuditInfoUserId[11];               <br/>  JCHAR              szAuditInfoProgramId[11];            <br/>  JCHAR              szAuditInfoWorkStationId[11];        <br/>  JDEDATE           jdAuditInfoDateUpdated;              <br/>  MATH_NUMERIC      mnAuditInfoTimeLastUpdated;          <br/>} DSD5576BX002 , *PDSD5576BX002 , *LPDSD5576BX002;<br/><br/>#define IDERRszVersion_1                          1L<br/>#define IDERRszFormAction_2                       2L<br/>#define IDERRidAPIs_3                             3L<br/>#define IDERRidDoc_4                              4L<br/>#define IDERRidDocELement_5                       5L<br/>#define IDERRcModeFinalOrProof_10_6               6L<br/>#define IDERRszEdiUserId_7                        7L<br/>#define IDERRszEdiBatchNumber_8                   8L<br/>#define IDERRszEdiTransactNumber_9                9L<br/>#define IDERRmnEdiLineNumber_10                   10L<br/>#define IDERRszTypeTransaction_12                 12L<br/>#define IDERRjdEdiTransmissionDate_13             13L<br/>#define IDERRszTransactionAction_14               14L<br/>#define IDERRszXMLTransactionGroup_15             15L<br/>#define IDERRszXMLInternalReference_16            16L<br/>#define IDERRszXMLAdditionalCode_17               17L<br/>#define IDERRcXMLDocumentStatus_18                18L<br/>#define IDERRszXMLVersion_19                      19L<br/>#define IDERRszXMLAttributeStrGeneric1_20         20L<br/>#define IDERRszXMLAttributeStrGeneric2_21         21L<br/>#define IDERRszXMLAttributeStrGeneric3_22         22L<br/>#define IDERRmnXMLAttributeNumGeneric1_23         23L<br/>#define IDERRmnXMLAttributeNumGeneric2_24         24L<br/>#define IDERRmnXMLAttributeNumGeneric3_25         25L<br/>#define IDERRjdXMLAttributeDatGeneric1_26         26L<br/>#define IDERRjdXMLAttributeDatGeneric2_27         27L<br/>#define IDERRjdXMLAttributeDatGeneric3_28         28L<br/>#define IDERRidXMLAttributeIntGeneric1_29         29L<br/>#define IDERRcXMLAttributeChrGeneric1_30          30L<br/>#define IDERRcXMLAttributeChrGeneric2_31          31L<br/>#define IDERRcXMLAttributeChrGeneric3_32          32L<br/>#define IDERRmnXMLAddressNumber_33                33L<br/>#define IDERRszXMLCostCenter_34                   34L<br/>#define IDERRszXMLCompany_35                      35L<br/>#define IDERRszXMLDocumentType_36                 36L<br/>#define IDERRszUserReservedCode_37                37L<br/>#define IDERRjdUserReservedDate_38                38L<br/>#define IDERRmnUserReservedAmount_39              39L<br/>#define IDERRmnUserReservedNumber_40              40L<br/>#define IDERRszUserReservedReference_41           41L<br/>#define IDERRszTransactionOriginator_42           42L<br/>#define IDERRcSuppressErrorMessage_43             43L<br/>#define IDERRszErrorCode_44                       44L<br/>#define IDERRszXMLErrorCode_45                    45L<br/>#define IDERRcUpdateXMLDocumentYN_46              46L<br/>#define IDERRcNewXMLDocStatus_47                  47L<br/>#define IDERRszAuditInfoUserId_48                 48L<br/>#define IDERRszAuditInfoProgramId_49              49L<br/>#define IDERRszAuditInfoWorkStationId_50          50L<br/>#define IDERRjdAuditInfoDateUpdated_51            51L<br/>#define IDERRmnAuditInfoTimeLastUpdated_52        52L<br/><br/>/*<br/>#endif<br/>*/<br/>/*********************************************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: XML Get Element By Tag Name - G70<br/> *    Template ID:   D76BXML1K<br/> *    Generated:     Thu Jul 17 14:04:05 2008<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *<br/> *********************************************************************/<br/>/*<br/>#ifndef DATASTRUCTURE_D55XML01K<br/>#define DATASTRUCTURE_D55XML01K<br/><br/>typedef struct tagDSD55XML01K<br/>{<br/>  ID            idAPIs;                    <br/>  ID            idDoc;                     <br/>  ID            idFromElement;             <br/>  JCHAR          szElementName[257];        <br/>  JCHAR          cReturnValueYN;            <br/>  JCHAR          cIsIDFromElementAnArrayYN; <br/>  MATH_NUMERIC  mnFromElementNumber;       <br/>  ID            idArrayElements;           <br/>  MATH_NUMERIC  mnNumberOfElements;        <br/>  JCHAR          szElementValue[257];       <br/>  JCHAR          cSuppressErrorMessage;     <br/>  JCHAR          szErrorMessageID[11];      <br/>  JCHAR          cErrorCode;                <br/>} DSD55XML01K , *PDSD55XML01K , *LPDSD55XML01K;<br/>  <br/>#define IDERRidAPIs_1                             1L<br/>#define IDERRidDoc_2                              2L<br/>#define IDERRidFromElement_3                      3L<br/>#define IDERRszElementName_4                      4L<br/>#define IDERRcReturnValueYN_5                     5L<br/>#define IDERRcIsIDFromElementAnArrayYN_6          6L<br/>#define IDERRmnFromElementNumber_7                7L<br/>#define IDERRidArrayElements_8                    8L<br/>#define IDERRmnNumberOfElements_9                 9L<br/>#define IDERRszElementValue_10                    10L<br/>#define IDERRcSuppressErrorMessage_11             11L<br/>#define IDERRszErrorMessageID_12                  12L<br/>#define IDERRcErrorCode_13                        13L<br/><br/>#endif<br/><br/>/*********************************************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: XML Free Array of Elements - G70<br/> *    Template ID:   D76BXML1L<br/> *    Generated:     Thu Jul 17 14:04:05 2008<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *<br/> *********************************************************************/<br/>/*<br/>#ifndef DATASTRUCTURE_D55XML01L<br/>#define DATASTRUCTURE_D55XML01L<br/><br/>typedef struct tagDSD55XML01L<br/>{<br/>  ID            idAPIs;                    <br/>  ID            idDoc;                     <br/>  ID            idArrayElements;           <br/>  MATH_NUMERIC  mnNumberOfElements;        <br/>  JCHAR          cSuppressErrorMessage;     <br/>  JCHAR          szErrorMessageID[11];      <br/>  JCHAR          cErrorCode;                <br/>} DSD55XML01L , *PDSD55XML01L , *LPDSD55XML01L;<br/><br/>#define IDERRidAPIs_1                             1L<br/>#define IDERRidDoc_2                              2L<br/>#define IDERRidArrayElements_8                    8L<br/>#define IDERRmnNumberOfElements_9                 9L<br/>#define IDERRcSuppressErrorMessage_11             11L<br/>#define IDERRszErrorMessageID_12                  12L<br/>#define IDERRcErrorCode_13                        13L<br/>*/<br/>#endif<br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI ProcessNFeForNA_55              (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS);<br/><br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/><br/><br/>BOOL I76BX002_GetElement(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, JCHAR * szHeaderElementName, LPDSXMLfields02 lpdsXML, LPID lpidElement);<br/><br/>BOOL I76BX002_GetElements(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, ID idRoot, JCHAR * szElementName, LPDSXMLfields02 lpdsXML, LPID lpidElement, LPMATH_NUMERIC lpmnQtyElements);<br/><br/>BOOL I76BX002_GetValueFromElementName(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, ID idFromParent,LPMATH_NUMERIC lpmnElementSequence, JCHAR * szElementName, LPDSXMLfields02 lpdsXML);<br/><br/>BOOL I76BX002_ReleaseArrayOfElements(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPID lpidArrayElements, LPMATH_NUMERIC lpmnNumberOfElements, LPDSXMLfields02 lpdsXML);<br/><br/>BOOL I76BX002_UpdateHeaderTransactionSP(	LPBHVRCOM lpBhvrCom, <br/>											LPVOID lpVoid, <br/>											HUSER hUser, <br/>											LPDSD5576BX002 lpDS, <br/>											LPDSWorkingVariables02 lpdsWF,<br/>											LPDSHeaderElementName02 lpdsHeaderElements,   <br/>											LPDSHeaderElementValue02 lpdsHeaderValues);<br/><br/><br/>void I76BX002_SetXMLError(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS, JCHAR * szErrorCode, JCHAR * szXMLErrorCode, JCHAR * szElementName, JCHAR * szElementValue);<br/>void I76BX002_SetTableError(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS, JCHAR * szErrorCode, JCHAR * szXMLErrorCode, JCHAR * szFileName);<br/><br/>BOOL I76BX002_ConvertTimeFromString(LPMATH_NUMERIC lpmnTime, JCHAR * szTime);<br/><br/>BOOL I76BX002_IsDuplicateLegalNFNumber(	LPBHVRCOM lpBhvrCom, <br/>										LPVOID lpVoid, <br/>										HUSER hUser, <br/>										LPDSD5576BX002 lpDS, <br/>										LPMATH_NUMERIC lpmnNFLegalNumber,<br/>										BOOL				*lpbDup);<br/><br/><br/>BOOL I76BX002_SaveHistory			(	LPBHVRCOM lpBhvrCom, <br/>										LPVOID lpVoid, <br/>										HUSER hUser, <br/>										LPDSD5576BX002 lpDS,<br/>										LPDSWorkingVariables02 lpdsWF);<br/><br/>#endif    /* __B5576BX2_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b5576bx2.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b5576bx2_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b5576bx2<br/> *<br/> *    Description:  XML Process Inbound  NFe for National - 76B Source File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 23/02/07    J.Godino    8371560 - Created  <br/> *   Author 05/04/07    J.Godino    Issue Date Included <br/> *          07/11/07    J.Godino    8535851 - We included the Transaction Type in F5576B0E<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb5576bx2.h&gt<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  ProcessNFeForNA_76B<br/> *<br/> *        Description:  Process NFe Inbound for National - 76B<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD5576BX002      lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI ProcessNFeForNA_55 (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID                idReturn       = ER_SUCCESS;<br/>	HUSER             hUser          = (HUSER)NULL;<br/>	ID                idJDBResult    = JDEDB_PASSED;<br/>	ID				  idReturnCode	 = ER_SUCCESS;<br/><br/>	BOOL			   bErrorFound = FALSE;<br/>	BOOL			   bWarningFound = FALSE;<br/>	BOOL			   bErrorFoundInHeader = FALSE;<br/>	<br/>	MATH_NUMERIC		mnOne;<br/>	MATH_NUMERIC		mnZero;<br/><br/><br/>	MATH_NUMERIC		mnLineSequence;<br/>	MATH_NUMERIC		mnCurrentElementSequence;<br/><br/><br/>	DSHeaderElementName02 	szHeaderArrayOfElements[XML_HDR02_QTY_ELEMENTS]	= {	{XML_HDR02_LegalNumber},<br/>																				{XML_HDR02_LegalNumberDate},<br/>																				{XML_HDR02_LegalNumberTime},<br/>																				{XML_HDR02_VerificationCode},<br/>																				{XML_HDR02_DocumentStatus},<br/>																				{XML_HDR02_DocumentStatusDate},<br/>																				{XML_HDR02_ErrorCode},<br/>																				{XML_HDR02_ErrorDescription},<br/>																				{XML_HDR02_ErrorDescriptionExt},<br/>																				{XML_HDR02_ReceiptSerie} };<br/><br/>	DSHeaderMandatory02 	    bHeaderMandatoryElement[XML_HDR02_QTY_ELEMENTS]	= {		{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE},<br/>																					{TRUE}};<br/><br/>	DSHeaderElementValue02 	szHeaderArrayOfElementsValues[XML_HDR02_QTY_ELEMENTS]	= {0};<br/><br/>	int					iElement= 0;<br/>	<br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/><br/><br/>	DSWorkingVariables02		dsWorkFields = {0};<br/>	DSXMLfields02				dsXML = {0};<br/><br/>	DSD76B9001B				dsD76B9001B = {0};				/* Scrub Internal Reference (ScrubXMLInternalReference_76B) */<br/>	DSD76B9000A				dsD76B9000A = {0};				/* Validate Next Status (ValidateNFStatus_76B) */<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/><br/>	LPDST5576BX002		lpdsT5576BX002 = NULL; <br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD5576BX002)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   idJDBResult = JDB_InitBhvr((void *)lpBhvrCom, &hUser,<br/>                           (JCHAR *)NULL, JDEDB_COMMIT_AUTO);<br/><br/>   if (idJDBResult == JDEDB_FAILED)<br/>   {<br/>      jdeErrorSet(lpBhvrCom, lpVoid, (ID)0, _J("078S"), (LPVOID)NULL);<br/>      return ER_ERROR;<br/>   }<br/><br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>   ParseNumericString(&mnOne, _J("1"));<br/>   ParseNumericString(&mnZero, _J("0"));<br/>   ParseNumericString(&mnLineSequence, _J("0"));<br/>   ParseNumericString(&mnCurrentElementSequence, _J("0"));<br/><br/>   dsWorkFields.hReqF5576B0E	 = NULL;<br/>   dsWorkFields.bF5576B0E_OpenYN = FALSE;<br/><br/><br/>   /* Update Output Variable */<br/>   /* ====================== */<br/><br/>   jdeStrcpy(lpDS-&gtszErrorCode, _J(""));<br/>   jdeStrcpy(lpDS-&gtszXMLErrorCode, _J(""));<br/>   lpDS-&gtcUpdateXMLDocumentYN = _J('N');<br/>   lpDS-&gtcNewXMLDocStatus = _J('N');<br/><br/><br/><br/>   /* Scrub Internal Reference (ScrubXMLInternalReference_76B) */<br/>   /* ======================================================== */<br/><br/>   jdeStrcpy(dsD76B9001B.szNFEInternalReferenceOfXML,lpDS-&gtszXMLInternalReference);<br/>   dsD76B9001B.cSuppressErrorMessage = _J('1');<br/><br/>   jdeTraceSz1(NULL, _J("B5576BX2 - Call BSFN Scrub Internal Reference: %ls"),lpDS-&gtszXMLInternalReference);<br/><br/>   idReturnCode= jdeCallObject  (_J("ScrubXMLInternalReference_76B"),<br/>			  NULL,<br/>			  lpBhvrCom, <br/>			  lpVoid, <br/>			  (LPVOID) &dsD76B9001B, <br/>			  (CALLMAP *) NULL, <br/>			  (int) 0, <br/>			  (JCHAR *) NULL, <br/>			  (JCHAR *) NULL, <br/>			  (int) 0 ) ;<br/><br/><br/>	if(idReturnCode == ER_SUCCESS)<br/>	{<br/><br/>		jdeStrcpy(dsWorkFields.szDocumentType, dsD76B9001B.szDocumentType);<br/>		jdeStrcpy(dsWorkFields.szNotaFiscalSeries, dsD76B9001B.szNotaFiscalSeries);<br/>		MathCopy(&dsWorkFields.mnNotaFiscalNumber,&dsD76B9001B.mnNotaFiscalNumber);<br/><br/><br/>		if((MathZeroTest(&lpDS-&gtmnXMLAttributeNumGeneric1)) != 0)<br/>		{<br/>			MathCopy(&dsWorkFields.mnNextNumber001,&lpDS-&gtmnXMLAttributeNumGeneric1);<br/>			jdeTraceSz1(NULL, _J("B5576BX2 - Call BSFN Scrub Internal Reference %ls suscessfully"),lpDS-&gtszXMLInternalReference);<br/>		}<br/>		else<br/>		{<br/>			bErrorFound = TRUE;<br/>			jdeTraceSz(NULL, _J("B5576BX2 - ERROR XML Attribute Num Generic 1 is empty"));<br/>		}<br/><br/>	}<br/>	else<br/>	{<br/><br/>		bErrorFound = TRUE;<br/>		jdeTraceSz1(NULL, _J("B5576BX2 - ERROR Call BSFN Scrub Internal Reference: %ls"),lpDS-&gtszXMLInternalReference);<br/><br/>		<br/><br/>	}<br/><br/>	/* Set Error */<br/>	/* --------- */<br/>	<br/>	if(bErrorFound)<br/>	{<br/><br/>		/* The Transaction has an invalid NF references */<br/>		/* -------------------------------------------- */<br/>		<br/>		jdeStrcpy(lpDS-&gtszErrorCode, _J("B76EX02"));<br/>		jdeStrcpy(lpDS-&gtszXMLErrorCode, _J("101"));<br/>		jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, (LPVOID) NULL);<br/>		<br/>		<br/><br/>	}<br/><br/><br/>   /* Open Tables */<br/>   /* =========== */<br/><br/>	if(!bErrorFound)<br/>	{<br/><br/>		idJDBResult = JDB_OpenTable(hUser, <br/>									NID_F5576B0E, <br/>									ID_F5576B0E_BNNF_BSER_N001_DCT, <br/>									NULL, <br/>									0, <br/>									NULL, <br/>									&dsWorkFields.hReqF5576B0E);<br/><br/><br/>		if (idJDBResult != JDEDB_PASSED)<br/>		{<br/><br/>			I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX03"), _J("102"),NID_F5576B0E);<br/><br/>			bErrorFound = TRUE;<br/><br/>		}<br/>		else<br/>		{<br/><br/>			dsWorkFields.bF5576B0E_OpenYN = TRUE;<br/><br/>		}<br/><br/>	}<br/><br/><br/><br/><br/>   /* Validate NF Electronic */<br/>   /* ====================== */<br/><br/><br/>	if(!bErrorFound)<br/>	{<br/><br/>		<br/>			jdeTraceSz(NULL, _J("B5576BX2 - Validate NF Electronic"));<br/>	<br/>			/* Fetch Record */<br/>			/* ------------ */<br/><br/><br/>			/* Nota Fiscal Number */<br/><br/>			MathCopy (&dsWorkFields.dsF5576B0EKey1.fhbnnf, &dsWorkFields.mnNotaFiscalNumber);<br/><br/>			/* Nota Fiscal Serie */<br/><br/>			jdeStrcpy (dsWorkFields.dsF5576B0EKey1.fhbser, dsWorkFields.szNotaFiscalSeries);<br/><br/>			/* Nota Fiscal Next Number */<br/>		<br/>			MathCopy (&dsWorkFields.dsF5576B0EKey1.fhn001, &dsWorkFields.mnNextNumber001);<br/><br/>			/* Doc Type */<br/><br/>			jdeStrcpy (dsWorkFields.dsF5576B0EKey1.fhdct, dsWorkFields.szDocumentType);<br/><br/><br/>			idJDBResult = JDB_FetchKeyed(dsWorkFields.hReqF5576B0E,<br/>	        							(ID) ID_F5576B0E_BNNF_BSER_N001_DCT, <br/>										(void *)(&dsWorkFields.dsF5576B0EKey1), <br/>										(short)(4),<br/>										(void *)(&dsWorkFields.dsF5576B0E),<br/>										FALSE);<br/><br/><br/><br/>			if (idJDBResult != JDEDB_PASSED)<br/>			{<br/><br/>				jdeTraceSz(NULL, _J("B5576BX2 - ERROR Fetch F5576B0E failed"));<br/>				I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX04"), _J("103"),NID_F5576B0E);<br/>				bErrorFound = TRUE;	<br/><br/>			}<br/><br/><br/><br/><br/>	}<br/><br/><br/><br/><br/>   /* Retrieve the Processing Options */<br/>   /* =============================== */<br/><br/><br/>	if(!bErrorFound)<br/>	{<br/><br/>		jdeTraceSz1(NULL, _J("B5576BX2 - Get PO P5576BX2 Version: %ls"),lpDS-&gtszVersion);<br/><br/>		/* FP */<br/>		lpdsT5576BX002 = (LPDST5576BX002) AllocatePOVersionData(	(HUSER) hUser,<br/>                                           						_J("P5576BX2"), <br/>																lpDS-&gtszVersion,<br/>																(unsigned int)sizeof(DST5576BX002));<br/><br/><br/>		if ((lpdsT5576BX002 == (LPDST5576BX002) NULL) )<br/>		{<br/><br/>			if(jdeStrcmp(lpDS-&gtszVersion, (JCHAR *)(_J("ZJDE0001")))!=0)<br/>			{<br/>				jdeTraceSz(NULL, _J("B5576BX2 - Get PO P5576BX2 Version: ZJDE0001"));<br/>				<br/>				lpdsT5576BX002 = (LPDST5576BX002) AllocatePOVersionData(	(HUSER) hUser,<br/>																		_J("P5576BX2"), <br/>																		_J("ZJDE0001"),<br/>																		(unsigned int)sizeof(DST5576BX002));<br/>				<br/>				if (lpdsT5576BX002 == (LPDST5576BX002) NULL)<br/>				{<br/>					bErrorFound = TRUE;<br/>				}<br/><br/>			}<br/>			else<br/>			{<br/><br/>				bErrorFound = TRUE;<br/><br/><br/>			}<br/><br/>		}<br/><br/><br/>		if(!bErrorFound)<br/>		{<br/><br/>			jdeTraceSz(NULL, _J("B5576BX2 - Get PO P5576BX2 suscessfully"));<br/>			<br/>			jdeStrncpy (dsWorkFields.szPOStatusCodeNextFrom, lpdsT5576BX002-&gtszStatusCodeNextFrom, DIM(dsWorkFields.szPOStatusCodeNextFrom));<br/>			jdeStrncpy (dsWorkFields.szPOStatusCodeNextTo, lpdsT5576BX002-&gtszStatusCodeNextTo, DIM(dsWorkFields.szPOStatusCodeNextTo));<br/>			jdeStrncpy (dsWorkFields.szPOOverrideStatusCodeSO, lpdsT5576BX002-&gtszOverrideStatusCodeSO, DIM(dsWorkFields.szPOOverrideStatusCodeSO));<br/>			jdeStrncpy (dsWorkFields.szPOOverrideStatusCodeNF, lpdsT5576BX002-&gtszOverrideStatusCodeNF, DIM(dsWorkFields.szPOOverrideStatusCodeNF));<br/>			dsWorkFields.cPOPreventNextStatUpdate = lpdsT5576BX002-&gtcPreventNextStatUpdate;<br/><br/><br/>			jdeTraceSz1(NULL, _J("B5576BX2 - szPOStatusCodeNextFrom: %ls"),dsWorkFields.szPOStatusCodeNextFrom);<br/>			jdeTraceSz1(NULL, _J("B5576BX2 - szPOStatusCodeNextTo: %ls"),dsWorkFields.szPOStatusCodeNextTo);<br/>			jdeTraceSz1(NULL, _J("B5576BX2 - szPOOverrideStatusCodeSO: %ls"),dsWorkFields.szPOOverrideStatusCodeSO);<br/>			jdeTraceSz1(NULL, _J("B5576BX2 - szPOOverrideStatusCodeNF: %ls"),dsWorkFields.szPOOverrideStatusCodeNF);<br/>			jdeTraceSz1(NULL, _J("B5576BX2 - cPOPreventNextStatUpdate: %lc"),dsWorkFields.cPOPreventNextStatUpdate);<br/>			<br/>		}<br/>		else<br/>		{<br/><br/>			jdeTraceSz(NULL, _J("B5576BX2 - ERROR with PO P76BX001"));<br/>			<br/>			jdeStrcpy(lpDS-&gtszErrorCode, _J("B76EX05"));<br/>			jdeStrcpy(lpDS-&gtszXMLErrorCode, _J("104"));<br/>			jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, (LPVOID) NULL);<br/>		<br/>		}<br/><br/><br/>		if ((lpdsT5576BX002 != (LPDST5576BX002) NULL))<br/>		{<br/><br/>			FreePODataStructure((void *)lpdsT5576BX002);<br/><br/>		}<br/><br/><br/>	}<br/><br/><br/><br/>   /* Validate Next Status */<br/>   /* ==================== */<br/><br/><br/>	if(!bErrorFound)<br/>	{<br/><br/><br/>		jdeTraceSz(NULL, _J("B5576BX2 - Validate Next Status"));<br/><br/>		/* Validate Header */<br/>			<br/>		dsD76B9000A.cValidateHeaderOrDetail_HD = _J('H');<br/><br/>		/* Validate Only */<br/><br/>		dsD76B9000A.cUpdateStatusYN = _J('N');<br/><br/>		/* Nota Fiscal Number */<br/><br/>		MathCopy (&dsD76B9000A.mnNotaFiscalNumber, &dsWorkFields.mnNotaFiscalNumber);<br/><br/>		/* Nota Fiscal Serie */<br/><br/>		jdeStrcpy (dsD76B9000A.szNotaFiscalSeries, dsWorkFields.szNotaFiscalSeries);<br/><br/>		/* Nota Fiscal Next Number */<br/>		<br/>		MathCopy (&dsD76B9000A.mnNextNumber001, &dsWorkFields.mnNextNumber001);<br/><br/>		/* Doc Type */<br/><br/>		jdeStrcpy (dsD76B9000A.szDocumentType, dsWorkFields.szDocumentType);<br/><br/>		/* Unique Key Internal */<br/><br/>		ZeroMathNumeric(&dsD76B9000A.mnUniqueKeyIDInternal);<br/><br/><br/>		/* Status Code From */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNextFrom, dsWorkFields.szPOStatusCodeNextFrom);<br/><br/>		/* Status Code From */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNextTo, dsWorkFields.szPOStatusCodeNextTo);<br/><br/>		/* Status Code SO */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNext_SO, dsWorkFields.szPOOverrideStatusCodeSO);<br/><br/>		/* Status Code NF */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNext_NF, dsWorkFields.szPOOverrideStatusCodeNF);<br/><br/>		/* Prevent Next Status Update: Value '1' is not update next status */<br/><br/>		dsD76B9000A.cPreventNextStatUpdate = dsWorkFields.cPOPreventNextStatUpdate;<br/><br/>		<br/>		idReturnCode= jdeCallObject  (_J("ValidateNFStatus_76B"),<br/>										NULL,<br/>										lpBhvrCom, <br/>						 			    lpVoid, <br/>										(LPVOID) &dsD76B9000A, <br/>										(CALLMAP *) NULL, <br/>										(int) 0, <br/>										(JCHAR *) NULL, <br/>										(JCHAR *) NULL, <br/>										(int) 0 ) ;<br/><br/><br/>		if(dsD76B9000A.cErrorCode != _J('0'))<br/>		{<br/><br/>			jdeTraceSz(NULL, _J("B5576BX2 - WARNING invalid status"));<br/>			jdeStrcpy(lpDS-&gtszErrorCode, _J("B76WX06"));<br/>			jdeStrcpy(lpDS-&gtszXMLErrorCode, _J("105"));<br/>			jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, (LPVOID) NULL);<br/>			bWarningFound = TRUE;<br/>			<br/>		<br/>		}<br/>		else<br/>		{<br/><br/>			dsWorkFields. bUpdateF7611BAndF7601B = TRUE;<br/>			jdeTraceSz(NULL, _J("B5576BX2 - Valid Status"));<br/><br/>		}<br/><br/><br/>	}<br/><br/><br/><br/><br/>   /* Get Transaction Information from XML Document */<br/>   /* ============================================= */<br/><br/><br/>	if(!bErrorFound)<br/>	{<br/><br/>		/* Init ID */<br/>		/* ------- */<br/><br/>		dsXML.idAPIs = lpDS-&gtidAPIs;<br/>		dsXML.idDoc = lpDS-&gtidDoc;<br/>		dsXML.idRootElement = lpDS-&gtidDocELement;<br/><br/>		/* ======================================================================================================== */<br/>		/* BEGIN Get Header (eoTransaction-header)                                                                  */<br/>		/* ======================================================================================================== */<br/><br/>		<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Get Header Element (eoTransaction-header)                                              */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/>		bErrorFoundInHeader = FALSE;<br/><br/>		jdeStrcpy(dsXML.szElementName,XML_HDR02_NAME);<br/>		jdeStripTrailingBlanks(dsXML.szElementName);<br/>		bErrorFound = I76BX002_GetElement(lpBhvrCom,lpVoid, dsXML.szElementName, &dsXML,(LPID) &dsXML.idHeaderElement);<br/><br/>		if(bErrorFound)<br/>		{<br/>			/* Set Error*/<br/><br/>			jdeTraceSz1(NULL, _J("B5576BX2 - Element %ls an error - Missing Element"),dsXML.szElementName);<br/>			<br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX07"), _J("106"), dsXML.szElementName,_J(""));<br/><br/>			bErrorFoundInHeader = TRUE;<br/>						<br/><br/>		}<br/>		else<br/>		{<br/>			jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls ID Number used: %i"),dsXML.szElementName,dsXML.idHeaderElement);<br/><br/>		}<br/>		<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Process Header Elements                                                                */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/><br/><br/>		if(!bErrorFoundInHeader)<br/>		{<br/>			<br/><br/><br/>			/* -------------------------------------------------------------------------------------- */<br/>			/* BEGIN Get Elements					                                                  */<br/>			/* -------------------------------------------------------------------------------------- */<br/><br/>			<br/>			for(iElement = 0; iElement &lt XML_HDR02_QTY_ELEMENTS; iElement++)<br/>			{<br/><br/>				jdeStrcpy(dsXML.szElementName,szHeaderArrayOfElements[iElement].szElementName);<br/>				jdeStripTrailingBlanks(dsXML.szElementName);<br/>				<br/>				bErrorFound = I76BX002_GetValueFromElementName(lpBhvrCom,lpVoid,dsXML.idHeaderElement,&mnZero, dsXML.szElementName,&dsXML);<br/>				<br/>				if(!bErrorFound)<br/>				{<br/>					jdeTraceSz2(NULL, _J("B5576BX2 - Element: %ls Value:%ls"),dsXML.szElementName,dsXML.szElementValue);<br/>				<br/>					/* Save Value */<br/>					/* ---------- */<br/><br/>					<br/>					jdeStrcpy(szHeaderArrayOfElementsValues[iElement].szElementValue, dsXML.szElementValue);<br/>				<br/>				}<br/>				else<br/>				{<br/>					<br/>					if(bHeaderMandatoryElement[iElement].bMandatory)<br/>					{<br/>						<br/>						/* Set Error */<br/>						<br/>						jdeTraceSz1(NULL, _J("B5576BX2 - ERROR Element mandatory: %ls not informerd"),dsXML.szElementName);<br/>						I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX07"), _J("109"), dsXML.szElementName,_J(""));<br/>						bErrorFoundInHeader = TRUE;<br/><br/>					}<br/>					else<br/>					{<br/>						jdeTraceSz1(NULL, _J("B5576BX2 - Element not mandatory: %ls not informed"),dsXML.szElementName);<br/><br/>					}<br/>				}<br/>			<br/><br/>			}<br/><br/><br/><br/>		}<br/><br/><br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Release Header Element (eoTransaction-header)                                          */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/><br/>		if(dsXML.idHeaderElement != (ID) NULL)<br/>		{<br/><br/>			jdeStrcpy(dsXML.szElementName,XML_HDR02_NAME);<br/>			jdeStripTrailingBlanks(dsXML.szElementName);<br/>			bErrorFound = I76BX002_ReleaseArrayOfElements(lpBhvrCom, lpVoid, &dsXML.idHeaderElement, &mnOne, &dsXML);<br/>			<br/>			if(bErrorFound)<br/>			{<br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Cannot release element %ls with ElementID %i"),dsXML.szElementName,dsXML.idHeaderElement);<br/>				I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX08"), _J("107"), dsXML.szElementName,_J(""));<br/>				bErrorFoundInHeader = TRUE;<br/>			<br/>			}<br/>			else<br/>			{<br/><br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with ElementID %i Released"),dsXML.szElementName,dsXML.idHeaderElement);<br/><br/>			}<br/>		<br/>		}<br/><br/><br/>		/* ======================================================================================================== */<br/>		/* END Get Header (eoTransaction-header)                                                                    */<br/>		/* ======================================================================================================== */<br/><br/>		<br/><br/>		/* ======================================================================================================== */<br/>		/* BEGIN Update Header Transaction                                                                          */<br/>		/* ======================================================================================================== */<br/><br/>		if(!bErrorFoundInHeader && lpDS-&gtcModeFinalOrProof_10 == _J('1'))<br/>		{<br/><br/><br/>			bErrorFoundInHeader = I76BX002_UpdateHeaderTransactionSP(lpBhvrCom,lpVoid,hUser, lpDS, &dsWorkFields, szHeaderArrayOfElements, szHeaderArrayOfElementsValues);<br/><br/>			<br/>		}<br/><br/><br/>		bErrorFound = bErrorFoundInHeader;<br/><br/>		/* ======================================================================================================== */<br/>		/* END Update Header Transaction                                                                            */<br/>		/* ======================================================================================================== */<br/>	<br/>	}<br/>	else<br/>	{<br/>		bErrorFoundInHeader = TRUE;<br/>		<br/><br/><br/>	}<br/><br/><br/>   /* Validate Next Status */<br/>   /* ==================== */<br/><br/><br/>	if(	dsWorkFields.cPOPreventNextStatUpdate != _J('1') && <br/>		dsWorkFields.bUpdateF7611BAndF7601B && <br/>		lpDS-&gtcModeFinalOrProof_10 == _J('1') &&<br/>		!bErrorFoundInHeader)<br/>	{<br/><br/>		jdeTraceSz(NULL, _J("B5576BX2 - Updating pdating next status..."));<br/><br/>		/* Validate Header */<br/>			<br/>		dsD76B9000A.cValidateHeaderOrDetail_HD = _J('H');<br/><br/>		/* Validate Only */<br/><br/>		dsD76B9000A.cUpdateStatusYN = _J('Y');<br/><br/>		/* Nota Fiscal Number */<br/><br/>		MathCopy (&dsD76B9000A.mnNotaFiscalNumber, &dsWorkFields.mnNotaFiscalNumber);<br/><br/>		/* Nota Fiscal Serie */<br/><br/>		jdeStrcpy (dsD76B9000A.szNotaFiscalSeries, dsWorkFields.szNotaFiscalSeries);<br/><br/>		/* Nota Fiscal Next Number */<br/>		<br/>		MathCopy (&dsD76B9000A.mnNextNumber001, &dsWorkFields.mnNextNumber001);<br/><br/>		/* Doc Type */<br/><br/>		jdeStrcpy (dsD76B9000A.szDocumentType, dsWorkFields.szDocumentType);<br/><br/>		/* Unique Key Internal */<br/><br/>		ZeroMathNumeric(&dsD76B9000A.mnUniqueKeyIDInternal);<br/><br/><br/>		/* Status Code From */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNextFrom, dsWorkFields.szPOStatusCodeNextFrom);<br/><br/>		/* Status Code From */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNextTo, dsWorkFields.szPOStatusCodeNextTo);<br/><br/>		/* Status Code SO */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNext_SO, dsWorkFields.szPOOverrideStatusCodeSO);<br/><br/>		/* Status Code NF */<br/><br/>		jdeStrcpy (dsD76B9000A.szStatusCodeNext_NF, dsWorkFields.szPOOverrideStatusCodeNF);<br/><br/>		/* Prevent Next Status Update: Value '1' is not update next status */<br/><br/>		dsD76B9000A.cPreventNextStatUpdate = dsWorkFields.cPOPreventNextStatUpdate;<br/><br/>		<br/>		idReturnCode= jdeCallObject  (_J("ValidateNFStatus_76B"),<br/>										NULL,<br/>										lpBhvrCom, <br/>						 			    lpVoid, <br/>										(LPVOID) &dsD76B9000A, <br/>										(CALLMAP *) NULL, <br/>										(int) 0, <br/>										(JCHAR *) NULL, <br/>										(JCHAR *) NULL, <br/>										(int) 0 ) ;<br/><br/><br/>		if(dsD76B9000A.cErrorCode != _J('0'))<br/>		{<br/><br/><br/><br/>			jdeTraceSz(NULL, _J("B5576BX2 - ERROR updating next status"));<br/>			<br/>			jdeStrcpy(lpDS-&gtszErrorCode, _J("B76WX06"));<br/>			jdeStrcpy(lpDS-&gtszXMLErrorCode, _J("105"));<br/>			jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, (LPVOID) NULL);<br/>			<br/>			bErrorFound = TRUE;<br/>	<br/>		<br/>		}<br/><br/><br/>	}<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/><br/>	if(dsWorkFields.hReqF5576B0E != NULL)<br/>	{<br/><br/>		JDB_CloseTable(dsWorkFields.hReqF5576B0E);<br/><br/>	}<br/><br/><br/>	if(dsWorkFields.hReqF7601B != NULL)<br/>	{<br/><br/>		JDB_CloseTable(dsWorkFields.hReqF7601B);<br/><br/>	}<br/><br/>	if(dsWorkFields.hReqF7611B != NULL)<br/>	{<br/><br/>		JDB_CloseTable(dsWorkFields.hReqF7611B);<br/><br/>	}<br/><br/><br/>   	if (hUser)<br/>	{<br/>		JDB_FreeBhvr(hUser);<br/>	}<br/>   <br/><br/>	if (bWarningFound)<br/>	{<br/>		idReturn       = ER_WARNING;<br/>	}<br/><br/><br/>	if (bErrorFound)<br/>	{<br/>		idReturn       = ER_ERROR;<br/>	}<br/><br/>   return (idReturn);<br/>}<br/><br/><br/>/* Internal function comment block */<br/>/**************************************************************************<br/> *   Function:  Ixxxxxxx_a   // Replace "xxxxxxx" with source file number<br/> *                           // and "a" with the function name<br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_GetElement<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_GetElement(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, JCHAR * szElementName, LPDSXMLfields02 lpdsXML, LPID lpidElement)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL				bErrorFound = FALSE;<br/>	ID					idReturnCode	 = ER_SUCCESS;<br/>	MATH_NUMERIC		mnOne;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/>	DSD55XML01K				dsD55XML01K = {0};				/* XMLGetElementsByTagName_76B */<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>	/* Init Var */<br/>	/* -------- */<br/>	<br/>	<br/>	ParseNumericString(&mnOne, _J("1"));<br/><br/>	/* Init Output Parameters */<br/>	/* ---------------------- */<br/><br/>	*lpidElement = 0;<br/><br/>	/* Get Element */<br/>	/* ----------- */<br/>	<br/>	memset((void *)(&dsD55XML01K), (int)(_J('\0')), sizeof(dsD55XML01K));<br/><br/>	dsD55XML01K.idAPIs = lpdsXML-&gtidAPIs;<br/>	dsD55XML01K.idDoc = lpdsXML-&gtidDoc;<br/>	dsD55XML01K.idFromElement = lpdsXML-&gtidRootElement;<br/>	jdeStrcpy(dsD55XML01K.szElementName, szElementName);<br/>	dsD55XML01K.cReturnValueYN = _J('N');<br/>	dsD55XML01K.cIsIDFromElementAnArrayYN = _J('N');<br/>	ZeroMathNumeric(&dsD55XML01K.mnFromElementNumber);<br/>	<br/>	<br/>	idReturnCode= jdeCallObject  (_J("XMLGetElementsByTagName_55"),<br/>			  NULL,<br/>			  lpBhvrCom, <br/>			  lpVoid, <br/>			  (LPVOID) &dsD55XML01K, <br/>			  (CALLMAP *) NULL, <br/>			  (int) 0, <br/>			  (JCHAR *) NULL, <br/>			  (JCHAR *) NULL, <br/>			  (int) 0 ) ;<br/><br/><br/>	if(dsD55XML01K.cErrorCode == _J('0'))<br/>	{<br/><br/>		/* is there more than one element? */<br/>		/* ------------------------------- */<br/><br/>		if(MathCompare(&dsD55XML01K.mnNumberOfElements,&mnOne)!=0)<br/>		{<br/>			bErrorFound = TRUE;<br/><br/><br/>			/* Release Header Elements */<br/><br/><br/>			bErrorFound = I76BX002_ReleaseArrayOfElements(lpBhvrCom, lpVoid, &dsD55XML01K.idArrayElements, &dsD55XML01K.mnNumberOfElements, lpdsXML);<br/><br/><br/>		}<br/>		else<br/>		{<br/>			/* Return Element ID */<br/>			/* ----------------- */<br/><br/>			*lpidElement = dsD55XML01K.idArrayElements;<br/><br/><br/>		}<br/><br/>	<br/>	}<br/>	else<br/>	{<br/><br/>		bErrorFound = TRUE;<br/><br/>	}<br/><br/>	return bErrorFound;<br/>}<br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_GetElement<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_GetElements(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, ID idRoot, JCHAR * szElementName, LPDSXMLfields02 lpdsXML, LPID lpidElement, LPMATH_NUMERIC lpmnQtyElements)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL				bErrorFound = FALSE;<br/>	ID					idReturnCode	 = ER_SUCCESS;<br/>	MATH_NUMERIC		mnZero;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/>	DSD55XML01K				dsD55XML01K = {0};				/* XMLGetElementsByTagName_76B */<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>	/* Init Var */<br/>	/* -------- */<br/>	<br/>	<br/>	ParseNumericString(&mnZero, _J("0"));<br/><br/>	/* Init Output Parameters */<br/>	/* ---------------------- */<br/><br/>	*lpidElement = 0;<br/><br/>	/* Get Element */<br/>	/* ----------- */<br/>	<br/>	memset((void *)(&dsD55XML01K), (int)(_J('\0')), sizeof(dsD55XML01K));<br/><br/>	dsD55XML01K.idAPIs = lpdsXML-&gtidAPIs;<br/>	dsD55XML01K.idDoc = lpdsXML-&gtidDoc;<br/>	dsD55XML01K.idFromElement = idRoot;<br/>	jdeStrcpy(dsD55XML01K.szElementName, szElementName);<br/>	dsD55XML01K.cReturnValueYN = _J('N');<br/>	dsD55XML01K.cIsIDFromElementAnArrayYN = _J('Y');<br/>	ZeroMathNumeric(&dsD55XML01K.mnFromElementNumber);<br/>	<br/>	<br/>	idReturnCode= jdeCallObject  (_J("XMLGetElementsByTagName_55"),<br/>			  NULL,<br/>			  lpBhvrCom, <br/>			  lpVoid, <br/>			  (LPVOID) &dsD55XML01K, <br/>			  (CALLMAP *) NULL, <br/>			  (int) 0, <br/>			  (JCHAR *) NULL, <br/>			  (JCHAR *) NULL, <br/>			  (int) 0 ) ;<br/><br/><br/>	if(dsD55XML01K.cErrorCode == _J('0'))<br/>	{<br/><br/>		/* is there more than one element? */<br/>		/* ------------------------------- */<br/><br/>		if(MathCompare(&dsD55XML01K.mnNumberOfElements,&mnZero)==0)<br/>		{<br/>			bErrorFound = TRUE;<br/><br/><br/>			/* Release Header Elements */<br/><br/><br/>			bErrorFound = I76BX002_ReleaseArrayOfElements(lpBhvrCom, lpVoid, &dsD55XML01K.idArrayElements, &dsD55XML01K.mnNumberOfElements, lpdsXML);<br/><br/><br/>		}<br/>		else<br/>		{<br/>			/* Return Element ID & Qty Elements */<br/>			/* -------------------------------- */<br/><br/>			*lpidElement = dsD55XML01K.idArrayElements;<br/>			MathCopy(lpmnQtyElements,&dsD55XML01K.mnNumberOfElements);<br/>			<br/><br/>		}<br/><br/>	<br/>	}<br/>	else<br/>	{<br/><br/>		bErrorFound = TRUE;<br/><br/>	}<br/><br/>	return bErrorFound;<br/>}<br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_GetValueFromElementName<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_GetValueFromElementName(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, ID idFromParent,LPMATH_NUMERIC lpmnElementSequence, JCHAR * szElementName, LPDSXMLfields02 lpdsXML)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL			  bErrorFound = FALSE;<br/>	ID				  idReturnCode	 = ER_SUCCESS;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/>	DSD55XML01K				dsD55XML01K = {0};				/* XMLGetElementsByTagName_76B */<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	memset((void *)(&dsD55XML01K), (int)(_J('\0')), sizeof(dsD55XML01K));<br/><br/>	dsD55XML01K.idAPIs = lpdsXML-&gtidAPIs;<br/>	dsD55XML01K.idDoc = lpdsXML-&gtidDoc;<br/>	dsD55XML01K.idFromElement = idFromParent;<br/>	jdeStrcpy(dsD55XML01K.szElementName, szElementName);<br/>	dsD55XML01K.cReturnValueYN = _J('Y');<br/>	dsD55XML01K.cIsIDFromElementAnArrayYN = _J('Y');<br/>	MathCopy(&dsD55XML01K.mnFromElementNumber,lpmnElementSequence);<br/>	<br/>	<br/>	idReturnCode= jdeCallObject  (_J("XMLGetElementsByTagName_55"),<br/>			  NULL,<br/>			  lpBhvrCom, <br/>			  lpVoid, <br/>			  (LPVOID) &dsD55XML01K, <br/>			  (CALLMAP *) NULL, <br/>			  (int) 0, <br/>			  (JCHAR *) NULL, <br/>			  (JCHAR *) NULL, <br/>			  (int) 0 ) ;<br/><br/><br/>	if(dsD55XML01K.cErrorCode == _J('0'))<br/>	{<br/>	<br/>		jdeStrcpy(lpdsXML-&gtszElementValue, dsD55XML01K.szElementValue);<br/>		jdeStripTrailingBlanks(lpdsXML-&gtszElementValue);<br/><br/><br/>	<br/>	}<br/>	else<br/>	{<br/><br/>		bErrorFound = TRUE;<br/><br/>	}<br/><br/>	return bErrorFound;<br/><br/>}<br/><br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_ReleaseArrayOfElements<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/><br/><br/>BOOL I76BX002_ReleaseArrayOfElements(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPID lpidArrayElements, LPMATH_NUMERIC lpmnNumberOfElements, LPDSXMLfields02 lpdsXML)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL			  bErrorFound = FALSE;<br/>	ID				  idReturnCode	 = ER_SUCCESS;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/>	DSD55XML01L				dsD55XML01L = {0};				/* XMLFreeArrayOfElements_76B */<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	memset((void *)(&dsD55XML01L), (int)(_J('\0')), sizeof(dsD55XML01L));<br/><br/>	dsD55XML01L.idAPIs = lpdsXML-&gtidAPIs;<br/>	dsD55XML01L.idDoc = lpdsXML-&gtidDoc;<br/>	dsD55XML01L.idArrayElements = *lpidArrayElements;<br/>	MathCopy(&dsD55XML01L.mnNumberOfElements, lpmnNumberOfElements);<br/>	<br/>	idReturnCode= jdeCallObject  (_J("XMLFreeArrayOfElements_55"),<br/>			  NULL,<br/>			  lpBhvrCom, <br/>			  lpVoid, <br/>			  (LPVOID) &dsD55XML01L, <br/>			  (CALLMAP *) NULL, <br/>			  (int) 0, <br/>			  (JCHAR *) NULL, <br/>			  (JCHAR *) NULL, <br/>			  (int) 0 ) ;<br/><br/><br/>	if(dsD55XML01L.cErrorCode == _J('0'))<br/>	{<br/>	<br/>		*lpidArrayElements = 0;<br/>		ZeroMathNumeric(lpmnNumberOfElements);<br/><br/><br/>	<br/>	}<br/>	else<br/>	{<br/><br/>		bErrorFound = TRUE;<br/><br/>	}<br/><br/>	return bErrorFound;<br/><br/>}<br/><br/><br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_UpdateHeaderTransaction<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_UpdateHeaderTransactionSP(	LPBHVRCOM lpBhvrCom, <br/>											LPVOID lpVoid, <br/>											HUSER hUser, <br/>											LPDSD5576BX002 lpDS, <br/>											LPDSWorkingVariables02 lpdsWF,<br/>											LPDSHeaderElementName02 lpdsHeaderElements,   <br/>											LPDSHeaderElementValue02 lpdsHeaderValues)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	ID					idJDBResult		= JDEDB_PASSED;<br/>	BOOL				bErrorFound		= FALSE;<br/><br/>	BOOL				bValidXMLDocument	= TRUE;<br/>	BOOL				bNFDuplicated	= FALSE;<br/><br/>	JDECM_RESULT		eResult;<br/><br/><br/>	MATH_NUMERIC		mnZero				= {0};<br/>	MATH_NUMERIC		mnMax_LegalNumber	= {0};<br/><br/>	int					iSeq = 0;<br/>	short				sError          =	0;<br/><br/>	/* Legal Number */<br/><br/>	MATH_NUMERIC		mnLegalNumber				= {0};<br/>	BOOL				bLegalNumberInformed		= FALSE;<br/><br/>	/* Legal Number Date */<br/><br/>	JDEDATE				jdLegalNumberDate			= {0};<br/>	BOOL				bLegalNumberDateInformed	= FALSE;<br/><br/>	/* Legal Number Time */<br/><br/>	MATH_NUMERIC		mnLegalTime					= {0};<br/>	BOOL				bLegalNumberTimeInformed	= FALSE;<br/><br/>	/* Verification Code */<br/><br/>	JCHAR				szVerificationCode[45]		= {0};<br/>	BOOL				bVerificationCodeInformed	= FALSE;<br/><br/>	/* Document Status Date */<br/><br/>	JDEDATE				jdDocumentStatusDate		= {0};<br/>	BOOL				bDocumentStatusDateInformed	= FALSE;<br/><br/>	/* Error Code */<br/><br/>	JCHAR				szErrorCode[4]				= {0};<br/>	BOOL				bErrorCodeInformed			= FALSE;<br/><br/>	/* Error Description */<br/><br/>	JCHAR				szErrorCodeDes[61]			= {0};<br/>	BOOL				bErrorDesInformed			= FALSE;<br/><br/>	/* Error Description Extended */<br/><br/>	JCHAR				szErrorCodeDesEx[231]		= {0};<br/>	BOOL				bErrorDesExInformed			= FALSE;<br/><br/>	/* Blob Field */<br/><br/>/*	DBREF			dbRef					= {0};<br/>	int				blobSize				= 0;<br/>*/	JCHAR			szTempLine[150]			= {0};<br/>	JCHAR			szTempString[450]		= {0};<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	ParseNumericString(&mnZero,_J("0"));<br/>	ParseNumericString(&mnMax_LegalNumber,_J("999999999999"));<br/>	lpdsWF-&gtbLegalNumberInformed=FALSE;<br/><br/><br/>	/* New Doc Status */<br/><br/>	lpDS-&gtcNewXMLDocStatus = _J(' ');<br/><br/>	/* -------------------------------------------------------------------------------------- */<br/>	/* Validate Status                                                                        */<br/>	/* -------------------------------------------------------------------------------------- */<br/><br/>	if( lpDS-&gtcXMLDocumentStatus != _J('A') &&<br/>		lpDS-&gtcXMLDocumentStatus != _J('D') &&<br/>		lpDS-&gtcXMLDocumentStatus != _J('R') &&<br/>		lpDS-&gtcXMLDocumentStatus != _J('E') &&<br/>		lpDS-&gtcXMLDocumentStatus != _J('C'))<br/>	{<br/><br/>			iSeq = XML_HDR02_SeqLegalNumber;<br/>			jdeTraceSz(NULL, _J("B5576BX2 - The XML document has invalid status"));<br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX12"), _J("111"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>			bErrorFound = TRUE;<br/>			bValidXMLDocument	= FALSE;<br/><br/>	}<br/><br/><br/>	/* Document Received is Accepted */<br/><br/>	if(lpDS-&gtcXMLDocumentStatus == _J('A'))<br/>	{<br/><br/>		/* Current Status is Accepted ? */<br/><br/>		if(lpdsWF-&gtdsF5576B0E.fh55est == _J('A'))<br/>		{<br/><br/>			iSeq = XML_HDR02_SeqLegalNumber;<br/>			jdeTraceSz(NULL, _J("B5576BX2 - The XML document has been processed previously"));<br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX11"), _J("110"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>			bErrorFound = TRUE;<br/>			bValidXMLDocument	= FALSE;<br/><br/>		}<br/><br/><br/>	}<br/><br/><br/>	/* Document Received is Rejected or Deneged */<br/><br/>	if(lpDS-&gtcXMLDocumentStatus == _J('R') || lpDS-&gtcXMLDocumentStatus == _J('D') )<br/>	{<br/><br/>		/* Current Status is Accepted ? */<br/><br/>		if(lpdsWF-&gtdsF5576B0E.fh55est == _J('A'))<br/>		{<br/><br/>			iSeq = (int) XML_HDR02_SeqLegalNumber;<br/>			jdeTraceSz(NULL, _J("B5576BX2 - The XML document has been processed previously"));<br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX11"), _J("110"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>			bErrorFound = TRUE;<br/>			bValidXMLDocument	= FALSE;<br/><br/>		}<br/><br/>	}<br/><br/>			<br/>	/* -------------------------------------------------------------------------------------- */<br/>	/* Validate Elements                                                                      */<br/>	/* -------------------------------------------------------------------------------------- */<br/><br/>	if(!bErrorFound)<br/>	{<br/><br/>		if(lpDS-&gtcXMLDocumentStatus != _J('E'))<br/>		{<br/><br/>			<br/>			/* -------------------------------------------------------------------------------------- */<br/>			/* Validate Legal Number      (Number 12)                                                  */<br/>			/* -------------------------------------------------------------------------------------- */<br/>	<br/>	<br/>			iSeq = XML_HDR02_SeqLegalNumber;<br/>		<br/>			if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue) )<br/>			{<br/>	<br/>				<br/>	<br/>				eResult = ParseNumericString(&mnLegalNumber,lpdsHeaderValues[iSeq].szElementValue);<br/>				<br/>				if (eResult == MATH_SUCCESS)<br/>				{<br/>					if(	MathCompare(&mnLegalNumber,&mnZero)&lt0 ||<br/>						MathCompare(&mnLegalNumber,&mnMax_LegalNumber)&gt0)<br/>					{<br/>						ZeroMathNumeric(&mnLegalNumber);<br/>						jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls greather than max value or less than zero. Wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>						I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>						bErrorFound = TRUE;<br/>					}<br/>					else<br/>					{<br/>		<br/>						bLegalNumberInformed = TRUE;<br/>		<br/>		<br/>					}<br/>		<br/>				}<br/>				else<br/>				{<br/>					jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>				}<br/>		<br/>			}<br/>		<br/>		<br/>			/* -------------------------------------------------------------------------------------- */<br/>			/* Validate Legal Number Date      (Date DD-MM-YYYY)                                      */<br/>			/* -------------------------------------------------------------------------------------- */<br/>		<br/>		<br/>			iSeq = XML_HDR02_SeqLegalNumberDate;<br/>		<br/>			if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>			{<br/>				<br/>				sError = DeformatDate( &jdLegalNumberDate,lpdsHeaderValues[iSeq].szElementValue, (JCHAR*) _J("ASOSE"));<br/>				<br/>				if (sError != JDEDATE_SUCCESS)<br/>				{<br/>					jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>				<br/>				}<br/>				else<br/>				{<br/>		<br/>					bLegalNumberDateInformed = TRUE;<br/>					lpdsWF-&gtbLegalNumberInformed=TRUE;<br/>		<br/>				}<br/>		<br/>			}<br/>		<br/>			/* -------------------------------------------------------------------------------------- */<br/>			/* Validate Legal Number Time      (HH-MM-SS)                                             */<br/>			/* -------------------------------------------------------------------------------------- */<br/>		<br/>		<br/>			iSeq = XML_HDR02_SeqLegalNumberTime;<br/>		<br/>			if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>			{<br/>				<br/>				/* Convert Time */<br/>				<br/>				if (I76BX002_ConvertTimeFromString(&mnLegalTime,lpdsHeaderValues[iSeq].szElementValue))<br/>				{<br/>					jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>				<br/>				}<br/>				else<br/>				{<br/>		<br/>					bLegalNumberTimeInformed = TRUE;<br/>		<br/>				}<br/>		<br/>			}<br/><br/><br/>		}<br/>	<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Legal Number (is required fo Accepted/Rejected/Canceled/Deneged               */<br/>		/* -------------------------------------------------------------------------------------- */<br/>	<br/>	<br/>		if(lpDS-&gtcXMLDocumentStatus != _J('E'))<br/>		{<br/>	<br/>			if(bLegalNumberInformed)<br/>			{<br/>				if(!bLegalNumberDateInformed)<br/>				{<br/>					iSeq = XML_HDR02_SeqLegalNumberDate;<br/>					jdeTraceSz1(NULL, _J("B5576BX2 - Element %ls is required"),lpdsHeaderElements[iSeq].szElementName);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX10"), _J("109"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>					<br/>				}<br/>				<br/>				if(!bLegalNumberTimeInformed)<br/>				{<br/>					iSeq = XML_HDR02_SeqLegalNumberTime;<br/>					jdeTraceSz1(NULL, _J("B5576BX2 - Element %ls is required"),lpdsHeaderElements[iSeq].szElementName);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX10"), _J("109"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>					<br/>				}<br/>			<br/>			}<br/>			else<br/>			{<br/>					iSeq = XML_HDR02_SeqLegalNumber;<br/>					jdeTraceSz1(NULL, _J("B5576BX2 - Element %ls is required"),lpdsHeaderElements[iSeq].szElementName);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX10"), _J("109"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>			}<br/>	<br/>		<br/>		}<br/>	<br/>	<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Verification Code   (String 30)                                                */<br/>		/* -------------------------------------------------------------------------------------- */<br/>		<br/>			<br/>		if(lpDS-&gtcXMLDocumentStatus != _J('E'))<br/>		{<br/>		<br/>			iSeq = XML_HDR02_SeqVerificationCode;<br/>	<br/>			if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>			{<br/>				<br/>				/* Convert Verification Code */<br/>				<br/>				if (jdeStrlen(lpdsHeaderValues[iSeq].szElementValue) &gt DIM(szVerificationCode)-1)<br/>				{<br/>					jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>					bErrorFound = TRUE;<br/>				<br/>				}<br/>				else<br/>				{<br/>		<br/>					bVerificationCodeInformed = TRUE;<br/>					jdeStrncpy(szVerificationCode,lpdsHeaderValues[iSeq].szElementValue,DIM(szVerificationCode));<br/>		<br/>				}<br/>		<br/>			}<br/>		<br/>		}<br/>	<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Doc Status Date      (Date DD-MM-YYYY)                                        */<br/>		/* -------------------------------------------------------------------------------------- */<br/>	<br/>	<br/>		iSeq = XML_HDR02_SeqDocumentStatusDate;<br/>	<br/>		if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>		{<br/>			<br/>			sError = DeformatDate( &jdDocumentStatusDate,lpdsHeaderValues[iSeq].szElementValue, (JCHAR*) _J("ASOSE"));<br/>			<br/>			if (sError != JDEDATE_SUCCESS)<br/>			{<br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				bErrorFound = TRUE;<br/>			<br/>			}<br/>			else<br/>			{<br/>	<br/>				bDocumentStatusDateInformed = TRUE;<br/>	<br/>			}<br/>	<br/>		}<br/><br/>	<br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Error Code   String 3                                                         */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/>		<br/>		iSeq = XML_HDR02_SeqErrorCode;<br/><br/>		if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>		{<br/>			<br/>		<br/>			<br/>			if (jdeStrlen(lpdsHeaderValues[iSeq].szElementValue) !=  DIM(szErrorCode) - 1)<br/>			{<br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				bErrorFound = TRUE;<br/>			<br/>			}<br/>			else<br/>			{<br/>	<br/>				bErrorCodeInformed = TRUE;<br/>				jdeStrncpy(szErrorCode,lpdsHeaderValues[iSeq].szElementValue,DIM(szErrorCode));<br/>	<br/>			}<br/>	<br/>		}<br/><br/><br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Error Des   String 50                                                         */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/>		<br/>		iSeq = XML_HDR02_SeqErrorDescription;<br/><br/>		if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>		{<br/>		<br/>			<br/>			if (jdeStrlen(lpdsHeaderValues[iSeq].szElementValue) &gt DIM(szErrorCodeDes) - 1)<br/>			{<br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				bErrorFound = TRUE;<br/>			<br/>			}<br/>			else<br/>			{<br/>	<br/>				bErrorDesInformed = TRUE;<br/>				jdeStrncpy(szErrorCodeDes,lpdsHeaderValues[iSeq].szElementValue,DIM(szErrorCodeDes));<br/>	<br/>			}<br/>	<br/>		}<br/><br/><br/><br/>		/* -------------------------------------------------------------------------------------- */<br/>		/* Validate Error Des Ext   String 100                                                         */<br/>		/* -------------------------------------------------------------------------------------- */<br/><br/>		<br/>		iSeq = XML_HDR02_SeqErrorDescriptionExt;<br/><br/>		if(!IsStringBlank(lpdsHeaderValues[iSeq].szElementValue))<br/>		{<br/>						<br/>			if (jdeStrlen(lpdsHeaderValues[iSeq].szElementValue) &gt DIM(szErrorCodeDesEx) - 1)<br/>			{<br/>				jdeTraceSz2(NULL, _J("B5576BX2 - Element %ls with wrong value: %ls"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX09"), _J("108"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>				bErrorFound = TRUE;<br/>			<br/>			}<br/>			else<br/>			{<br/>	<br/>				bErrorDesExInformed = TRUE;<br/>				jdeStrncpy(szErrorCodeDesEx,lpdsHeaderValues[iSeq].szElementValue,DIM(szErrorCodeDesEx));<br/>	<br/>			}<br/>	<br/>		}<br/><br/><br/>		/* Mark the doc as Valid XML Doc */<br/>		/* ----------------------------- */<br/><br/>		if(bErrorFound)<br/>		{<br/>			bValidXMLDocument	= FALSE;<br/>		}<br/><br/><br/><br/>	}<br/><br/><br/>	/* Send TPS error */<br/>	/* ============== */<br/><br/><br/>	if(bValidXMLDocument && lpDS-&gtcXMLDocumentStatus != _J('A') && lpDS-&gtcXMLDocumentStatus != _J('C'))<br/>	{<br/><br/><br/>		if(bErrorDesExInformed || bErrorDesInformed)<br/>		{<br/><br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX16"), _J("115"),szErrorCodeDes,szErrorCodeDesEx);<br/>			<br/><br/>		}<br/><br/><br/>		<br/>	}<br/><br/><br/>	/* Duplicity */<br/>	/* --------- */<br/><br/>	if(bValidXMLDocument && lpDS-&gtcXMLDocumentStatus != _J('E') && lpDS-&gtcXMLDocumentStatus != _J('C'))<br/>	{<br/><br/>		bErrorFound = I76BX002_IsDuplicateLegalNFNumber(lpBhvrCom,lpVoid,hUser,lpDS,&mnLegalNumber,&bNFDuplicated);<br/><br/>		if(!bErrorFound && bNFDuplicated)<br/>		{<br/><br/>			jdeTraceSz(NULL, _J("B5576BX2 - The XML document has a NF Legal Number duplicated"));<br/>			I76BX002_SetXMLError(lpBhvrCom, lpVoid, lpDS, _J("B76EX13"), _J("112"),lpdsHeaderElements[iSeq].szElementName,lpdsHeaderValues[iSeq].szElementValue);<br/>			bErrorFound = TRUE;<br/><br/>		}<br/><br/><br/>	}<br/>	<br/>	<br/>	<br/>	/* -------------------------------------------------------------------------------------- */<br/>	/* Update F5576B0E                                                                        */<br/>	/* -------------------------------------------------------------------------------------- */<br/><br/>	<br/>	if(!bErrorFound && bValidXMLDocument)<br/>	{<br/><br/><br/>		if(lpdsWF-&gtdsF5576B0E.fh55est != _J(' ') && lpdsWF-&gtdsF5576B0E.fh55est != _J('\0') ) <br/>		{<br/><br/>			/* Save the History Record */<br/><br/>			bErrorFound =	I76BX002_SaveHistory			(lpBhvrCom, <br/>															 lpVoid, <br/>															 hUser, <br/>															 lpDS,<br/>															 lpdsWF);<br/><br/><br/>		}<br/><br/><br/><br/><br/>		/* Legal Number */<br/>		/* ------------ */<br/><br/>		if(bLegalNumberInformed)<br/>		{<br/>			/* Legal Number */<br/>		/*  Juliano Rach - 25/10/2010 */<br/>		/*  Atribuição substituida,por que estava retirando os zeros a esquerda do legal number */  <br/>		/*	FormatMathNumeric(lpdsWF-&gtdsF5576B0E.fh55eln,&mnLegalNumber); */<br/>			iSeq = XML_HDR02_SeqLegalNumber;			<br/>			jdeStrncpy(lpdsWF-&gtdsF5576B0E.fh55eln,lpdsHeaderValues[iSeq].szElementValue,DIM(lpdsWF-&gtdsF5576B0E.fh55eln));<br/>		<br/>			/* Legal Number Date */<br/>			<br/>			JDEDATECopy(&lpdsWF-&gtdsF5576B0E.fh55elnd , &jdLegalNumberDate );<br/>			<br/>			/* Legal Number Time */<br/>			<br/>			MathCopy(&lpdsWF-&gtdsF5576B0E.fh55elnt,&mnLegalTime);<br/><br/>		}<br/>	<br/><br/>		/* Verification Code */<br/>		/* ----------------- */<br/><br/>		if(bVerificationCodeInformed)<br/>		{<br/>			/* Verification Code */		<br/>			<br/>			 jdeStrncpy(lpdsWF-&gtdsF5576B0E.fh55eref,szVerificationCode,DIM(lpdsWF-&gtdsF5576B0E.fh55eref));<br/>			<br/><br/>		}<br/><br/>		/* ReceiptSerie      */<br/>		/* ----------------- */<br/><br/>		iSeq = XML_HDR02_SeqReceiptSerie;<br/>		jdeStrncpy(lpdsWF-&gtdsF5576B0E.fh55ern,lpdsHeaderValues[iSeq].szElementValue,DIM(lpdsWF-&gtdsF5576B0E.fh55ern));<br/>		<br/>		/* Document Status */<br/>		/* --------------- */<br/><br/>		lpdsWF-&gtdsF5576B0E.fh55est= lpDS-&gtcXMLDocumentStatus;<br/><br/>		/* Document Status Date */<br/>		/* -------------------- */<br/><br/>		JDEDATECopy(&lpdsWF-&gtdsF5576B0E.fh55estd , &jdDocumentStatusDate );<br/>		<br/>		/* Error Code */<br/><br/>		jdeStrncpy(lpdsWF-&gtdsF5576B0E.fh55estc,szErrorCode,DIM(lpdsWF-&gtdsF5576B0E.fh55estc));<br/><br/>		/* Error Description */<br/><br/>		if(bErrorDesInformed || bErrorDesExInformed || bVerificationCodeInformed)<br/>		{<br/><br/>			jdeStrcpy(szTempString, _J(""));<br/><br/>			if(bVerificationCodeInformed)<br/>			{<br/>				jdeSprintf((JCHAR *) szTempLine,_J("%ls%ls%ls\n"),_J("&ltVerificationCode&gt"), szVerificationCode,_J("&lt//VerificationCode&gt"));<br/>				jdeStrcat(szTempString, szTempLine);<br/>			}<br/>		<br/><br/>			if(bErrorDesInformed)<br/>			{<br/>				jdeSprintf((JCHAR *) szTempLine,_J("%ls%ls%ls\n"),_J("&ltErrorDescription&gt"), szErrorCodeDes,_J("&lt//ErrorDescription&gt"));<br/>				jdeStrcat(szTempString, szTempLine);<br/>			}<br/>		<br/>			<br/>			if(bErrorDesExInformed)<br/>			{<br/>				jdeSprintf((JCHAR *) szTempLine,_J("%ls%ls%ls\n"),_J("&ltErrorDescriptionEx&gt"), szErrorCodeDesEx,_J("&lt//ErrorDescriptionEx&gt"));<br/>				jdeStrcat(szTempString, szTempLine);<br/>			}<br/>		<br/>/*			jdeNIDcpy(dbRef.szTable, NID_F5576B0E);<br/>			dbRef.idInstance = 0L;<br/>			jdeNIDcpy(dbRef.szDict, NID_TXVC);<br/>			blobSize = ( (jdeStrlen(szTempString)+ 1) * sizeof(JCHAR ) ) ;<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue  = JDB_SetBLOBSize(lpdsWF-&gthReqF5576B0E, dbRef, blobSize);<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lSize	  = blobSize;<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lMaxSize = MAX_BLOB_SIZE;<br/><br/>			if(lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue != NULL)<br/>			{<br/>				memcpy((void*) lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue, (void*)szTempString,lpdsWF-&gtdsF5576B0E.fhtxvc.lSize);<br/>				<br/>			}<br/>*/<br/><br/>		}<br/>		else<br/>		{<br/>			jdeStrcpy(szTempString, _J(" "));<br/>/*			jdeNIDcpy(dbRef.szTable, NID_F5576B0E);<br/>			dbRef.idInstance = 0L;<br/>			jdeNIDcpy(dbRef.szDict, NID_TXVC);<br/>			blobSize = ( (jdeStrlen(szTempString)+ 1) * sizeof(JCHAR ) ) ;<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue  = JDB_SetBLOBSize(lpdsWF-&gthReqF5576B0E, dbRef, blobSize);<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lSize	  = blobSize;<br/>			lpdsWF-&gtdsF5576B0E.fhtxvc.lMaxSize = MAX_BLOB_SIZE;<br/><br/>			if(lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue != NULL)<br/>			{<br/>				memcpy((void*) lpdsWF-&gtdsF5576B0E.fhtxvc.lpValue, (void*)szTempString,lpdsWF-&gtdsF5576B0E.fhtxvc.lSize);<br/>				<br/>			}<br/>*/<br/><br/><br/>		}<br/><br/>		/* Audit Info */<br/>		<br/>		jdeStrcpy(lpdsWF-&gtdsF5576B0E.fhuser,lpDS-&gtszAuditInfoUserId);<br/>		jdeStrcpy(lpdsWF-&gtdsF5576B0E.fhpid,lpDS-&gtszAuditInfoProgramId);<br/>		jdeStrcpy(lpdsWF-&gtdsF5576B0E.fhjobn,lpDS-&gtszAuditInfoWorkStationId);<br/>		JDEDATECopy(&lpdsWF-&gtdsF5576B0E.fhupmj , &lpDS-&gtjdAuditInfoDateUpdated );<br/>		MathCopy (&lpdsWF-&gtdsF5576B0E.fhtday, &lpDS-&gtmnAuditInfoTimeLastUpdated);<br/><br/>		/* BEGIN SAR 8535851 */<br/><br/>		jdeStrcpy(lpdsWF-&gtdsF5576B0E.fhtorg,lpDS-&gtszTypeTransaction);<br/><br/>		/* END SAR 8535851 */<br/>		<br/>		if(szTempString != NULL)<br/>		{<br/>			jdeStrncpy(lpdsWF-&gtdsF5576B0E.fhtxvc, szTempString, DIM(lpdsWF-&gtdsF5576B0E.fhtxvc));<br/>		}<br/><br/>		idJDBResult = JDB_UpdateTable(	 lpdsWF-&gthReqF5576B0E, <br/>										 NID_F5576B0E, <br/>										 (ID) 0,<br/>										 (ID) ID_F5576B0E_BNNF_BSER_N001_DCT,<br/>										 &lpdsWF-&gtdsF5576B0EKey1,<br/>										 4, <br/>										 &lpdsWF-&gtdsF5576B0E);<br/><br/><br/>		if (idJDBResult != JDEDB_PASSED)<br/>		{<br/>			jdeTraceSz(NULL, _J("B5576BX2 - Update F5576B0E failed"));<br/>			I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX14"), _J("113"),NID_F5576B0E);<br/>			bErrorFound = TRUE;<br/><br/><br/>		}<br/><br/><br/>	}<br/><br/><br/><br/>	/* -------------------------------------------------------------------------------------- */<br/>	/* Update F7601B                                                                          */<br/>	/* -------------------------------------------------------------------------------------- */<br/><br/>	<br/>	if(!bErrorFound && bValidXMLDocument && lpdsWF-&gtbUpdateF7611BAndF7601B)<br/>	{<br/><br/><br/>		/* ---------------------- */<br/>		/* Open F7601B      */<br/>		/* ---------------------- */<br/><br/>		if(!lpdsWF-&gtbF7601B_OpenYN)<br/>		{<br/>			idJDBResult = JDB_OpenTable(hUser, <br/>										NID_F7601B, <br/>										ID_F7601B_NOTAFISCAL, <br/>										NULL, <br/>										0, <br/>										NULL, <br/>										&lpdsWF-&gthReqF7601B);<br/>			<br/>			if (idJDBResult != JDEDB_PASSED)<br/>			{<br/>				I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX03"), _J("102"),NID_F7601B);<br/>				<br/>				bErrorFound = TRUE;<br/>			}<br/>			else<br/>			{<br/>				lpdsWF-&gtbF7601B_OpenYN = TRUE;<br/>			}<br/><br/>		}<br/><br/><br/>		/* ---------------------- */<br/>		/* Get Header F7601B      */<br/>		/* ---------------------- */<br/><br/>		/* Nota Fiscal Number */<br/>		<br/>		MathCopy (&lpdsWF-&gtdsF7601BKey1.fhbnnf, &lpdsWF-&gtmnNotaFiscalNumber);<br/>		<br/>		/* Nota Fiscal Serie */<br/>		<br/>		jdeStrcpy (lpdsWF-&gtdsF7601BKey1.fhbser, lpdsWF-&gtszNotaFiscalSeries);<br/>		<br/>		/* Nota Fiscal Next Number */<br/>		<br/>		MathCopy (&lpdsWF-&gtdsF7601BKey1.fhn001, &lpdsWF-&gtmnNextNumber001);<br/>		<br/>		/* Doc Type */<br/>		<br/>		jdeStrcpy (lpdsWF-&gtdsF7601BKey1.fhdct, lpdsWF-&gtszDocumentType);<br/>		<br/><br/>		/* Fetch Record */<br/><br/>		idJDBResult = JDB_FetchKeyed(lpdsWF-&gthReqF7601B,<br/>	       							(ID) ID_F7601B_NOTAFISCAL, <br/>									(void *)(&lpdsWF-&gtdsF7601BKey1), <br/>									(short)(4),<br/>									(void *)(&lpdsWF-&gtdsF7601B),<br/>									FALSE);<br/>		<br/>		<br/>		if (idJDBResult != JDEDB_PASSED)<br/>		{<br/>			<br/>			jdeTraceSz(NULL, _J("B76BX001 - Fetch F7601B failed"));<br/>			I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX04"), _J("103"),NID_F7601B);<br/>			bErrorFound = TRUE;	<br/>		<br/>		}		<br/>		else<br/>		{<br/>			<br/>			/* Legal Number */<br/>			/* ------------ */<br/>			<br/>			if(lpdsWF-&gtbLegalNumberInformed)<br/>			{<br/>				<br/>				/* Legal Number Date */<br/>			/* Juliano Rach - 22/10/2010 */<br/>			/* Comentado por que esta atualização queima a data de emissão no caso de Emitir o Notão */	<br/>			/*	JDEDATECopy(&lpdsWF-&gtdsF7601B.fhissu , &lpdsWF-&gtdsF5576B0E.fh55elnd ); */<br/>				<br/>			<br/>			}<br/><br/>			/* Audit Info */<br/><br/>			<br/>			jdeStrcpy(lpdsWF-&gtdsF7601B.fhuser,lpDS-&gtszAuditInfoUserId);<br/>			jdeStrcpy(lpdsWF-&gtdsF7601B.fhpid,lpDS-&gtszAuditInfoProgramId);<br/>			jdeStrcpy(lpdsWF-&gtdsF7601B.fhjobn,lpDS-&gtszAuditInfoWorkStationId);<br/>			JDEDATECopy(&lpdsWF-&gtdsF7601B.fhupmj , &lpDS-&gtjdAuditInfoDateUpdated );<br/>			MathCopy (&lpdsWF-&gtdsF7601B.fhtday, &lpDS-&gtmnAuditInfoTimeLastUpdated);<br/>			<br/>			idJDBResult = JDB_UpdateTable(	 lpdsWF-&gthReqF7601B, <br/>												NID_F7601B, 	<br/>												(ID) 0,<br/>												(ID) ID_F7601B_NOTAFISCAL,<br/>												&lpdsWF-&gtdsF7601BKey1,<br/>												4, <br/>												&lpdsWF-&gtdsF7601B);<br/>			<br/>			if (idJDBResult != JDEDB_PASSED)<br/>			{<br/>				jdeTraceSz(NULL, _J("B76BX001 - Update F7601B failed"));<br/>				I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX15"), _J("113"),NID_F7601B);<br/>				bErrorFound = TRUE;	<br/>				<br/>			}<br/><br/>		}<br/><br/><br/><br/><br/>		/* ---------------------- */<br/>		/* Open F7611B      */<br/>		/* ---------------------- */<br/><br/>		if(!lpdsWF-&gtbF7611B_OpenYN)<br/>		{<br/><br/>			idJDBResult = JDB_OpenTable(hUser, <br/>										NID_F7611B, <br/>										ID_F7611B_NOTAFISCALDET, <br/>										NULL, <br/>										0, <br/>										NULL, <br/>										&lpdsWF-&gthReqF7611B);<br/><br/>			<br/>			if (idJDBResult != JDEDB_PASSED)<br/>			{<br/>				I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX03"), _J("102"),NID_F7601B);<br/>				<br/>				bErrorFound = TRUE;<br/>			}<br/>			else<br/>			{<br/>				lpdsWF-&gtbF7611B_OpenYN = TRUE;<br/>			}<br/><br/>		}<br/><br/><br/>		if(lpdsWF-&gtbF7611B_OpenYN)<br/>		{<br/><br/>			/* Nota Fiscal Number */<br/>			<br/>			MathCopy (&lpdsWF-&gtdsF7611BKey1.fdbnnf, &lpdsWF-&gtmnNotaFiscalNumber);<br/>			<br/>			/* Nota Fiscal Serie */<br/>			<br/>			jdeStrcpy (lpdsWF-&gtdsF7611BKey1.fdbser, lpdsWF-&gtszNotaFiscalSeries);<br/>			<br/>			/* Nota Fiscal Next Number */<br/>			<br/>			MathCopy (&lpdsWF-&gtdsF7611BKey1.fdn001, &lpdsWF-&gtmnNextNumber001);<br/>			<br/>			/* Doc Type */<br/>			<br/>			jdeStrcpy (lpdsWF-&gtdsF7611BKey1.fddct, lpdsWF-&gtszDocumentType);<br/><br/><br/>			idJDBResult = JDB_SelectKeyed(lpdsWF-&gthReqF7611B, ID_F7611B_NOTAFISCALDET, <br/>											(void *) &lpdsWF-&gtdsF7611BKey1, (ushort) 4);<br/><br/>			idJDBResult = JDB_Fetch (lpdsWF-&gthReqF7611B, (void *)&lpdsWF-&gtdsF7611B, 0);<br/><br/><br/>			while (idJDBResult == JDEDB_PASSED && !bErrorFound)<br/>			{<br/><br/><br/>					/* Nota Fiscal Number */<br/>					<br/>					MathCopy (&lpdsWF-&gtdsF7611BKey2.fdbnnf, &lpdsWF-&gtmnNotaFiscalNumber);<br/>					<br/>					/* Nota Fiscal Serie */<br/>					<br/>					jdeStrcpy (lpdsWF-&gtdsF7611BKey2.fdbser, lpdsWF-&gtszNotaFiscalSeries);<br/>					<br/>					/* Nota Fiscal Next Number */<br/>					<br/>					MathCopy (&lpdsWF-&gtdsF7611BKey2.fdn001, &lpdsWF-&gtmnNextNumber001);<br/>					<br/>					/* Doc Type */<br/>					<br/>					jdeStrcpy (lpdsWF-&gtdsF7611BKey2.fddct, lpdsWF-&gtszDocumentType);<br/><br/>					/* Line Number */<br/><br/>					MathCopy (&lpdsWF-&gtdsF7611BKey2.fdukid, &lpdsWF-&gtdsF7611B.fdukid);<br/><br/><br/><br/><br/>					/* Legal Number Date */<br/>					/* ----------------- */<br/>						<br/>					if(lpdsWF-&gtbLegalNumberInformed)<br/>					{<br/>							<br/>						/* Legal Number Date */<br/>					/* Juliano Rach - 22/10/2010 */<br/>		        	/* Comentado por que esta atualização queima a data de emissão no caso de Emitir o Notão */	<br/>					/*	JDEDATECopy(&lpdsWF-&gtdsF7611B.fdissu , &lpdsWF-&gtdsF5576B0E.fh55elnd ); */<br/>							<br/>						<br/>					}<br/>				<br/>				<br/>					/* Audit Info */<br/>					<br/>					jdeStrcpy(lpdsWF-&gtdsF7611B.fduser,lpDS-&gtszAuditInfoUserId);<br/>					jdeStrcpy(lpdsWF-&gtdsF7611B.fdpid,lpDS-&gtszAuditInfoProgramId);<br/>					jdeStrcpy(lpdsWF-&gtdsF7611B.fdjobn,lpDS-&gtszAuditInfoWorkStationId);<br/>					JDEDATECopy(&lpdsWF-&gtdsF7611B.fdupmj , &lpDS-&gtjdAuditInfoDateUpdated );<br/>					MathCopy (&lpdsWF-&gtdsF7611B.fdtday, &lpDS-&gtmnAuditInfoTimeLastUpdated);<br/>				<br/>				<br/>					idJDBResult = JDB_UpdateTable(	 lpdsWF-&gthReqF7611B, <br/>													 NID_F7611B, 	<br/>													 (ID) 0,<br/>													 (ID) ID_F7611B_NOTAFISCALDET,<br/>													 &lpdsWF-&gtdsF7611BKey2,<br/>													 5, <br/>													 &lpdsWF-&gtdsF7611B);<br/>						<br/>					if (idJDBResult != JDEDB_PASSED)<br/>					{<br/>					<br/>						jdeTraceSz(NULL, _J("B76BX001 - Update F7611B failed"));<br/>						I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX15"), _J("113"),NID_F7611B);<br/>						bErrorFound = TRUE;	<br/>					<br/>					}<br/>					<br/>					<br/>					idJDBResult = JDB_Fetch (lpdsWF-&gthReqF7611B, (void *)&lpdsWF-&gtdsF7611B, 0);<br/><br/><br/><br/>			}<br/><br/><br/>	<br/><br/>		}<br/><br/>		<br/>	<br/><br/>	}<br/><br/><br/>	/* Set Error */<br/><br/>	if(lpDS-&gtcXMLDocumentStatus == _J('E'))<br/>	{<br/><br/>		bErrorFound = TRUE;<br/><br/><br/>	}<br/><br/>						<br/>	return bErrorFound;<br/><br/>}<br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_SetXMLError<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>void I76BX002_SetXMLError(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS, JCHAR * szErrorCode, JCHAR * szXMLErrorCode, JCHAR * szElementName, JCHAR * szElementValue)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/><br/>	DSDE76BX01				dsDE76BX01 = {0};<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/><br/>	<br/>	jdeStrcpy(lpDS-&gtszErrorCode,szErrorCode);<br/>	jdeStrcpy(lpDS-&gtszXMLErrorCode,szXMLErrorCode);<br/><br/><br/>	if(lpDS-&gtcSuppressErrorMessage != _J('1'))<br/>	{<br/>		memset((void *)(&dsDE76BX01), (int)(_J('\0')), sizeof(dsDE76BX01));<br/>		jdeStrcpy(dsDE76BX01.szElementName,szElementName );<br/>		jdeStrcpy(dsDE76BX01.szElementValue,szElementValue );<br/>		jdeStripTrailingBlanks(dsDE76BX01.szElementName);<br/>		jdeStripTrailingBlanks(dsDE76BX01.szElementValue);<br/>		jdeSetGBRErrorSubText(lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, &dsDE76BX01);<br/><br/>	}<br/><br/><br/>}<br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_SetXMLError<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>void I76BX002_SetTableError(LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD5576BX002 lpDS, JCHAR * szErrorCode, JCHAR * szXMLErrorCode, JCHAR * szFileName)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	<br/>	DSDE76BX02				dsDE76BX02 = {0};<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	jdeStrcpy(lpDS-&gtszErrorCode,szErrorCode);<br/>	jdeStrcpy(lpDS-&gtszXMLErrorCode,szXMLErrorCode);<br/><br/><br/>	if(lpDS-&gtcSuppressErrorMessage != _J('1'))<br/>	{<br/>		memset((void *)(&dsDE76BX02), (int)(_J('\0')), sizeof(dsDE76BX02));<br/>		jdeStrcpy(dsDE76BX02.szObjectName,szFileName );<br/>	<br/>		jdeSetGBRErrorSubText(lpBhvrCom, lpVoid, (ID) 0, lpDS-&gtszErrorCode, &dsDE76BX02);<br/><br/>	}<br/><br/><br/>}<br/><br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_ConvertTimeFromString<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_ConvertTimeFromString(LPMATH_NUMERIC lpmnTime, JCHAR * szTime)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/><br/>	BOOL bErrorFound = TRUE;<br/><br/>	JDECM_RESULT		eResult;<br/><br/>	JCHAR     szTimeTmp[7] = {0};<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	ZeroMathNumeric(lpmnTime);<br/><br/><br/>	if(jdeStrlen(szTime) == 8)<br/>	{<br/><br/><br/>		/* Hour */<br/><br/>		szTimeTmp[0] = szTime[0];<br/>		szTimeTmp[1] = szTime[1];<br/><br/>		/* Minutes */<br/><br/>		szTimeTmp[2] = szTime[3];<br/>		szTimeTmp[3] = szTime[4];<br/><br/>		/* Seconds */<br/><br/>		szTimeTmp[4] = szTime[6];<br/>		szTimeTmp[5] = szTime[7];<br/><br/><br/>		szTime[6] = _J('\0');<br/><br/><br/>		eResult = ParseNumericString(lpmnTime,szTimeTmp);<br/>		<br/>		if (eResult == MATH_SUCCESS)<br/>		{<br/>		<br/>			bErrorFound = FALSE;<br/><br/>		}<br/><br/>	}<br/><br/>	return bErrorFound;<br/><br/>}<br/><br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_IsDuplicateLegalNFNumber<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/><br/>BOOL I76BX002_IsDuplicateLegalNFNumber(	LPBHVRCOM lpBhvrCom, <br/>										LPVOID lpVoid, <br/>										HUSER hUser, <br/>										LPDSD5576BX002 lpDS, <br/>										LPMATH_NUMERIC lpmnNFLegalNumber,<br/>										BOOL				*lpbDup)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL				bErrorFound	= FALSE;<br/>	ID                idJDBResult    = JDEDB_PASSED;<br/><br/><br/>	HREQUEST		    hReqF5576B0E;<br/><br/>	JCHAR				szNFLegalNumber[31] = {0};<br/><br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/><br/>	  F5576B0E			dsF5576B0E;<br/>	  KEY2_F5576B0E		dsF5576B0EKey2;<br/>	<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	  <br/>	  /* Open Table */<br/>	  /* ========== */	  <br/>	  <br/><br/>	  idJDBResult = JDB_OpenTable(hUser, <br/>									NID_F5576B0E, <br/>									ID_F5576B0E_55ELN, <br/>									NULL, <br/>									0, <br/>									NULL, <br/>									&hReqF5576B0E);<br/><br/><br/>		if (idJDBResult == JDEDB_PASSED)<br/>		{<br/><br/><br/><br/>			/* Fetch Record */<br/>			/* ------------ */<br/><br/>			/* Legal Nota Fiscal Number */<br/><br/><br/>			FormatMathNumeric(szNFLegalNumber,lpmnNFLegalNumber);<br/><br/>			jdeStrncpy (dsF5576B0EKey2.fh55eln, szNFLegalNumber,DIM(dsF5576B0EKey2.fh55eln));<br/><br/><br/>			idJDBResult = JDB_FetchKeyed(hReqF5576B0E,<br/>	        							(ID) ID_F5576B0E_55ELN, <br/>										(void *)(&dsF5576B0EKey2), <br/>										(short)(1),<br/>										(void *)(&dsF5576B0E),<br/>										FALSE);<br/><br/><br/><br/>			if (idJDBResult == JDEDB_PASSED)<br/>			{<br/><br/>				*lpbDup = TRUE;<br/><br/><br/>			}<br/><br/>			JDB_CloseTable(hReqF5576B0E);<br/>		}<br/>		else<br/>		{<br/><br/>			I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX03"), _J("102"),NID_F5576B0E);<br/><br/>			bErrorFound = TRUE;<br/><br/>		}<br/><br/><br/>	return	bErrorFound;<br/><br/>}<br/><br/><br/><br/>/**************************************************************************<br/> *   Function:  I76BX002_SaveHistory<br/> *                           <br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/><br/>BOOL I76BX002_SaveHistory			(	LPBHVRCOM lpBhvrCom, <br/>										LPVOID lpVoid, <br/>										HUSER hUser, <br/>										LPDSD5576BX002 lpDS,<br/>										LPDSWorkingVariables02 lpdsWF)<br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>	BOOL				bErrorFound	= FALSE;<br/>	ID                  idJDBResult    = JDEDB_PASSED;<br/><br/><br/>	HREQUEST		    hReqF5576B2E;<br/><br/>	MATH_NUMERIC		mnLastSequence; <br/><br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/><br/>	F5576B2E			dsF5576B2E = {0};<br/>	  KEY4_F5576B2E		dsF5576B2EKey4 = {0};<br/>	<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/><br/>	  <br/>	  /* Open Table */<br/>	  /* ========== */	  <br/>	  <br/><br/>	  idJDBResult = JDB_OpenTable(hUser, <br/>									NID_F5576B2E, <br/>									ID_F5576B2E_BNNF_BSER_N001_DCT_SEQ_DESC, <br/>									NULL, <br/>									0, <br/>									NULL, <br/>									&hReqF5576B2E);<br/><br/><br/>		if (idJDBResult == JDEDB_PASSED)<br/>		{<br/><br/><br/><br/>			/* Fetch Las Sequence Record */<br/>			/* ------------------------- */<br/><br/><br/>			/* Nota Fiscal Number */<br/><br/>			MathCopy (&dsF5576B2EKey4.fhbnnf, &lpdsWF-&gtdsF5576B0E.fhbnnf);<br/><br/>			/* Nota Fiscal Serie */<br/><br/>			jdeStrcpy (dsF5576B2EKey4.fhbser, lpdsWF-&gtdsF5576B0E.fhbser);<br/><br/>			/* Nota Fiscal Next Number */<br/>		<br/>			MathCopy (&dsF5576B2EKey4.fhn001, &lpdsWF-&gtdsF5576B0E.fhn001);<br/><br/>			/* Doc Type */<br/><br/>			jdeStrcpy (dsF5576B2EKey4.fhdct, lpdsWF-&gtdsF5576B0E.fhdct);<br/><br/>			idJDBResult = JDB_SelectKeyed(hReqF5576B2E, ID_F5576B2E_BNNF_BSER_N001_DCT_SEQ_DESC, <br/>											(void *)&dsF5576B2EKey4, (ushort) 4);<br/><br/><br/>			idJDBResult = JDB_Fetch (hReqF5576B2E, (void *)&dsF5576B2E, 0);<br/><br/><br/><br/>			if (idJDBResult == JDEDB_PASSED)<br/>			{<br/><br/>				MathCopy(&mnLastSequence,&dsF5576B2E.fhseq); <br/>				<br/><br/><br/>			}<br/>			else<br/>			{<br/><br/>				ZeroMathNumeric(&mnLastSequence);<br/><br/>			}<br/><br/>			IncrementMathNumeric(&mnLastSequence,(int) 1);<br/><br/>			/* Save New Record */<br/><br/>			MathCopy(&dsF5576B2E.fhbnnf,&lpdsWF-&gtdsF5576B0E.fhbnnf);<br/>			jdeStrcpy (dsF5576B2E.fhbser, lpdsWF-&gtdsF5576B0E.fhbser);<br/>			MathCopy(&dsF5576B2E.fhn001,&lpdsWF-&gtdsF5576B0E.fhn001);<br/>			jdeStrcpy (dsF5576B2E.fhdct, lpdsWF-&gtdsF5576B0E.fhdct);<br/>			MathCopy(&dsF5576B2E.fhseq,&mnLastSequence);<br/>			jdeStrcpy (dsF5576B2E.fh55eln, lpdsWF-&gtdsF5576B0E.fh55eln);<br/>			JDEDATECopy(&dsF5576B2E.fh55elnd , &lpdsWF-&gtdsF5576B0E.fh55elnd );<br/>			MathCopy(&dsF5576B2E.fh55elnt,&lpdsWF-&gtdsF5576B0E.fh55elnt);<br/>			jdeStrcpy (dsF5576B2E.fh55ern, lpdsWF-&gtdsF5576B0E.fh55ern);<br/>			JDEDATECopy(&dsF5576B2E.fh55ernd , &lpdsWF-&gtdsF5576B0E.fh55ernd );<br/>			MathCopy(&dsF5576B2E.fh55ernt,&lpdsWF-&gtdsF5576B0E.fh55ernt);<br/>			jdeStrcpy (dsF5576B2E.fh55ean, lpdsWF-&gtdsF5576B0E.fh55ean);<br/>			JDEDATECopy(&dsF5576B2E.fh55eand , &lpdsWF-&gtdsF5576B0E.fh55eand );<br/>			MathCopy(&dsF5576B2E.fh55eant,&lpdsWF-&gtdsF5576B0E.fh55eant);<br/>			dsF5576B2E.fh55est = lpdsWF-&gtdsF5576B0E.fh55est;<br/>			jdeStrcpy (dsF5576B2E.fh55estc, lpdsWF-&gtdsF5576B0E.fh55estc);<br/>			JDEDATECopy(&dsF5576B2E.fh55estd , &lpdsWF-&gtdsF5576B0E.fh55estd );<br/>			jdeStrcpy (dsF5576B2E.fh55eref, lpdsWF-&gtdsF5576B0E.fh55eref);<br/>			jdeStrcpy (dsF5576B2E.fh55etpr, lpdsWF-&gtdsF5576B0E.fh55etpr);<br/>			jdeStrcpy (dsF5576B2E.fhurcd, lpdsWF-&gtdsF5576B0E.fhurcd);<br/>			JDEDATECopy(&dsF5576B2E.fhurdt , &lpdsWF-&gtdsF5576B0E.fhurdt );<br/>			MathCopy(&dsF5576B2E.fhurat,&lpdsWF-&gtdsF5576B0E.fhurat);<br/>			jdeStrcpy (dsF5576B2E.fhurrf, lpdsWF-&gtdsF5576B0E.fhurrf);<br/>			jdeStrcpy (dsF5576B2E.fhtorg, lpdsWF-&gtdsF5576B0E.fhtorg);<br/>			jdeStrcpy(dsF5576B2E.fhuser,lpdsWF-&gtdsF5576B0E.fhuser);<br/>			jdeStrcpy(dsF5576B2E.fhpid,lpdsWF-&gtdsF5576B0E.fhpid);<br/>			jdeStrcpy(dsF5576B2E.fhjobn,lpdsWF-&gtdsF5576B0E.fhjobn);<br/>			JDEDATECopy(&dsF5576B2E.fhupmj , &lpdsWF-&gtdsF5576B0E.fhupmj );<br/>			MathCopy (&dsF5576B2E.fhtday, &lpdsWF-&gtdsF5576B0E.fhtday);<br/><br/><br/><br/>			idJDBResult = JDB_InsertTable(hReqF5576B2E, NID_F5576B2E, (ID)0, &dsF5576B2E);<br/><br/><br/>			if (idJDBResult != JDEDB_PASSED)<br/>			{<br/>				jdeTraceSz(NULL, _J("B5576BX2 - Insert Into F5576B2E failed"));<br/>				I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX15"), _J("114"),NID_F5576B2E);<br/>				bErrorFound = TRUE;<br/><br/><br/>			}<br/><br/><br/><br/>			JDB_CloseTable(hReqF5576B2E);<br/><br/><br/>		}<br/>		else<br/>		{<br/>			I76BX002_SetTableError(lpBhvrCom,lpVoid,lpDS, _J("B76EX03"), _J("102"),NID_F5576B2E);<br/>			bErrorFound = TRUE;<br/><br/>		}<br/><br/><br/>	return	bErrorFound;<br/><br/>}<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/></pre></div></div></body></html>