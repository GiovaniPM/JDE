<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B570810 - B570810 - BSFN Calculo de Executado<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: B570810 - BSFN Calculo de Executado - [CalculaExecutadoMulti]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570810A - DSTR Carga de Executado                                     </B><BR>BF mnAnoMesEntrada_ANMESENT [ANMESENT]<BR>BF szArvor_UNID1 [UNID1]<BR>BF cErro_ERR [ERR]<BR></div><pre><div class='dstrmembers'><B>Header File: b570810.h</B><BR></div><br/>/*****************************************************************************<br/> *    Header File:  B570810.h<br/> *<br/> *    Description:  BSFN Calculo de Executado Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 09/09/09    Unknown     Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/><br/>#ifndef __B570810_H<br/>#define __B570810_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf570810.h&gt<br/>#include &ltf570811.h&gt<br/>#include &ltb9800100.h&gt<br/><br/>/*****************************************************************************<br/> * External Business Function Header Inclusions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Global Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/>typedef struct tagKeyF570810<br/>{           <br/><br/>   MATH_NUMERIC   peanmesent;          /* 0 to 48 */<br/>   MATH_NUMERIC   penivc;              /* 49 to 97 */<br/>   MATH_NUMERIC   penivp;              /* 98 to 146 */<br/>   JCHAR           peunid1[4];          /* 147 to 150 */           <br/>   JCHAR           pecup[9];            /* 151 to 159 */<br/><br/>} DSKeyF570810, *LPDSKeyF570810;<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Carga de Executado<br/> *    Template ID:   D570810A<br/> *    Generated:     Wed Sep 23 09:58:57 2009<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570810A<br/>#define DATASTRUCTURE_D570810A<br/><br/>typedef struct tagDSD570810A<br/>{<br/>  MATH_NUMERIC      mnAnoMesEntrada_ANMESENT;            <br/>  JCHAR              szArvor_UNID1[4];                    <br/>  JCHAR              cErro_ERR;                           <br/>} DSD570810A, *LPDSD570810A;<br/><br/>#define IDERRmnAnoMesEntrada_ANMESENT_6           6L<br/>#define IDERRszArvor_UNID1_11                     11L<br/>#define IDERRcErro_ERR_12                         12L<br/><br/>#endif<br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Carga de Executado<br/> *    Template ID:   D570810B<br/> *    Generated:     Wed Sep 23 16:04:10 2009<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570810B<br/>#define DATASTRUCTURE_D570810B<br/><br/>typedef struct tagDSD570810B<br/>{<br/>  MATH_NUMERIC      mnAnoMesEntrada_ANMESENT;            <br/>  JCHAR              szArvor_UNID1[4];                    <br/>  JCHAR              cErro_ERR;                           <br/>} DSD570810B, *LPDSD570810B;<br/><br/>#define IDERRmnAnoMesEntrada_ANMESENT_6           6L<br/>#define IDERRszArvor_UNID1_11                     11L<br/>#define IDERRcErro_ERR_12                         12L<br/><br/>#endif<br/><br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI CalculaExecutadoMulti            (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570810A lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI LimpaTabelaExec                  (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570810B lpDS);<br/><br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/>void I570810A_CalculaPedidosExecutados(F570810 *dsF570810, LPBHVRCOM lpBhvrCom);<br/>void I570810B_EspandeCalculaArvore(F570810 *dsPaiF570810, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100);<br/>void I570810C_ZeraArvore(LPDSD570810A lpDS, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100);<br/><br/>#endif    /* __B570810_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b570810.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b570810_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b570810<br/> *<br/> *    Description:  BSFN Calculo de Executado Source File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 09/09/09    Unknown     Unknown  - Created  <br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb570810.h&gt<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  CalculaExecutadoMulti<br/> *<br/> *        Description:  Calcula Executado de Todos os Niveis<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810A        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CalculaExecutadoMulti (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570810A lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570810[4]					= { 0 };<br/>	F570810				dsF570810						= { 0 };<br/>	KEY1_F570810		dsKeyF570810					= { 0 };<br/>	int					iCount							= 0;<br/>	DSD9800100		    dsB9800100						;<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570810						= (HREQUEST)NULL;<br/>	HREQUEST		    hReqF570810_UP					= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570810A)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	ZeroMathNumeric(&mnZero);<br/>	lpDS-&gtcErro_ERR = _J(' ');<br/>	iCount = 0;<br/>	memset((void *)(&dsB9800100), (int)(_J('\0')), sizeof(DSD9800100));<br/><br/>	I570810C_ZeraArvore(lpDS, lpBhvrCom, dsB9800100);<br/>    jdeCallObject(_J("GetAuditInfo"), NULL, lpBhvrCom, lpVoid, &dsB9800100,<br/>                  (CALLMAP *) NULL, (int)(0), (JCHAR *) NULL, (JCHAR *) NULL,<br/>                  CALL_OBJECT_NO_ERRORS);<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570810"), DIM(_J("B570810")));<br/><br/>	jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>    lpF570810[iCount].Item1.idInstance = 0;<br/>	lpF570810[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada_ANMESENT;<br/>	lpF570810[iCount].nValues = 1;<br/>    lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_NIVP );<br/>	jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>	lpF570810[iCount].Item1.idInstance = 0;<br/>	lpF570810[iCount].lpValue = &mnZero;<br/>	lpF570810[iCount].nValues = 1;<br/>	lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>	lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if(!IsStringBlank(lpDS-&gtszArvor_UNID1))<br/>	{<br/>		jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_UNID1 );<br/>		jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>		lpF570810[iCount].Item1.idInstance = 0;<br/>		lpF570810[iCount].lpValue = &lpDS-&gtszArvor_UNID1;<br/>		lpF570810[iCount].nValues = 1;<br/>		lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570810);<br/>		idJDBReturn = JDB_SetSelection(hReqF570810, lpF570810, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570810, (ID) 0, (void *) NULL, (short)(0));<br/><br/>	} else {<br/>		lpDS-&gtcErro_ERR = _J('A'); // Erro no Open Table<br/>	}<br/><br/>	while(JDB_Fetch( hReqF570810 , &dsF570810 , 0 ))<br/>	{<br/>		I570810B_EspandeCalculaArvore(&dsF570810, lpBhvrCom, dsB9800100);<br/><br/>		// Atualiza o valor Executado e Abatido<br/>		/* carrega chave */<br/>		MathCopy(&dsKeyF570810.peanmesent, &dsF570810.peanmesent);<br/>		MathCopy(&dsKeyF570810.penivc, &dsF570810.penivc);<br/>		MathCopy(&dsKeyF570810.penivp, &dsF570810.penivp);<br/>		jdeStrncpy(dsKeyF570810.peunid1, (const JCHAR *) dsF570810.peunid1, DIM(dsF570810.peunid1));<br/>		jdeStrncpy(dsKeyF570810.pecup, (const JCHAR *) dsF570810.pecup, DIM(dsF570810.pecup));<br/>        //<br/>		jdeStrncpy(dsF570810.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsF570810.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsF570810.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsF570810.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsF570810.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/><br/>		/* Atualiza */<br/>		JDB_UpdateTable(hReqF570810_UP, NID_F570810, (ID)0, ID_F570810_ANOMES_NIVC_NIVP_UNID1__CUP,<br/>							(void *)&dsKeyF570810, (short)5, (void *)&dsF570810);<br/><br/>	}<br/><br/>	<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570810 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810);<br/><br/>	if (hReqF570810_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/><br/><br/>   return (ER_SUCCESS);<br/>}<br/>/**************************************************************************<br/> *  Business Function:  LimpaTabelaExec<br/> *<br/> *        Description:  Limpa Tabela de Executado (Delete)<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810B        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI LimpaTabelaExec (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570810B lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn						=  JDEDB_PASSED;<br/>	int					iCount							= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570811[4]					= { 0 };<br/>	F570811				dsF570811						= { 0 };<br/>	KEY1_F570811		dsKeyF570811					= { 0 };     <br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER				hUser							= (HUSER)NULL;<br/>	HREQUEST			hReqF570811						= (HREQUEST)NULL;<br/>	HREQUEST			hDelF570811						= (HREQUEST)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570810B)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	lpDS-&gtcErro_ERR = _J(' ');<br/>	iCount = 0;<br/><br/>	jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_ANMEEMI );<br/>    jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>    lpF570811[iCount].Item1.idInstance = 0;<br/>	lpF570811[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada_ANMESENT;<br/>	lpF570811[iCount].nValues = 1;<br/>    lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if(!IsStringBlank(lpDS-&gtszArvor_UNID1))<br/>	{<br/>		jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_UNID1 );<br/>		jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>		lpF570811[iCount].Item1.idInstance = 0;<br/>		lpF570811[iCount].lpValue = &lpDS-&gtszArvor_UNID1;<br/>		lpF570811[iCount].nValues = 1;<br/>		lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570811, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hDelF570811);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570811, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570811);<br/><br/>	if (idJDBReturn == JDEDB_FAILED)<br/>	{<br/>		lpDS-&gtcErro_ERR = _J('1');<br/>	} else {<br/><br/>		JDB_ClearSelection(hReqF570811);<br/>		idJDBReturn = JDB_SetSelection(hReqF570811, lpF570811, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570811, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		if (idJDBReturn == JDEDB_FAILED)<br/>		lpDS-&gtcErro_ERR = _J('2');<br/>	}<br/><br/><br/>	while(JDB_Fetch( hReqF570811 , &dsF570811 , 0 ))<br/>	{<br/>		/* carrega chave */<br/>		MathCopy(&dsKeyF570811.peanmeemi, &dsF570811.peanmeemi);<br/>		MathCopy(&dsKeyF570811.pecodprodu, &dsF570811.pecodprodu);<br/>		MathCopy(&dsKeyF570811.penrpedido, &dsF570811.penrpedido);<br/>		MathCopy(&dsKeyF570811.pedoc, &dsF570811.pedoc);<br/>		jdeStrncpy(dsKeyF570811.peunid1, dsF570811.peunid1, DIM(dsF570811.peunid1));<br/>		jdeStrncpy(dsKeyF570811.pecup, dsF570811.pecup, DIM(dsF570811.pecup));<br/>		//strncpy(dsKeyF570811.peht03, dsF570811.peht03, sizeof(dsF570811.peht03));<br/>		//<br/>		idJDBReturn = JDB_DeleteTable(hDelF570811, NID_F570811, 0, ID_F570811_DEFAULT, &dsKeyF570811, (short)6);<br/>	}<br/>	<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hDelF570811 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hDelF570811);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>   return (ER_SUCCESS);<br/>}<br/><br/>/* Internal function comment block */<br/>/**************************************************************************<br/> *   Function: I570810A_CalculaPedidosExecutados<br/> *                           <br/> *      Notes: Calcula total dos pedidos executados e abatimento para um<br/> *             nivel especifico da arvor sonando os valores existentes na <br/> *			   tabela F570811.<br/> *<br/> *    Returns: Atualiza dentro da estrutura da tabela F570810 os campos<br/> *             PEVLREXPRZ e PEVLRTOTAB.<br/> *<br/> * Parameters: Etrutura da tabela F570810 com os dados da linha da tabela<br/> *             a qual deve ser atualizada<br/> **************************************************************************/<br/>void I570810A_CalculaPedidosExecutados(F570810 *dsF570810, LPBHVRCOM lpBhvrCom) {<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn						=  JDEDB_PASSED;<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	 MATH_NUMERIC			mnTotalExecutado				= { 0 };<br/>	 MATH_NUMERIC			mnTotalAbatimento				= { 0 };<br/>	 SELECTSTRUCT		    lpF570811[6]					= { 0 };<br/>	 F570811				dsF570811						= { 0 };<br/>	 int					iCount							= 0;<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570811						= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	<br/><br/>   	 ZeroMathNumeric(&mnTotalExecutado);<br/>	 ZeroMathNumeric(&mnTotalAbatimento);<br/>	 iCount = 0;<br/><br/>	 jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_ANMEEMI );<br/>     jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>     lpF570811[iCount].Item1.idInstance = 0;<br/>	 lpF570811[iCount].lpValue = &dsF570810-&gtpeanmesent;<br/>	 lpF570811[iCount].nValues = 1;<br/>     lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_NIVC );<br/>     jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>     lpF570811[iCount].Item1.idInstance = 0;<br/>	 lpF570811[iCount].lpValue = &dsF570810-&gtpenivc;<br/>	 lpF570811[iCount].nValues = 1;<br/>     lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_NIVP );<br/>     jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>     lpF570811[iCount].Item1.idInstance = 0;<br/>	 lpF570811[iCount].lpValue = &dsF570810-&gtpenivp;<br/>	 lpF570811[iCount].nValues = 1;<br/>     lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_UNID1 );<br/>     jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>     lpF570811[iCount].Item1.idInstance = 0;<br/>	 lpF570811[iCount].lpValue = &dsF570810-&gtpeunid1;<br/>	 lpF570811[iCount].nValues = 1;<br/>     lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>   	 jdeNIDcpy( lpF570811[iCount].Item1.szDict , NID_CUP );<br/>     jdeNIDcpy( lpF570811[iCount].Item1.szTable , NID_F570811 );<br/>     lpF570811[iCount].Item1.idInstance = 0;<br/>	 lpF570811[iCount].lpValue = &dsF570810-&gtpecup;<br/>	 lpF570811[iCount].nValues = 1;<br/>     lpF570811[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570811[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/>   <br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F570811, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570811);<br/><br/>	 if (idJDBReturn != JDEDB_FAILED)<br/>	 {<br/>		 JDB_ClearSelection(hReqF570811);<br/>		 idJDBReturn = JDB_SetSelection(hReqF570811, lpF570811, (short)iCount, JDEDB_SET_REPLACE);<br/>		 idJDBReturn = JDB_SelectKeyed(hReqF570811, (ID)(0), (void *) NULL, (short)(0));<br/>	 }<br/>		<br/>	 while(JDB_Fetch( hReqF570811 , &dsF570811 , 0 ))<br/>	 {<br/> 		MathAdd(&mnTotalExecutado, &mnTotalExecutado, &dsF570811.pevlrtotbr);<br/>		MathAdd(&mnTotalAbatimento, &mnTotalAbatimento, &dsF570811.pevlrtotab);<br/>	 }<br/><br/>	 MathAdd(&dsF570810-&gtpevlrexprz, &dsF570810-&gtpevlrexprz, &mnTotalExecutado);<br/>	 MathAdd(&dsF570810-&gtpevlrtotab, &dsF570810-&gtpevlrtotab, &mnTotalAbatimento);<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570811 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570811);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/><br/> }<br/><br/>/**************************************************************************<br/> *   Function: I570810B_EspandeCalculaArvore<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570810B_EspandeCalculaArvore(F570810 *dsPaiF570810, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100) {<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/>	<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	 MATH_NUMERIC			mnTotalExecutado				= { 0 };<br/>	 MATH_NUMERIC			mnTotalAbatimento				= { 0 };<br/>	 SELECTSTRUCT		    lpF570810[4]					= { 0 };<br/>	 F570810				dsF570810						= { 0 };<br/>	 KEY1_F570810			dsKeyF570810					= { 0 };<br/>	 int					iCount							= 0;<br/>	 <br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			    hReqF570810						= (HREQUEST)NULL;<br/>	HREQUEST			    hReqF570810_UP					= (HREQUEST)NULL;<br/>	HUSER					hUser							= (HUSER)NULL;<br/>	<br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	 ZeroMathNumeric(&mnTotalExecutado);<br/>	 ZeroMathNumeric(&mnTotalAbatimento);<br/>   	 iCount = 0;<br/>	 jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570810"), DIM(_J("B570810")));<br/><br/>	 jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_UNID1 );<br/>     jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>     lpF570810[iCount].Item1.idInstance = 0;<br/>	 lpF570810[iCount].lpValue = &dsPaiF570810-&gtpeunid1;<br/>	 lpF570810[iCount].nValues = 1;<br/>     lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_ANMESENT );<br/>     jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>     lpF570810[iCount].Item1.idInstance = 0;<br/>	 lpF570810[iCount].lpValue = &dsPaiF570810-&gtpeanmesent;<br/>	 lpF570810[iCount].nValues = 1;<br/>     lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/><br/>	 jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_NIVP );<br/>     jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>     lpF570810[iCount].Item1.idInstance = 0;<br/>	 lpF570810[iCount].lpValue = &dsPaiF570810-&gtpenivc;<br/>	 lpF570810[iCount].nValues = 1;<br/>     lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 if (MathZeroTest(&dsPaiF570810-&gtpenivp))<br/>	 {<br/>		 jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_CUP );<br/>		 jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>		 lpF570810[iCount].Item1.idInstance = 0;<br/>		 lpF570810[iCount].lpValue = &dsPaiF570810-&gtpecup;<br/>		 lpF570810[iCount].nValues = 1;<br/>		 lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		 lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>		 iCount++;<br/>	 }<br/><br/>     <br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810_UP);<br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810);<br/>	 <br/>	 if (idJDBReturn != JDEDB_FAILED)<br/>	 {<br/>		 JDB_ClearSelection(hReqF570810);<br/>		 idJDBReturn = JDB_SetSelection(hReqF570810, lpF570810, (short)iCount, JDEDB_SET_REPLACE);<br/>		 idJDBReturn = JDB_SelectKeyed(hReqF570810, (ID)(0), (void *) NULL, (short)(0));<br/>	 }<br/>		<br/>	 while(JDB_Fetch( hReqF570810 , &dsF570810 , 0 ))<br/>	 {<br/>		// Zera Valores de Realizado e Abatimento<br/>		ZeroMathNumeric(&dsF570810.pevlrexprz);<br/>		ZeroMathNumeric(&dsF570810.pevlrtotab);<br/> 		<br/>		// Chama as Funcoes para Calculo de Executado dele e dos Filhos<br/>		I570810A_CalculaPedidosExecutados(&dsF570810, lpBhvrCom);<br/>		I570810B_EspandeCalculaArvore(&dsF570810, lpBhvrCom, dsB9800100);<br/>		<br/>		// Atualiza o valor Executado e Abatido<br/>		/* carrega chave */<br/>		MathCopy(&dsKeyF570810.peanmesent, &dsF570810.peanmesent);<br/>		MathCopy(&dsKeyF570810.penivc, &dsF570810.penivc);<br/>		MathCopy(&dsKeyF570810.penivp, &dsF570810.penivp);<br/>		jdeStrncpy(dsKeyF570810.peunid1, (const JCHAR *) dsF570810.peunid1, DIM(dsKeyF570810.peunid1));<br/>		jdeStrncpy(dsKeyF570810.pecup, (const JCHAR *) dsF570810.pecup, DIM(dsKeyF570810.pecup));<br/>		//<br/><br/>		jdeStrncpy(dsF570810.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsF570810.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsF570810.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsF570810.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsF570810.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>		/* Atualiza */<br/>		JDB_UpdateTable(hReqF570810_UP, NID_F570810, (ID)0, ID_F570810_ANOMES_NIVC_NIVP_UNID1__CUP, (void *)&dsKeyF570810, (short)5, (void *)&dsF570810);<br/><br/><br/>		// Acumula o Valor para o Executado do Pai<br/>		MathAdd(&mnTotalExecutado, &mnTotalExecutado, &dsF570810.pevlrexprz);<br/>		MathAdd(&mnTotalAbatimento, &mnTotalAbatimento, &dsF570810.pevlrtotab);<br/><br/>	 }<br/>	<br/>	 //JDB_CloseTable(hReqF570810);<br/>	 //JDB_CloseTable(hReqF570810_UP);<br/>	 MathAdd(&dsPaiF570810-&gtpevlrexprz, &dsPaiF570810-&gtpevlrexprz, &mnTotalExecutado);<br/>	 MathAdd(&dsPaiF570810-&gtpevlrtotab, &dsPaiF570810-&gtpevlrtotab, &mnTotalAbatimento);<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570810 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810);<br/><br/>	if (hReqF570810_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/><br/><br/>/**************************************************************************<br/> *   Function: I570810C_ZeraArvore<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570810C_ZeraArvore(LPDSD570810A lpDS, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100) {<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	 SELECTSTRUCT		    lpF570810[4]					= { 0 };<br/>	 F570810				dsF570810						= { 0 };<br/>	 KEY1_F570810			dsKeyF570810					= { 0 };<br/>	 int					iCount							= 0;<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			    hReqF570810						= (HREQUEST)NULL;<br/>	HREQUEST			    hReqF570810_UP					= (HREQUEST)NULL;<br/>	HUSER					hUser							= (HUSER)NULL;<br/>	<br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	// Zera Valores de Realizado e Abatimento<br/>   	 iCount = 0;<br/>	 jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570810"), DIM(_J("B570810")));<br/><br/>	jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>    lpF570810[iCount].Item1.idInstance = 0;<br/>	lpF570810[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada_ANMESENT;<br/>	lpF570810[iCount].nValues = 1;<br/>    lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if(!IsStringBlank(lpDS-&gtszArvor_UNID1))<br/>	{<br/>		jdeNIDcpy( lpF570810[iCount].Item1.szDict , NID_UNID1 );<br/>		jdeNIDcpy( lpF570810[iCount].Item1.szTable , NID_F570810 );<br/>		lpF570810[iCount].Item1.idInstance = 0;<br/>		lpF570810[iCount].lpValue = &lpDS-&gtszArvor_UNID1;<br/>		lpF570810[iCount].nValues = 1;<br/>		lpF570810[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570810[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>     <br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810_UP);<br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F570810, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570810);<br/>	 <br/>	 if (idJDBReturn != JDEDB_FAILED)<br/>	 {<br/>		 JDB_ClearSelection(hReqF570810);<br/>		 idJDBReturn = JDB_SetSelection(hReqF570810, lpF570810, (short)iCount, JDEDB_SET_REPLACE);<br/>		 idJDBReturn = JDB_SelectKeyed(hReqF570810, (ID)(0), (void *) NULL, (short)(0));<br/>	 }<br/>		<br/>	 while(JDB_Fetch( hReqF570810 , &dsF570810 , 0 ))<br/>	 {<br/><br/>		// Atualiza o valor Executado e Abatido<br/>		/* carrega chave */<br/>		MathCopy(&dsKeyF570810.peanmesent, &dsF570810.peanmesent);<br/>		MathCopy(&dsKeyF570810.penivc, &dsF570810.penivc);<br/>		MathCopy(&dsKeyF570810.penivp, &dsF570810.penivp);<br/>		jdeStrncpy(dsKeyF570810.peunid1, (const JCHAR *) dsF570810.peunid1, DIM(dsF570810.peunid1));<br/>		jdeStrncpy(dsKeyF570810.pecup, (const JCHAR *) dsF570810.pecup, DIM(dsF570810.pecup));<br/>		//<br/><br/>		ZeroMathNumeric(&dsF570810.pevlrexprz);<br/>		ZeroMathNumeric(&dsF570810.pevlrtotab);<br/><br/>		jdeStrncpy(dsF570810.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsF570810.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsF570810.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsF570810.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsF570810.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>		/* Atualiza */<br/>		JDB_UpdateTable(hReqF570810_UP, NID_F570810, (ID)NULL, ID_F570810_ANOMES_NIVC_NIVP_UNID1__CUP,<br/>					    (void *)&dsKeyF570810, (short)5, &dsF570810);<br/><br/>	 }<br/>	<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570810 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810);<br/><br/>	if (hReqF570810_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570810_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/><br/></pre></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: B570810 - BSFN Calculo de Executado - [LimpaTabelaExec]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570810B - DSTR Limpa Tabela de Exec                                   </B><BR>BF mnAnoMesEntrada_ANMESENT [ANMESENT]<BR>BF szArvor_UNID1 [UNID1]<BR>BF cErro_ERR [ERR]<BR></div></div></div></body></html>