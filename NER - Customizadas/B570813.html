<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B570813 - BSFN Historico Executado<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: BSFN Historico Executado - [CachePremiacao]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570813C - DSTR Validacao de Pai                                       </B><BR>BF cCacheActionCode [EV01]<BR>BF cReturnCursor [EV01]<BR>BF idCursor [HCACHE]<BR>BF cCacheCodeError [ERR]<BR>BF mnJobnumberA [JOBS]<BR>BF mnNivelPai_NIVP [NIVP]<BR>BF mnCodProduto_CODPRODU [CODPRODU]<BR>BF mnNrPedido_NRPEDIDO [NRPEDIDO]<BR>BF szUnid1_UNID1 [UNID1]<BR></div><pre><div class='dstrmembers'><B>Header File: b570813.h</B><BR></div><br/>/*****************************************************************************<br/> *    Header File:  B570813.h<br/> *<br/> *    Description:  BSFN Historico Executado Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 05/10/09    Unknown     Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>	<br/>#ifndef __B570813_H<br/>#define __B570813_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf570810.h&gt<br/>#include &ltf570813.h&gt<br/>#include &ltf570823l.h&gt<br/>#include &ltb9800100.h&gt<br/><br/>/*****************************************************************************<br/> * External Business Function Header Inclusions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Global Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/>typedef struct tagCache<br/>{           <br/><br/>  MATH_NUMERIC      mnNivelPai_NIVP;                     <br/>  MATH_NUMERIC      mnCodProduto_CODPRODU;               <br/>  MATH_NUMERIC      mnNrPedido_NRPEDIDO;                 <br/>  JCHAR              szUnid1_UNID1[4];              <br/><br/>} DSCache, *LPDSCache;<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Cria Produto Acima<br/> *    Template ID:   D570813A<br/> *    Generated:     Wed Oct 14 09:47:46 2009<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570813A<br/>#define DATASTRUCTURE_D570813A<br/><br/>typedef struct tagDSD570813A<br/>{<br/>  MATH_NUMERIC      mnAnoMesEntrada_ANMESENT;            <br/>  MATH_NUMERIC      mnNivelPai_NIVP;                     <br/>  MATH_NUMERIC      mnNivelCorrente_NIVC;                <br/>  MATH_NUMERIC      mnCliente_AN8;                       <br/>  MATH_NUMERIC      mnAgencia_CMC1;                      <br/>  JCHAR              cCliAge_CLIEAGE;                     <br/>  MATH_NUMERIC      mnCodProduto_CODPRODU;               <br/>} DSD570813A, *LPDSD570813A;<br/><br/>#define IDERRmnAnoMesEntrada_ANMESENT_1           1L<br/>#define IDERRmnNivelPai_NIVP_2                    2L<br/>#define IDERRmnNivelCorrente_NIVC_8               8L<br/>#define IDERRmnCliente_AN8_9                      9L<br/>#define IDERRmnAgencia_CMC1_10                    10L<br/>#define IDERRcCliAge_CLIEAGE_12                   12L<br/>#define IDERRmnCodProduto_CODPRODU_13             13L<br/><br/>#endif<br/><br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Calcula Arvore<br/> *    Template ID:   D570813B<br/> *    Generated:     Wed Oct 07 16:45:42 2009<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570813B<br/>#define DATASTRUCTURE_D570813B<br/><br/>typedef struct tagDSD570813B<br/>{<br/>  MATH_NUMERIC      mnAnoMesEntrada_ANMESENT;            <br/>  JCHAR              cErro_ERR;                           <br/>} DSD570813B, *LPDSD570813B;<br/><br/>#define IDERRmnAnoMesEntrada_ANMESENT_6           6L<br/>#define IDERRcErro_ERR_16                         16L<br/><br/>#endif<br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Validacao de Pai<br/> *    Template ID:   D570813C<br/> *    Generated:     Fri Oct 16 11:21:41 2009<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570813C<br/>#define DATASTRUCTURE_D570813C<br/><br/>typedef struct tagDSD570813C<br/>{<br/>  JCHAR              cCacheActionCode;                    <br/>  JCHAR              cReturnCursor;                       <br/>  ID                idCursor;                            <br/>  JCHAR              cCacheCodeError;                     <br/>  MATH_NUMERIC      mnJobnumberA;                        <br/>  MATH_NUMERIC      mnNivelPai_NIVP;                     <br/>  MATH_NUMERIC      mnCodProduto_CODPRODU;               <br/>  MATH_NUMERIC      mnNrPedido_NRPEDIDO;                 <br/>  JCHAR              szUnid1_UNID1[4];                    <br/>} DSD570813C, *LPDSD570813C;<br/><br/>#define IDERRcCacheActionCode_1                   1L<br/>#define IDERRcReturnCursor_2                      2L<br/>#define IDERRidCursor_3                           3L<br/>#define IDERRcCacheCodeError_4                    4L<br/>#define IDERRmnJobnumberA_6                       6L<br/>#define IDERRmnNivelPai_NIVP_7                    7L<br/>#define IDERRmnCodProduto_CODPRODU_8              8L<br/>#define IDERRmnNrPedido_NRPEDIDO_9                9L<br/>#define IDERRszUnid1_UNID1_10                     10L<br/><br/>#endif<br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: DSTR Replica Agenca, Cliente, Produto para todo Historico<br/> *    Template ID:   D570813D<br/> *    Generated:     Mon Feb 13 09:52:30 2012<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570813D<br/>#define DATASTRUCTURE_D570813D<br/><br/>typedef struct tagDSD570813D<br/>{<br/>  MATH_NUMERIC      mnAnoMesEntrada_ANMESENT;            <br/>  MATH_NUMERIC      mnNumeroMeses_IA02;                  <br/>  MATH_NUMERIC      mnNivelPai_NIVP;                     <br/>  MATH_NUMERIC      mnNivelCorrente_NIVC;                <br/>  JCHAR              cCliAge_CLIEAGE;                     <br/>  MATH_NUMERIC      mnAddressNumber_AN8;                 <br/>  MATH_NUMERIC      mnCommissionCode1_CMC1;              <br/>  MATH_NUMERIC      mnCodProduto_CODPRODU;               <br/>  JCHAR              szUnidade_CUP[9];                    <br/>  MATH_NUMERIC      mnIDCRM_UKID;                        <br/>  JCHAR              szCnpj_TAX[21];                      <br/>  MATH_NUMERIC      mnValorFaturado;                     <br/>  MATH_NUMERIC      mnValorBruto;                        <br/>  MATH_NUMERIC      mnValorTabela;                       <br/>  MATH_NUMERIC      mnAnoMesMovimentacao;                <br/>} DSD570813D, *LPDSD570813D;<br/><br/>#define IDERRmnAnoMesEntrada_ANMESENT_1           1L<br/>#define IDERRmnNumeroMeses_IA02_2                 2L<br/>#define IDERRmnNivelPai_NIVP_3                    3L<br/>#define IDERRmnNivelCorrente_NIVC_4               4L<br/>#define IDERRcCliAge_CLIEAGE_5                    5L<br/>#define IDERRmnAddressNumber_AN8_6                6L<br/>#define IDERRmnCommissionCode1_CMC1_7             7L<br/>#define IDERRmnCodProduto_CODPRODU_8              8L<br/>#define IDERRszUnidade_CUP_9                      9L<br/>#define IDERRmnIDCRM_UKID_10                      10L<br/>#define IDERRszCnpj_TAX_11                        11L<br/>#define IDERRmnValorFaturado_12                   12L<br/>#define IDERRmnValorBruto_13                      13L<br/>#define IDERRmnValorTabela_14                     14L<br/>#define IDERRmnAnoMesMovimentacao_15              15L<br/><br/>#endif<br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI CriaProdutoAcima (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813A lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI CalculaArvore    (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813B lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI CachePremiacao                   (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813C lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI CriaClienteLado                  (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813D lpDS);<br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/>void I570813_CriaProdutoAcima (LPBHVRCOM lpBhvrCom, F570813 dsF570813, DSD9800100 dsB9800100);<br/>void I570813_EspandeCalculaArvore (F570813 *dsPaiF570813, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100);<br/>void I570813_CreateInitCache (LPDSD570813C lpDS, HUSER hUser, HCACHE *lpidCacheHandle);<br/>void I570813_CopyToLPDS (LPDSD570813C lpDS, LPDSCache lpdsCache);<br/>void I570813_CopyToStruct (LPDSCache lpdsCache, LPDSD570813C lpDS);<br/>//void I570813_InsertUpdateF570813 (HREQUEST *hF570813, F570813 dsRegistro);<br/><br/>#endif    /* __B570813_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b570813.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b570813_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b570813<br/> *<br/> *    Description:  BSFN Historico Executado Source File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 05/10/09    Unknown     Unknown  - Created  <br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb570813.h&gt<br/><br/>/**************************************************************************<br/> *  Business Function:  CriaProdutoAcima<br/> *<br/> *        Description:  Cria Produtos para os Niveis Acima<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570813A        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CriaProdutoAcima (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813A lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	<br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	F570813				dsF570813				= { 0 };<br/>	DSD9800100		    dsB9800100				= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570813A)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	<br/>    jdeCallObject(_J("GetAuditInfo"), NULL, lpBhvrCom, lpVoid, &dsB9800100,<br/>                  (CALLMAP *) NULL, (int)(0), (JCHAR *) NULL, (JCHAR *) NULL,<br/>                  CALL_OBJECT_NO_ERRORS);<br/><br/>	memset((void *)(&dsF570813), (int)(_J('\0')), sizeof(F570813));<br/>	MathCopy(&dsF570813.peanmesent,	&lpDS-&gtmnAnoMesEntrada_ANMESENT);<br/>	MathCopy(&dsF570813.penivp,		&lpDS-&gtmnNivelPai_NIVP);<br/>	MathCopy(&dsF570813.penivc,		&lpDS-&gtmnNivelCorrente_NIVC);<br/>	MathCopy(&dsF570813.pean8,		&lpDS-&gtmnCliente_AN8);<br/>	MathCopy(&dsF570813.pecmc1,		&lpDS-&gtmnAgencia_CMC1);<br/>	MathCopy(&dsF570813.pecodprodu,	&lpDS-&gtmnCodProduto_CODPRODU);<br/>	dsF570813.pecliage = lpDS-&gtcCliAge_CLIEAGE;<br/>	I570813_CriaProdutoAcima(lpBhvrCom, dsF570813, dsB9800100);<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/><br/>   return (ER_SUCCESS);<br/>}<br/><br/>/**************************************************************************<br/> *  Business Function:  CalculaArvore<br/> *<br/> *        Description:  Calcula Arvore<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570813B        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CalculaArvore (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813B lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/>	JCHAR				CLIAGE				= _J('E');<br/>	int					iCount				= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570813[4]					= { 0 };<br/>	F570813				dsRequest						= { 0 };<br/>	KEY1_F570813		dsKeyUpdate						= { 0 };<br/>	DSD9800100		    dsB9800100						= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER				hUser							= (HUSER)NULL;<br/>	HREQUEST			hReqF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hUpdF570813						= (HREQUEST)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570813B)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570813"), DIM(_J("B570813")));<br/>	ZeroMathNumeric(&mnZero);<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570813"), DIM(_J("B570813")));<br/><br/>	jdeCallObject(_J("GetAuditInfo"), NULL, lpBhvrCom, lpVoid, &dsB9800100,<br/>                  (CALLMAP *) NULL, (int)(0), (JCHAR *) NULL, (JCHAR *) NULL,<br/>                  CALL_OBJECT_NO_ERRORS);<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada_ANMESENT;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_NIVP );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &mnZero;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_CLIAGE );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &CLIAGE;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570813);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hUpdF570813);<br/>	JDB_ClearSelection(hReqF570813);<br/>	idJDBReturn = JDB_SetSelection(hReqF570813, lpF570813, (short)iCount, JDEDB_SET_REPLACE);<br/>	idJDBReturn = JDB_SelectKeyed(hReqF570813, (ID) 0, (void *) NULL, (short)(0));<br/><br/>	while (JDB_Fetch( hReqF570813 , &dsRequest , 0 ))<br/>	{<br/>		ZeroMathNumeric(&dsRequest.pevlrtotli);<br/>		I570813_EspandeCalculaArvore(&dsRequest, lpBhvrCom, dsB9800100);<br/>		<br/>		memset((void *)(&dsKeyUpdate), (int)(_J('\0')), sizeof(KEY1_F570813));<br/>		MathCopy(&dsKeyUpdate.peanmesent,	&dsRequest.peanmesent);<br/>		MathCopy(&dsKeyUpdate.penivp,		&dsRequest.penivp);<br/>		MathCopy(&dsKeyUpdate.peukid,		&dsRequest.peukid);<br/>		jdeStrncpy(dsKeyUpdate.petax,		dsRequest.petax, DIM(dsRequest.petax));<br/><br/>		jdeStrncpy(dsRequest.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsRequest.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsRequest.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsRequest.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsRequest.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/>		<br/>		/* Atualiza */<br/>		JDB_UpdateTable(hUpdF570813, NID_F570813, (ID)0, ID_F570813_PRIMAY,<br/>					    (void *)&dsKeyUpdate, (short)4, &dsRequest);<br/>		//I570813_InsertUpdateF570813(hUpdF570813, dsRequest);<br/>	}<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/><br/>   return (ER_SUCCESS);<br/>}<br/><br/>/**************************************************************************<br/> *  Business Function:  CachePremiacao<br/> *<br/> *        Description:  Cache para Validar Premiacao Por Pedido<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570813C        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CachePremiacao (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813C lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	JDECM_RESULT         idJCMReturn    = JDECM_PASSED;<br/>    ID                   idJDBReturn    = JDEDB_PASSED;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	DSCache				dsCache        = {0};<br/>    DSCache				dsCacheKey     = {0};<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER                hUser          = (HUSER)NULL;<br/>    HCACHE               idCacheHandle  = (HCACHE)NULL;<br/>    HJDECURSOR           hCursor        = (HJDECURSOR)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570813C)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   idJDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,JDEDB_COMMIT_AUTO);<br/><br/>   if (idJDBReturn == JDEDB_FAILED)<br/>      return (ER_ERROR);<br/><br/>   if (( lpDS-&gtcCacheActionCode &lt _J('1') ) ||<br/>	   ( lpDS-&gtcCacheActionCode &gt _J('7') ) ||<br/>       ((lpDS-&gtcCacheActionCode == _J('4')) && (lpDS-&gtidCursor  ==  0 )))<br/>   {<br/>      lpDS-&gtcCacheCodeError = _J('2');<br/>      return (ER_ERROR);<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	lpDS-&gtcCacheCodeError = _J('0');<br/>	I570813_CreateInitCache(lpDS, hUser, &idCacheHandle);<br/>	<br/>	if(lpDS-&gtidCursor != 0)<br/>		hCursor  =  jdeRetrieveDataPtr(hUser, lpDS-&gtidCursor);<br/>	else<br/>    {<br/>		if ((lpDS-&gtcCacheActionCode != _J('6')) || (lpDS-&gtcCacheActionCode != _J('7')))<br/>		{<br/>			idJCMReturn = jdeCacheOpenCursor((HCACHE)idCacheHandle, &hCursor);<br/>			if (idJCMReturn == JDECM_PASSED)<br/>				idJCMReturn = jdeCacheSetIndex(idCacheHandle, hCursor,1);<br/>		}<br/>    }<br/><br/>	if ((hCursor != NULL) || (lpDS-&gtcCacheActionCode == _J('5')) || (lpDS-&gtcCacheActionCode == _J('6')))<br/>	{<br/>		 <br/>		I570813_CopyToStruct(&dsCacheKey,	lpDS);<br/><br/>		switch (lpDS-&gtcCacheActionCode)<br/>		{<br/>			case _J('1'): /* Pega o primeiro item no Cursor da  CACHE */<br/>				<br/>				if(MathZeroTest(&lpDS-&gtmnNivelPai_NIVP) != 0)<br/>				   {<br/>						idJCMReturn = jdeCacheFetchPosition((HCACHE)idCacheHandle,<br/>															 hCursor ,<br/>															 (void *) &dsCacheKey,<br/>															 1,<br/>															 (void *) &dsCache,<br/>															 sizeof (dsCache));<br/>				   <br/>				   }<br/>				   else<br/>				   {<br/>					   idJCMReturn = jdeCacheFetch((HCACHE)idCacheHandle,<br/>	     											 hCursor,<br/>		    										 (void *)&dsCache,<br/>			    									 (void *)NULL);<br/>				   }<br/><br/>				   if (idJCMReturn == JDECM_PASSED)<br/>				   {<br/>					  if ((lpDS-&gtcReturnCursor == _J('1')) && (lpDS-&gtidCursor == 0))<br/>					  {<br/>						  lpDS-&gtidCursor  =  jdeStoreDataPtr(hUser, hCursor);<br/>					  }<br/>					  <br/>					  I570813_CopyToLPDS(lpDS, &dsCache);<br/>				   }<br/>				   else<br/>				   {<br/>					  lpDS-&gtcCacheCodeError = _J('6');<br/>				   }<br/>				   break;<br/><br/>			case _J('2'): /* Apaga registro da CACHE */<br/><br/>				   idJCMReturn = jdeCacheDeleteAll ((HCACHE)idCacheHandle,<br/>													hCursor,<br/>													&dsCacheKey,<br/>													(ushort)1);<br/><br/>				   if (idJCMReturn != JDECM_PASSED)<br/>					  lpDS-&gtcCacheCodeError = _J('5');<br/>				   break;<br/><br/>			case _J('3'): /* Apaga TODOS os registros da CACHE */<br/><br/>				   idJCMReturn = jdeCacheClear ((HCACHE)idCacheHandle);<br/><br/>				   if (idJCMReturn != JDECM_PASSED)<br/>					  lpDS-&gtcCacheCodeError = _J('5');<br/>				   break;<br/><br/>			case _J('4'): /* Busca da CACHE para Leitura Sequencial */<br/><br/>				   idJCMReturn = jdeCacheFetch ((HCACHE)idCacheHandle,<br/>												 hCursor,<br/>												 (void *)&dsCache,<br/>												 (void *)NULL);<br/><br/>				   if (idJCMReturn == JDECM_PASSED)<br/>				   {<br/>					   /* Copia da Cache para a Estrutura de Dados */<br/><br/>					  I570813_CopyToLPDS(lpDS, &dsCache);<br/>				   }<br/>				   else<br/>					  lpDS-&gtcCacheCodeError = _J('1');<br/>				   break;<br/><br/>			case _J('5'): /* Inclui a Cache */<br/><br/>				   <br/>					  /* Copia da Estrutura de Dados para a Cache */<br/>					   <br/>					  I570813_CopyToStruct(&dsCache,	lpDS);<br/><br/>					  /* Adiciona o registro na Cache */<br/><br/>					  idJCMReturn = jdeCacheAdd ((HCACHE)idCacheHandle,<br/>												 (void *)&dsCache, <br/>												 (long)sizeof(dsCache));<br/><br/>				   if (idJCMReturn != JDECM_PASSED)<br/>					  lpDS-&gtcCacheCodeError = _J('7');<br/>				   break;<br/><br/>		 case _J('6'): /* Termina CACHE */<br/><br/>				   jdeCacheTerminateAll (hUser, (HCACHE)idCacheHandle);<br/>				   hCursor = NULL;<br/><br/>		 case _J('7'): /* Fecha Cursor */<br/><br/>				   lpDS-&gtcReturnCursor= 0;<br/>				   break;<br/><br/>		 default: /* Nao valido */<br/>				  break;<br/>		}<br/>	}<br/><br/>	if ((lpDS-&gtcCacheActionCode == _J('1')) && (hCursor == NULL))<br/>		lpDS-&gtcCacheCodeError = _J('6');<br/><br/>	if ((lpDS-&gtcReturnCursor   != _J('1')) || (lpDS-&gtcCacheCodeError != _J('0')))<br/>	{<br/>		if(hCursor != NULL)<br/>			jdeCacheCloseCursor ((HCACHE)idCacheHandle, hCursor);<br/>		if(lpDS-&gtidCursor)<br/>		{<br/>			jdeRemoveDataPtr(hUser, lpDS-&gtidCursor);<br/>			lpDS-&gtidCursor  =  0;<br/>		}<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/><br/>   return (ER_SUCCESS);<br/>}<br/><br/>/**************************************************************************<br/> *  Business Function:  CriaClienteLado<br/> *<br/> *        Description:  Cria Cliente Agencia para todos os Meses Hist<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570813D        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CriaClienteLado (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570813D lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	int					iCount				= 0;<br/>	int					iMax				= 0;<br/>	int					iTeste				= 0;<br/>	int					iResto				= 0;<br/>	MATH_NUMERIC		mnMenosUM			= { 0 };<br/>	MATH_NUMERIC		mnUM	    		= { 0 };<br/>	MATH_NUMERIC		mnMenos88			= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570813[2]					= { 0 };<br/>	F570813				dsInsert						= { 0 };<br/>	F570813				dsSelect						= { 0 };<br/>	KEY1_F570813		dsKeyF570813					= { 0 };<br/>	DSD9800100		    dsB9800100						= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER				hUser							= (HUSER)NULL;<br/>	HREQUEST			hInsF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hSelF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hDelF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hSelV570813S     				= (HREQUEST)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>   if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570813D)	NULL))<br/>   {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>   }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	MathNumericToInt(&lpDS-&gtmnNumeroMeses_IA02, &iMax);<br/>	ParseNumericString(&mnMenosUM, _J("-1"));<br/>	ParseNumericString(&mnUM, _J("1"));<br/>	ParseNumericString(&mnMenos88, _J("-88"));<br/><br/><br/>	jdeCallObject(_J("GetAuditInfo"), NULL, lpBhvrCom, lpVoid, &dsB9800100,<br/>              (CALLMAP *) NULL, (int)(0), (JCHAR *) NULL, (JCHAR *) NULL,<br/>              CALL_OBJECT_NO_ERRORS);<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570813"), DIM(_J("B570813")));<br/><br/>	memset((void *)(&dsInsert), (int)(_J('\0')), sizeof(F570813));<br/>	//MathCopy(&dsInsert.peanmesent,	&lpDS-&gtmnAnoMesEntrada_ANMESENT);<br/>	MathCopy(&dsInsert.peanmesent,	&lpDS-&gtmnAnoMesMovimentacao);<br/>	MathCopy(&dsInsert.penivp,		&lpDS-&gtmnNivelPai_NIVP);<br/>	MathCopy(&dsInsert.penivc,		&lpDS-&gtmnNivelCorrente_NIVC);<br/>	MathCopy(&dsInsert.pean8,		&lpDS-&gtmnAddressNumber_AN8);<br/>	MathCopy(&dsInsert.pecmc1,		&lpDS-&gtmnCommissionCode1_CMC1);<br/>	MathCopy(&dsInsert.pecodprodu,	&lpDS-&gtmnCodProduto_CODPRODU);<br/>	MathCopy(&dsInsert.peukid,		&lpDS-&gtmnIDCRM_UKID);<br/>	//<br/>	MathCopy(&dsInsert.pevlrtotli, &lpDS-&gtmnValorFaturado);<br/>	MathCopy(&dsInsert.pevlrtotbr, &lpDS-&gtmnValorBruto);<br/>	MathCopy(&dsInsert.peanqt,     &lpDS-&gtmnValorTabela);<br/>	//<br/>	jdeStrncpy(dsInsert.pecup,		(const JCHAR *)  lpDS-&gtszUnidade_CUP, DIM(lpDS-&gtszUnidade_CUP));<br/>	jdeStrncpy(dsInsert.petax,		(const JCHAR *)  lpDS-&gtszCnpj_TAX, DIM(lpDS-&gtszCnpj_TAX));<br/>	dsInsert.pecliage = lpDS-&gtcCliAge_CLIEAGE;<br/><br/>	jdeStrncpy(dsInsert.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>	jdeStrncpy(dsInsert.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>	jdeStrncpy(dsInsert.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>	MathCopy(&dsInsert.peupmt, &dsB9800100.mnTime);<br/>	memcpy((void *)(&dsInsert.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>	/* Verifica se Existe outro executivo com este ID */<br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict ,  NID_UKID );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &lpDS-&gtmnIDCRM_UKID;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	<br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict ,  NID_NIVP );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &lpDS-&gtmnNivelPai_NIVP;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hSelF570813);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hDelF570813);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hInsF570813);<br/>	idJDBReturn = JDB_OpenView(hUser, _J("V570813S"), NULL, &hSelV570813S);<br/><br/>	JDB_ClearSelection(hSelF570813);<br/>	idJDBReturn = JDB_SetSelection(hSelF570813, lpF570813, (short)iCount, JDEDB_SET_REPLACE);<br/>	idJDBReturn = JDB_SelectKeyed(hSelF570813, (ID) 0, (void *) NULL, (short)(0));<br/>	<br/>	while(JDB_Fetch( hSelF570813 , &dsSelect , 0 ))<br/>	{<br/>		MathCopy(&dsKeyF570813.peanmesent, &dsSelect.peanmesent);<br/>		MathCopy(&dsKeyF570813.penivp, &dsSelect.penivp);<br/>		MathCopy(&dsKeyF570813.peukid, &dsSelect.peukid);<br/>		JDB_DeleteTable(hDelF570813,NID_F570813, 0, ID_F570813_PRIMAY,&dsKeyF570813, (int)3);<br/><br/>		MathCopy(&dsSelect.penivp, &lpDS-&gtmnNivelPai_NIVP);<br/>		JDB_InsertTable(hInsF570813, NID_F570813, (ID)0, &dsSelect);<br/>	}<br/><br/>	/*Insere novo registro*/<br/>	//verifica se existe antes<br/>	JDB_ClearSelection(hSelV570813S);<br/>	MathCopy(&dsKeyF570813.peanmesent, &dsInsert.peanmesent);<br/>    MathCopy(&dsKeyF570813.penivp, &dsInsert.penivp);<br/>	MathCopy(&dsKeyF570813.peukid, &dsInsert.peukid);<br/>	jdeStrncpy(dsKeyF570813.petax, (const JCHAR *)dsInsert.petax, DIM(dsInsert.petax));<br/>    idJDBReturn = JDB_FetchKeyed(hSelV570813S, (ID) 0,<br/>					                        (void *)(&dsKeyF570813), (short) 4,<br/>						                    (void *)NULL, FALSE);<br/>	//<br/>    if (idJDBReturn != JDEDB_PASSED) <br/>	{<br/>		//<br/>		idJDBReturn = JDB_InsertTable(hInsF570813, NID_F570813, (ID)0, &dsInsert);<br/>		//<br/>		ZeroMathNumeric(&dsInsert.pevlrtotli);<br/>		ZeroMathNumeric(&dsInsert.pevlrtotbr);<br/>		ZeroMathNumeric(&dsInsert.peanqt);<br/>		//Aponta para o mes final<br/>		MathCopy(&dsInsert.peanmesent,	&lpDS-&gtmnAnoMesEntrada_ANMESENT);<br/>		MathAdd(&dsInsert.peanmesent, &dsInsert.peanmesent, &mnUM);<br/>		//<br/>		for(iCount = 0; iCount &lt= iMax; iCount++)<br/>		{<br/>			MathAdd(&dsInsert.peanmesent, &dsInsert.peanmesent, &mnMenosUM);<br/>			MathNumericToInt(&dsInsert.peanmesent, &iTeste);<br/>			iResto = iTeste % 100;<br/>			//<br/>			if (iResto == 0)<br/>				MathAdd(&dsInsert.peanmesent, &dsInsert.peanmesent, &mnMenos88);<br/>			//<br/>			//verifica se existe antes<br/>			JDB_ClearSelection(hSelV570813S);<br/>			MathCopy(&dsKeyF570813.peanmesent, &dsInsert.peanmesent);<br/>		    MathCopy(&dsKeyF570813.penivp, &dsInsert.penivp);<br/>			MathCopy(&dsKeyF570813.peukid, &dsInsert.peukid);<br/>			jdeStrncpy(dsKeyF570813.petax, (const JCHAR *)dsInsert.petax, DIM(dsInsert.petax));<br/>			idJDBReturn = JDB_FetchKeyed(hSelV570813S, (ID) 0,(void *)(&dsKeyF570813), (short) 4,<br/>					                    (void *)NULL, FALSE);<br/>			//<br/>			if (idJDBReturn != JDEDB_PASSED) <br/>			{<br/>				JDB_InsertTable(hInsF570813, NID_F570813, (ID)0, &dsInsert);		<br/>			}<br/>			//<br/>		}<br/>		//<br/>	} else {<br/>		//<br/>		//faz update<br/>		//busca registro atual antes<br/>		MathCopy(&dsKeyF570813.peanmesent, &dsInsert.peanmesent);<br/>		MathCopy(&dsKeyF570813.penivp, &dsInsert.penivp);<br/>		MathCopy(&dsKeyF570813.peukid, &dsInsert.peukid);<br/>		jdeStrncpy(dsKeyF570813.petax, (const JCHAR *)dsInsert.petax, DIM(dsInsert.petax));<br/>		//<br/>		JDB_ClearSelection(hSelF570813);<br/>		idJDBReturn = JDB_FetchKeyed(hSelF570813, (ID) 0,<br/>					                        (void *)(&dsKeyF570813), (short) 4,<br/>						                    (void *)(&dsSelect), FALSE);<br/>	<br/>		//<br/>		MathCopy(&dsSelect.pevlrtotli, &lpDS-&gtmnValorFaturado);<br/>		MathCopy(&dsSelect.pevlrtotbr, &lpDS-&gtmnValorBruto);<br/>		MathCopy(&dsSelect.peanqt,     &lpDS-&gtmnValorTabela);<br/>		//<br/>		jdeStrncpy(dsSelect.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsSelect.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsSelect.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsSelect.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsSelect.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/>		//<br/>		JDB_UpdateTable(hInsF570813, NID_F570813,  (ID) 0, ID_F570813_PRIMAY, (void *)(&dsKeyF570813), 4, (void *)(&dsSelect));<br/>		//<br/>	}<br/>	//<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hInsF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hInsF570813);<br/><br/>	if (hSelF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hSelF570813);<br/><br/>	if (hDelF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hDelF570813);<br/><br/>	if (hSelV570813S != (HREQUEST) NULL)<br/>		JDB_CloseView(hSelV570813S);<br/><br/>    return (ER_SUCCESS);<br/>}<br/><br/>/* Internal function comment block */<br/>/**************************************************************************<br/> *   Function:  Ixxxxxxx_a   // Replace "xxxxxxx" with source file number<br/> *                           // and "a" with the function name<br/> *      Notes:<br/> *<br/> *    Returns:<br/> *<br/> * Parameters:<br/> **************************************************************************/<br/><br/>void I570813_CriaProdutoAcima(LPBHVRCOM lpBhvrCom, F570813 dsF570813, DSD9800100 dsB9800100)<br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnOldNIVP			= { 0 };<br/>	MATH_NUMERIC		mnOldNIVC			= { 0 };<br/>	MATH_NUMERIC		mnOldANMESENT		= { 0 };<br/>	MATH_NUMERIC		mnZERO				= { 0 };<br/>	int					iInsert				= 0;<br/>	int					iCount				= 0;<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570813[4]					= { 0 };<br/>	F570813				dsRequest						= { 0 };<br/>	F570813				dsInsert						= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER				hUser							= (HUSER)NULL;<br/>	HREQUEST			hReqF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hInsF570813						= (HREQUEST)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570813"), DIM(_J("B570813")));<br/>	ZeroMathNumeric(&mnOldNIVP);<br/>	ZeroMathNumeric(&mnZERO);<br/>	iInsert = 0;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsF570813.peanmesent;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_NIVC );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsF570813.penivp;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_NIVP );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &mnZERO;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570813);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hInsF570813);<br/>	<br/>	JDB_ClearSelection(hReqF570813);<br/>	idJDBReturn = JDB_SetSelection(hReqF570813, lpF570813, (short)iCount, JDEDB_SET_REPLACE);<br/>	idJDBReturn = JDB_SelectKeyed(hReqF570813, (ID) 0, (void *) NULL, (short)(0));<br/><br/>	while (JDB_Fetch( hReqF570813 , &dsRequest , 0 ))<br/>	{<br/>		if (MathZeroTest(&mnOldNIVP) == 0)<br/>		{<br/>			iInsert = 1;<br/>			MathCopy(&mnOldANMESENT, &dsRequest.peanmesent);<br/>			MathCopy(&mnOldNIVP,	 &dsRequest.penivp);<br/>			MathCopy(&mnOldNIVC,	 &dsRequest.penivc);<br/>		}<br/><br/>		if(MathCompare(&dsRequest.penivp, &mnOldNIVP) == 0)<br/>		{<br/>			if((MathCompare(&dsRequest.pecodprodu,	&dsF570813.pecodprodu)	== 0) &&<br/>			   (MathCompare(&dsRequest.pean8,		&dsF570813.pean8)		== 0) &&<br/>			   (MathCompare(&dsRequest.pecmc1,		&dsF570813.pecmc1)		== 0) )<br/>				iInsert = 0;<br/>			<br/>		} else {<br/><br/>			if (iInsert == 1)<br/>			{<br/>				memset((void *)(&dsInsert), (int)(_J('\0')), sizeof(F570813));<br/>				MathCopy(&dsInsert.peanmesent,	&mnOldANMESENT);<br/>				MathCopy(&dsInsert.penivp,		&mnOldNIVP);<br/>				MathCopy(&dsInsert.penivc,		&mnOldNIVC);<br/>				MathCopy(&dsInsert.pean8,		&dsF570813.pean8);<br/>				MathCopy(&dsInsert.pecmc1,		&dsF570813.pecmc1);<br/>				MathCopy(&dsInsert.pecodprodu,	&dsF570813.pecodprodu);<br/>				dsInsert.pecliage = dsF570813.pecliage;<br/>				<br/>				dsInsert.peev01 = _J('N');<br/>				jdeStrncpy(dsInsert.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>				jdeStrncpy(dsInsert.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>				jdeStrncpy(dsInsert.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>				MathCopy(&dsInsert.peupmt, &dsB9800100.mnTime);<br/>				memcpy((void *)(&dsInsert.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>				JDB_InsertTable(hInsF570813, NID_F570813, (ID)0, &dsInsert);<br/>				//I570813_InsertUpdateF570813(hInsF570813, dsInsert);<br/>				I570813_CriaProdutoAcima(lpBhvrCom, dsInsert, dsB9800100);<br/>			}<br/>			iInsert = 1;<br/>			MathCopy(&mnOldANMESENT, &dsRequest.peanmesent);<br/>			MathCopy(&mnOldNIVP,	 &dsRequest.penivp);<br/>			MathCopy(&mnOldNIVC,	 &dsRequest.penivc);<br/>		}<br/>	}<br/>	<br/>	if (iInsert == 1)<br/>	{<br/>		memset((void *)(&dsInsert), (int)(_J('\0')), sizeof(F570813));<br/>		MathCopy(&dsInsert.peanmesent,	&mnOldANMESENT);<br/>		MathCopy(&dsInsert.penivp,		&mnOldNIVP);<br/>		MathCopy(&dsInsert.penivc,		&mnOldNIVC);<br/>		MathCopy(&dsInsert.pean8,		&dsF570813.pean8);<br/>		MathCopy(&dsInsert.pecmc1,		&dsF570813.pecmc1);<br/>		MathCopy(&dsInsert.pecodprodu,	&dsF570813.pecodprodu);<br/>		dsInsert.pecliage = dsF570813.pecliage;<br/><br/>		dsInsert.peev01 = _J('N');<br/>		jdeStrncpy(dsInsert.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsInsert.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsInsert.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsInsert.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsInsert.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>		JDB_InsertTable(hInsF570813, NID_F570813, (ID)0, &dsInsert);<br/>		//I570813_InsertUpdateF570813(hInsF570813, dsInsert);<br/>		I570813_CriaProdutoAcima(lpBhvrCom, dsInsert, dsB9800100);<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570813);<br/>	<br/>	if (hInsF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hInsF570813);<br/>}<br/><br/>/**************************************************************************<br/> *   Function: I570813_EspandeCalculaArvore<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570813_EspandeCalculaArvore(F570813 *dsPaiF570813, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100) <br/>{<br/>	<br/>  /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	MATH_NUMERIC		mnTotalExec			= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/>	int					iCount				= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570813[4]					= { 0 };<br/>	F570813				dsRequest						= { 0 };<br/>	KEY1_F570813		dsKeyUpdate						= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HUSER				hUser							= (HUSER)NULL;<br/>	HREQUEST			hReqF570813						= (HREQUEST)NULL;<br/>	HREQUEST			hUpdF570813						= (HREQUEST)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570813"), DIM(_J("B570813")));<br/>	ZeroMathNumeric(&mnZero);<br/>	ZeroMathNumeric(&mnTotalExec);<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsPaiF570813-&gtpeanmesent;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_NIVP );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsPaiF570813-&gtpenivc;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_CODPRODU );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsPaiF570813-&gtpecodprodu;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_AN8 );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsPaiF570813-&gtpean8;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/><br/>	jdeNIDcpy( lpF570813[iCount].Item1.szDict , NID_CMC1 );<br/>    jdeNIDcpy( lpF570813[iCount].Item1.szTable , NID_F570813 );<br/>    lpF570813[iCount].Item1.idInstance = 0;<br/>	lpF570813[iCount].lpValue = &dsPaiF570813-&gtpecmc1;<br/>	lpF570813[iCount].nValues = 1;<br/>    lpF570813[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570813[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hUpdF570813);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570813, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570813);<br/>	JDB_ClearSelection(hReqF570813);<br/>	idJDBReturn = JDB_SetSelection(hReqF570813, lpF570813, (short)iCount, JDEDB_SET_REPLACE);<br/>	idJDBReturn = JDB_SelectKeyed(hReqF570813, (ID) 0, (void *) NULL, (short)(0));<br/><br/>	while (JDB_Fetch( hReqF570813 , &dsRequest , 0 ))<br/>	{<br/>		// Zera Valores de Realizado<br/>		//ZeroMathNumeric(&dsRequest.pevlrtotli);<br/>		I570813_EspandeCalculaArvore(&dsRequest, lpBhvrCom, dsB9800100);<br/>		<br/>		memset((void *)(&dsKeyUpdate), (int)(_J('\0')), sizeof(KEY1_F570813));<br/>		MathCopy(&dsKeyUpdate.peanmesent,	&dsRequest.peanmesent);<br/>		MathCopy(&dsKeyUpdate.penivp,		&dsRequest.penivp);<br/>		MathCopy(&dsKeyUpdate.peukid,		&dsRequest.peukid);<br/>        jdeStrncpy(dsKeyUpdate.petax, (const JCHAR *) dsRequest.petax, DIM(dsKeyUpdate.petax));<br/>		//<br/>		jdeStrncpy(dsRequest.peuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>		jdeStrncpy(dsRequest.pejobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>		jdeStrncpy(dsRequest.pepid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>		MathCopy(&dsRequest.peupmt, &dsB9800100.mnTime);<br/>		memcpy((void *)(&dsRequest.peupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/>		<br/>		/* Atualiza */<br/>		JDB_UpdateTable(hUpdF570813, NID_F570813, (ID)0, ID_F570813_PRIMAY,<br/>					    (void *)&dsKeyUpdate, (short)4, &dsRequest);<br/>		<br/>		//I570813_InsertUpdateF570813(hUpdF570813, dsRequest);<br/>		MathAdd(&mnTotalExec, &mnTotalExec, &dsRequest.pevlrtotli);<br/><br/>	}<br/><br/>	MathAdd(&dsPaiF570813-&gtpevlrtotli, &dsPaiF570813-&gtpevlrtotli, &mnTotalExec);<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hUpdF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hUpdF570813);<br/>	<br/>	if (hReqF570813 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570813);<br/><br/>}<br/><br/>/**************************************************************************<br/> *   Function: I570813_CreateInitCache<br/> *<br/> *      Notes: Cria e inicializa a cache<br/> *             <br/> * Parameters: <br/> *    <br/> ***************************************************************************/<br/>void I570813_CreateInitCache (LPDSD570813C lpDS,<br/>							   HUSER hUser,<br/>                               HCACHE *lpidCacheHandle)<br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/><br/>   JDECM_RESULT         idJCMReturn    = JDECM_PASSED;<br/>   JCHAR                 szCacheName[40];<br/>   short 				sNumKey		   = 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/><br/>   JDECMINDEXSTRUCT     dsKey          = {0};<br/>   DSCache		        dsCache;<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>   memset ((void *)(&dsCache), (int)(_J('\0')), sizeof(dsCache));<br/>   jdeSprintf(szCacheName,_J("%ls%ls"),_J("B570813"),lpDS-&gtmnJobnumberA.String);<br/><br/>   /* AR - Setup and Initialize CACHE-key to create CACHE every occurance */<br/><br/><br/><br/>   dsKey.CacheKey[sNumKey].nOffset    = offsetof (DSCache, mnNivelPai_NIVP);<br/>   dsKey.CacheKey[sNumKey].nSize      = sizeof (dsCache.mnNivelPai_NIVP);<br/>   dsKey.CacheKey[sNumKey].idDataType = EVDT_MATH_NUMERIC;<br/>   sNumKey++;<br/><br/>   dsKey.CacheKey[sNumKey].nOffset    = offsetof (DSCache, mnCodProduto_CODPRODU);<br/>   dsKey.CacheKey[sNumKey].nSize      = sizeof (dsCache.mnCodProduto_CODPRODU);<br/>   dsKey.CacheKey[sNumKey].idDataType = EVDT_MATH_NUMERIC;<br/>   sNumKey++;<br/><br/>   dsKey.CacheKey[sNumKey].nOffset    = offsetof (DSCache, mnNrPedido_NRPEDIDO);<br/>   dsKey.CacheKey[sNumKey].nSize      = sizeof (dsCache.mnNivelPai_NIVP);<br/>   dsKey.CacheKey[sNumKey].idDataType = EVDT_MATH_NUMERIC;<br/>   sNumKey++;<br/><br/>   dsKey.CacheKey[sNumKey].nOffset    = offsetof (DSCache, szUnid1_UNID1);<br/>   dsKey.CacheKey[sNumKey].nSize      = sizeof (dsCache.szUnid1_UNID1);<br/>   dsKey.CacheKey[sNumKey].idDataType = EVDT_STRING;<br/>   sNumKey++;<br/>   <br/>   dsKey.nKeyID                 = 1;<br/>   dsKey.nNumSegments           = sNumKey;<br/>   idJCMReturn = jdeCacheInit (hUser, lpidCacheHandle, szCacheName, &dsKey);<br/><br/>   if (idJCMReturn != JDECM_PASSED)<br/>   {<br/>      /* AR - Nao conseguiu iniciar a CACHE  */<br/><br/>      lpDS-&gtcCacheCodeError     = _J('3');<br/>      lpDS-&gtcCacheActionCode    = _J('0');<br/>      jdeMemoryManagementTerminate();<br/>   }<br/>   return;<br/>} <br/><br/>/**************************************************************************<br/> *   Function: I570813_CopyToLPDS<br/> *<br/> *      Notes: Copia da cache para a estrutura de dados <br/> *             <br/> * Parameters: <br/> *    <br/> ***************************************************************************/<br/>void I570813_CopyToLPDS (LPDSD570813C lpDS, LPDSCache lpdsCache)<br/>{<br/>	MathCopy(&lpDS-&gtmnNivelPai_NIVP			,	&lpdsCache-&gtmnNivelPai_NIVP);<br/>	MathCopy(&lpDS-&gtmnCodProduto_CODPRODU   ,	&lpdsCache-&gtmnCodProduto_CODPRODU);<br/>	MathCopy(&lpDS-&gtmnNrPedido_NRPEDIDO		,	&lpdsCache-&gtmnNrPedido_NRPEDIDO);<br/>	jdeStrcpy(   lpDS-&gtszUnid1_UNID1			,	lpdsCache-&gtszUnid1_UNID1);<br/>}<br/><br/>/**************************************************************************<br/> *   Function: I570813_CopyToStruct<br/> *<br/> *      Notes: Copia da estrutura de dados para a cache<br/> *             <br/> * Parameters: <br/> *    <br/> ***************************************************************************/<br/>void I570813_CopyToStruct (LPDSCache lpdsCache, LPDSD570813C lpDS)<br/>{<br/>	MathCopy(&lpdsCache-&gtmnNivelPai_NIVP			,	&lpDS-&gtmnNivelPai_NIVP);<br/>	MathCopy(&lpdsCache-&gtmnCodProduto_CODPRODU   ,	&lpDS-&gtmnCodProduto_CODPRODU);<br/>	MathCopy(&lpdsCache-&gtmnNrPedido_NRPEDIDO		,	&lpDS-&gtmnNrPedido_NRPEDIDO);<br/>	jdeStrcpy(   lpdsCache-&gtszUnid1_UNID1			,	lpDS-&gtszUnid1_UNID1);<br/>}<br/><br/>/**************************************************************************<br/> *   Function: I570813_CopyToStruct<br/> *<br/> *      Notes: Copia da estrutura de dados para a cache<br/> *             <br/> * Parameters: <br/> *    <br/> ***************************************************************************/<br/>/*void I570813_InsertUpdateF570813 (HUSER *hUser, HREQUEST *hF570813, F570813 dsRegistro)<br/>{<br/><br/>	HREQUEST             hF570823L; <br/>	KEY1_F570813         dsChave         = {0};<br/>	JDECM_RESULT         idJCMReturn     = JDECM_PASSED;<br/>	SELECTSTRUCT   		 dsF570823L[1]	 = {0};<br/>	F570823L             dsRegF570823L   = {0};<br/>	int                  iCount          = 0;<br/>	//<br/>	// Monta a chave<br/>    MathCopy(&dsChave.peukid, &dsRegistro.peukid);              <br/>    MathCopy(&dsChave.peanmesent, &dsRegistro.peanmesent);          <br/>    MathCopy(&dsChave.penivp, &dsRegistro.penivp);              <br/>    strncpy(dsChave.petax , (const char *) dsRegistro.petax , sizeof (dsRegistro.petax ) );<br/>	//<br/>	//Verifica a se existe registro (UKID) na tabela F570823L - Busca pelo ukid atual e ve se existe um velho para ele <br/>	jdeNIDcpy( dsF570823L[iCount].Item1.szDict , NID_UKID);<br/>    jdeNIDcpy( dsF570823L[iCount].Item1.szTable , NID_F570823L );<br/>    dsF570823L[iCount].Item1.idInstance = 0;<br/>	dsF570823L[iCount].lpValue = &dsRegistro-&gtpeukid;<br/>	dsF570823L[iCount].nValues = 1;<br/>    dsF570823L[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    dsF570823L[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( dsF570823L[iCount].Item1.szDict , NID_EV01);<br/>    jdeNIDcpy( dsF570823L[iCount].Item1.szTable , NID_F570823L );<br/>    dsF570823L[iCount].Item1.idInstance = 0;<br/>	dsF570823L[iCount].lpValue = 'S';<br/>	dsF570823L[iCount].nValues = 1;<br/>    dsF570823L[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    dsF570823L[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/>	//<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570823L, 0, NULL, (ushort) 0, (char *) NULL, &hF570823L);<br/>	JDB_ClearSelection(hF570823L);	<br/>	idJDBReturn = JDB_SetSelection(hF570823L, dsF570823L, (short)iCount, JDEDB_SET_REPLACE);<br/>	idJDBReturn = JDB_SelectKeyed(hF570823L, (ID) 0, (void *) NULL, (short)(0));<br/>	if (JDB_Fetch( hReqF570813 , &dsRegF570823L , 0 )) <br/>	{<br/>		//se existir registro - retira o valor do registro velho <br/>	    MathCopy(&dsChave.peukid, &dsRegF570823L.peuk01);              <br/>		MathCopy(&dsChave.peanmesent, &dsRegistro.peanmesent);          <br/>	    MathCopy(&dsChave.penivp, &dsRegistro.penivp);              <br/>		strncpy(dsChave.petax , (const char *) dsRegistro.petax , sizeof (dsRegistro.petax ) );<br/>		idJDBReturn = JDB_FetchKeyed(hF570813,ID_F570813_PRIMAY, (void*)&dsChave, (short)4, (void*)&dsRegistro, (int)0);<br/>		JDB_UpdateTable(hF570813, NID_F570813, (ID)0, ID_F570813_PRIMAY,<br/>					    (void *)&dsChave, (short)4, &dsRegistro);<br/>		//e atualiza no novo. 		<br/>	    MathCopy(&dsChave.peukid, &dsRegF570823L.peuk01);              <br/>		MathCopy(&dsChave.peanmesent, &dsRegistro.peanmesent);          <br/>	    MathCopy(&dsChave.penivp, &dsRegistro.penivp);              <br/>		strncpy(dsChave.petax , (const char *) dsRegistro.petax , sizeof (dsRegistro.petax ) );<br/>		idJDBReturn = JDB_FetchKeyed(hF570813,ID_F570813_PRIMAY, (void*)&dsChave, (short)4, (void*)&dsRegistro, (int)0);<br/>		JDB_UpdateTable(hF570813, NID_F570813, (ID)0, ID_F570813_PRIMAY,<br/>					    (void *)&dsChave, (short)4, &dsRegistro);<br/>	}<br/>	//<br/>*/<br/><br/><br/>	/*idJCMReturn = JDB_FetchKeyed(hF570813,ID_F570813_PRIMAY, (void*)&dsChave, (short)4, (void*)&dsRegistro, (int)0);<br/>	if (idJCMReturn == JDECM_PASSED) <br/>	{<br/>		//<br/>		JDB_UpdateTable(hF570813, NID_F570813, (ID)0, ID_F570813_PRIMAY,<br/>					    (void *)&dsChave, (short)4, &dsRegistro);<br/>		//<br/>	} else {<br/>		//<br/>		JDB_InsertTable(hF570813, NID_F570813, (ID)0, &dsRegistro);<br/>		//<br/>	}*/<br/><br/>/*<br/>}<br/>*/<br/></pre></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: BSFN Historico Executado - [CalculaArvore]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570813B - DSTR Calcula Arvore                                         </B><BR>BF mnAnoMesEntrada_ANMESENT [ANMESENT]<BR>BF cErro_ERR [ERR]<BR></div></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: BSFN Historico Executado - [CriaClienteLado]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570813D - DSTR Replica Agenca, Cliente, Produto para todo Historico   </B><BR>BF mnAnoMesEntrada_ANMESENT [ANMESENT]<BR>BF mnNumeroMeses_IA02 [IA02]<BR>BF mnNivelPai_NIVP [NIVP]<BR>BF mnNivelCorrente_NIVC [NIVC]<BR>BF cCliAge_CLIEAGE [CLIAGE]<BR>BF mnAddressNumber_AN8 [AN8]<BR>BF mnCommissionCode1_CMC1 [CMC1]<BR>BF mnCodProduto_CODPRODU [CODPRODU]<BR>BF szUnidade_CUP [CUP]<BR>BF mnIDCRM_UKID [UKID]<BR>BF szCnpj_TAX [TAX]<BR>BF mnValorFaturado [VLRTOTLI]<BR>BF mnValorBruto [VLRTOTBR]<BR>BF mnValorTabela [ANQT]<BR>BF mnAnoMesMovimentacao [ANMESENT]<BR></div></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: BSFN Historico Executado - [CriaProdutoAcima]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570813A - DSTR Cria Produto Acima                                     </B><BR>BF mnAnoMesEntrada_ANMESENT [ANMESENT]<BR>BF mnNivelPai_NIVP [NIVP]<BR>BF mnNivelCorrente_NIVC [NIVC]<BR>BF mnCliente_AN8 [AN8]<BR>BF mnAgencia_CMC1 [CMC1]<BR>BF cCliAge_CLIEAGE [CLIAGE]<BR>BF mnCodProduto_CODPRODU [CODPRODU]<BR></div></div></div></body></html>