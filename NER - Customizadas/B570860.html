<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B570860 - Atualização Arvpre Hierarquia<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: Atualização Arvpre Hierarquia - [CalculaHieraria]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570860 - DSTR Calculo da Hierarquia                                  </B><BR>BF mnAnoMesEntrada [ANMESENT]<BR>BF cSobreporAjustes [EV01]<BR>BF szProgramId [PID]<BR>BF szUnidade [UNID1]<BR></div><pre><div class='dstrmembers'><B>Header File: b570860.h</B><BR></div>/*****************************************************************************<br/> *    Header File:  B570860.h<br/> *<br/> *    Description:  Atualização Arvpre Hierarquia Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 11/01/11    Unknown     Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/><br/>#ifndef __B570860_H<br/>#define __B570860_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf570860.h&gt<br/>#include &ltf570861.h&gt<br/>#include &ltf570862.h&gt<br/>#include &ltf570861l.h&gt<br/>#include &ltf57080d.h&gt<br/>#include &ltb9800100.h&gt<br/><br/>/*****************************************************************************<br/> * External Business Function Header Inclusions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Global Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/> /*****************************************<br/>  * TYPEDEF for Data Structure<br/>  *    Template Name: DSTR Calculo da Hierarquia<br/>  *    Template ID:   D570860<br/>  *    Generated:     Mon Aug 27 13:51:14 2012<br/>  *<br/>  * DO NOT EDIT THE FOLLOWING TYPEDEF<br/>  *    To make modifications, use the OneWorld Data Structure<br/>  *    Tool to Generate a revised version, and paste from<br/>  *    the clipboard.<br/>  *<br/>  **************************************/  <br/><br/> #ifndef DATASTRUCTURE_D570860<br/> #define DATASTRUCTURE_D570860<br/> <br/> typedef struct tagDSD570860<br/> {<br/>   MATH_NUMERIC      mnAnoMesEntrada;                     <br/>   JCHAR              cSobreporAjustes;                    <br/>   JCHAR              szProgramId[11];                     <br/>   JCHAR              szUnidade[4];                        <br/> } DSD570860, *LPDSD570860;<br/><br/> #define IDERRmnAnoMesEntrada_1                    1L<br/> #define IDERRcSobreporAjustes_2                   2L<br/> #define IDERRszProgramId_3                        3L<br/> #define IDERRszUnidade_4                          4L<br/><br/> #endif<br/><br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: Get UDC<br/> *    Template ID:   D0005<br/> *    Generated:     Tue Jan 11 12:05:03 2011<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D0005<br/>#define DATASTRUCTURE_D0005<br/><br/>typedef struct tagDSD0005<br/>{<br/>  JCHAR              szDataDictionaryItem[11];            <br/>  JCHAR              szSystemCode[5];                     <br/>  JCHAR              szRecordTypeCode[3];                 <br/>  JCHAR              szUserDefinedCode[11];               <br/>  MATH_NUMERIC      mnKeyFieldLength;                    <br/>  JCHAR              szLanguagePreference[3];             <br/>  JCHAR              szDescription001[31];                <br/>  JCHAR              szDescription002[31];                <br/>  JCHAR              szSpecialHandlingCode[11];           <br/>  JCHAR              cUdcOwnershipFlag;                   <br/>  JCHAR              cHardCodedYn;                        <br/>  JCHAR              cSuppressErrorMessage;               <br/>  JCHAR              szErrorMessageId[11];                <br/>  JCHAR              cUDCOne;                             <br/>} DSD0005, *LPDSD0005;<br/><br/>#define IDERRszDataDictionaryItem_1               1L<br/>#define IDERRszSystemCode_2                       2L<br/>#define IDERRszRecordTypeCode_3                   3L<br/>#define IDERRszUserDefinedCode_4                  4L<br/>#define IDERRmnKeyFieldLength_5                   5L<br/>#define IDERRszLanguagePreference_6               6L<br/>#define IDERRszDescription001_7                   7L<br/>#define IDERRszDescription002_8                   8L<br/>#define IDERRszSpecialHandlingCode_9              9L<br/>#define IDERRcUdcOwnershipFlag_10                 10L<br/>#define IDERRcHardCodedYn_11                      11L<br/>#define IDERRcSuppressErrorMessage_13             13L<br/>#define IDERRszErrorMessageId_14                  14L<br/>#define IDERRcUDCOne_15                           15L<br/><br/>#endif<br/><br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI CalculaHieraria                  (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570860 lpDS);<br/><br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/>void    I570860A_EspandeCalculoQualificadores(F570861   *dsPaiF570861, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100);<br/>void    I570860B_SomaPedidosQualificadores(F570861 *dsF570861, LPBHVRCOM lpBhvrCom);<br/>void    I570860B_SomaPedidosDesconto(F570861 *dsF570861, LPBHVRCOM lpBhvrCom);<br/>void    I570860C_SomaQualificadoresExecutivo(F570860   *dsF570860, LPBHVRCOM lpBhvrCom);<br/>void    I570860D_SomaFilhosExecutivo(F570860   *dsF570860, LPBHVRCOM lpBhvrCom,MATH_NUMERIC mnNivel, DSD9800100 dsB9800100);<br/>void    I570860E_ZeraTodosNiveis(MATH_NUMERIC mnAnoMes, JCHAR *szUnidade, LPBHVRCOM lpBhvrCom);<br/>void    I570860F_RefazAjustes(LPDSD570860 lpDS,  LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100);<br/>F57080D I570860G_GetInfoQualificador (JCHAR* CODDES, LPBHVRCOM lpBhvrCom, HUSER hUser);<br/>#endif    /* __B570860_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b570860.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b570860_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b570860<br/> *<br/> *    Description:  Atualização Arvpre Hierarquia Source File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 11/01/11    Unknown     Unknown  - Created  <br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb570860.h&gt<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  CalculaHieraria<br/> *<br/> *        Description:  Calculo da Arvore de Hierarquia<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570860         lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI CalculaHieraria (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570860 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	MATH_NUMERIC		mnNivel				= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/>	JCHAR				TMP_NIVC[9]			= { 0 };<br/>	int					iCount				= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570860[4]					= { 0 };<br/>	SELECTSTRUCT   		lpF570861[4]					= { 0 };<br/>	F570860				dsF570860						= { 0 };<br/>	F570861				dsF570861						= { 0 };<br/>	KEY1_F570860		dsKeyF570860					= { 0 };<br/>	KEY1_F570861		dsKeyF570861					= { 0 };<br/>	DSD9800100			dsB9800100						;<br/>	F57080D				dsF57080D						= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570860						= (HREQUEST)NULL;<br/>	HREQUEST		    hReqF570860_UP					= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570861						= (HREQUEST)NULL;<br/>	HREQUEST		    hReqF570861_UP					= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>        (lpVoid    == (LPVOID)    NULL) ||<br/>        (lpDS      == (LPDSD570860)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>    idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>    ZeroMathNumeric(&mnZero);<br/>	iCount = 0;<br/>	IntToMathNumeric((int) 1, &mnNivel);<br/>	memset((void *)(&dsB9800100), (int)(_J('\0')), sizeof(DSD9800100));<br/><br/>	I570860E_ZeraTodosNiveis(lpDS-&gtmnAnoMesEntrada, lpDS-&gtszUnidade, lpBhvrCom);<br/>    jdeCallObject(_J("GetAuditInfo"), NULL, lpBhvrCom, lpVoid, &dsB9800100,<br/>                  (CALLMAP *) NULL, (int)(0), (JCHAR *) NULL, (JCHAR *) NULL,<br/>                  CALL_OBJECT_NO_ERRORS);<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570860"), DIM(_J("B570860")));<br/>	jdeStrncpy(TMP_NIVC, (const JCHAR *) _J("RADGAU"), DIM(_J("RADGAU")));<br/><br/>	//<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	//<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_NIVP );<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>	lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &mnZero;<br/>	lpF570861[iCount].nValues = 1;<br/>	lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>	lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	//<br/>	if (!(IsStringBlank(lpDS-&gtszUnidade))) <br/>	{<br/>		//<br/>		jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID1);<br/>		jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>		lpF570861[iCount].Item1.idInstance = 0;<br/>		lpF570861[iCount].lpValue = lpDS-&gtszUnidade;<br/>		lpF570861[iCount].nValues = 1;<br/>		lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>		//<br/>	}<br/>	//<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID2);<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>	lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = _J("GER");<br/>	lpF570861[iCount].nValues = 1;<br/>	lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>	lpF570861[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/>	//<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570861);<br/>		idJDBReturn = JDB_SetSelection(hReqF570861, lpF570861, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570861, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570861 , &dsF570861 , 0 ))<br/>		{<br/>			<br/>			dsF57080D = I570860G_GetInfoQualificador(dsF570861.ftcoddes, lpBhvrCom, hUser);<br/><br/>			if (dsF57080D.peev03 == _J('S'))<br/>				dsF570861.ftjdeevnt = _J('S');<br/>			else<br/>				dsF570861.ftjdeevnt = _J('N');<br/><br/>			I570860A_EspandeCalculoQualificadores(&dsF570861, lpBhvrCom, dsB9800100);<br/>			if (dsF57080D.peev02 != _J('S'))<br/>				I570860B_SomaPedidosQualificadores(&dsF570861, lpBhvrCom);<br/>			//else<br/>			//	I570860B_SomaPedidosDesconto(&dsF570861, lpBhvrCom);<br/><br/>			MathCopy(&dsKeyF570861.ftanmesent,	&dsF570861.ftanmesent);<br/>			MathCopy(&dsKeyF570861.ftnivc,		&dsF570861.ftnivc);<br/>			MathCopy(&dsKeyF570861.ftnivp,		&dsF570861.ftnivp);<br/>			jdeStrncpy(dsKeyF570861.ftunid1, (const JCHAR *) dsF570861.ftunid1, DIM(dsF570861.ftunid1));<br/>			jdeStrncpy(dsKeyF570861.ftcup, (const JCHAR *) dsF570861.ftcup, DIM(dsF570861.ftcup));<br/>			jdeStrncpy(dsKeyF570861.ftcoddes, (const JCHAR *) dsF570861.ftcoddes, DIM(dsF570861.ftcoddes));<br/>			jdeStrncpy(dsKeyF570861.ftunid2, (const JCHAR *) dsF570861.ftunid2, DIM(dsF570861.ftunid2));<br/>			jdeStrncpy(dsKeyF570861.fta801, (const JCHAR *) dsF570861.fta801, DIM(dsF570861.fta801));<br/><br/>			jdeStrncpy(dsF570861.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>			jdeStrncpy(dsF570861.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>			jdeStrncpy(dsF570861.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>			MathCopy(&dsF570861.ftupmt, &dsB9800100.mnTime);<br/>			memcpy((void *)(&dsF570861.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>			JDB_UpdateTable(hReqF570861_UP, NID_F570861, (ID)0, ID_F570861_PK, (void *)&dsKeyF570861, (short)8, (void *)&dsF570861);<br/>		}<br/>	}<br/><br/><br/>	if (lpDS-&gtcSobreporAjustes != _J('0'))<br/>		I570860F_RefazAjustes(lpDS, lpBhvrCom, dsB9800100);<br/><br/>	iCount = 0;<br/>	IntToMathNumeric((int) 1, &mnNivel);<br/><br/>	//<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	//<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_NIVP );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &mnZero;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	//<br/>	if (!(IsStringBlank(lpDS-&gtszUnidade))) <br/>	{<br/>		//<br/>		jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID1);<br/>		jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>		lpF570860[iCount].Item1.idInstance = 0;<br/>		lpF570860[iCount].lpValue = lpDS-&gtszUnidade;<br/>		lpF570860[iCount].nValues = 1;<br/>		lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>		//<br/>	}<br/>	//<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID2 );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = _J("GER");<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/>	//<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570860);<br/>		idJDBReturn = JDB_SetSelection(hReqF570860, lpF570860, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570860, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570860 , &dsF570860 , 0 ))<br/>		{<br/>			I570860C_SomaQualificadoresExecutivo(&dsF570860, lpBhvrCom);<br/>			<br/>			MathCopy(&dsKeyF570860.ftanmesent,	&dsF570860.ftanmesent);<br/>			MathCopy(&dsKeyF570860.ftnivc,		&dsF570860.ftnivc);<br/>			MathCopy(&dsKeyF570860.ftnivp,		&dsF570860.ftnivp);<br/>			jdeStrncpy(dsKeyF570860.ftunid1, (const JCHAR *) dsF570860.ftunid1, DIM(dsF570860.ftunid1));<br/>			jdeStrncpy(dsKeyF570860.ftcup, (const JCHAR *) dsF570860.ftcup, DIM(dsF570860.ftcup));<br/>			jdeStrncpy(dsKeyF570860.ftunid2, (const JCHAR *) dsF570860.ftunid2, DIM(dsF570860.ftunid2));<br/>			jdeStrncpy(dsKeyF570860.fta801, (const JCHAR *) dsF570860.fta801, DIM(dsF570860.fta801));<br/><br/>			jdeStrncpy(dsF570860.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>			jdeStrncpy(dsF570860.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>			jdeStrncpy(dsF570860.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>			MathCopy(&dsF570860.ftupmt, &dsB9800100.mnTime);<br/>			memcpy((void *)(&dsF570860.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>			MathCopy(&dsF570860.fthlvl, &mnNivel);<br/>			JDB_UpdateTable(hReqF570860_UP, NID_F570860, (ID)0, ID_F570860_PK, (void *)&dsKeyF570860, (short)7, (void *)&dsF570860);<br/>			I570860D_SomaFilhosExecutivo(&dsF570860, lpBhvrCom, mnNivel, dsB9800100);<br/>		}<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570861 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861);<br/>	<br/>	if (hReqF570861_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861_UP);<br/>	<br/>	if (hReqF570860 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860);<br/>	<br/>	if (hReqF570860_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/><br/><br/>    return (ER_SUCCESS);<br/>}<br/><br/>/* Internal function comment block */<br/><br/>/**************************************************************************<br/> *   Function: I570860A_EspandeCalculoQualificadores<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570860A_EspandeCalculoQualificadores(F570861   *dsPaiF570861, LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100) <br/>{<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn				=  JDEDB_PASSED;<br/>	JCHAR				PROGRAM_ID[11]			= { 0 };<br/>	JCHAR				cEvento					= _J(' ');<br/>	MATH_NUMERIC		mnTotalQualificador		= { 0 };<br/>	MATH_NUMERIC		mnReceitaDesconto		= { 0 };<br/>	MATH_NUMERIC		mnTabelaDesconto		= { 0 };<br/>	MATH_NUMERIC        mnQuociente  	    	= { 0 };<br/>	MATH_NUMERIC    	mnResto 	    	    = { 0 };<br/>	MATH_NUMERIC    	mnUm     	    	    = { 0 };<br/>	MATH_NUMERIC    	mnCem     	    	    = { 0 };<br/>	int					iCount					= 0;<br/>	int                 nDecimais				= 2;<br/>	int                 nArredondar				= 1;<br/>	<br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT		    lpF570861[6]					= { 0 };<br/>	F570861					dsF570861						= { 0 };<br/>	KEY1_F570861			dsKeyF570861					= { 0 };<br/>	F57080D				    dsF57080D						= { 0 };<br/>	 <br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			    hReqF570861						= (HREQUEST)NULL;<br/>	HREQUEST			    hReqF570861_UP					= (HREQUEST)NULL;<br/>	HUSER					hUser							= (HUSER)NULL;<br/>	<br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	ParseNumericString(&mnUm, _J("1"));<br/>	ParseNumericString(&mnCem, _J("100"));<br/>	ZeroMathNumeric(&mnTotalQualificador);<br/>	iCount = 0;<br/>	cEvento = dsPaiF570861-&gtftjdeevnt;<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570860"), DIM(_J("B570860")));<br/>		<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsPaiF570861-&gtftanmesent;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_CODDES );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsPaiF570861-&gtftcoddes;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_NIVP );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsPaiF570861-&gtftnivc;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_UNID2 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsPaiF570861-&gtftunid1;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_A801 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsPaiF570861-&gtftcup;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>    <br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861);<br/>	 <br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570861);<br/>		idJDBReturn = JDB_SetSelection(hReqF570861, lpF570861, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570861, (ID)(0), (void *) NULL, (short)(0));<br/>		 <br/>		while(JDB_Fetch( hReqF570861 , &dsF570861 , 0 ))<br/>		{<br/>			//<br/>			dsF57080D = I570860G_GetInfoQualificador(dsF570861.ftcoddes, lpBhvrCom, hUser);<br/>			//<br/>			dsF570861.ftjdeevnt = dsPaiF570861-&gtftjdeevnt;<br/>			I570860A_EspandeCalculoQualificadores(&dsF570861, lpBhvrCom, dsB9800100);<br/>			if (dsF57080D.peev02 != _J('S'))<br/>				I570860B_SomaPedidosQualificadores(&dsF570861, lpBhvrCom);<br/>			//else <br/>			//	I570860B_SomaPedidosDesconto(&dsF570861, lpBhvrCom);<br/>			//<br/>			MathCopy(&dsKeyF570861.ftanmesent,	&dsF570861.ftanmesent);<br/>			MathCopy(&dsKeyF570861.ftnivc,		&dsF570861.ftnivc);<br/>			MathCopy(&dsKeyF570861.ftnivp,		&dsF570861.ftnivp);<br/>			jdeStrncpy(dsKeyF570861.ftunid1, (const JCHAR *) dsF570861.ftunid1, DIM(dsF570861.ftunid1));<br/>			jdeStrncpy(dsKeyF570861.ftcup, (const JCHAR *) dsF570861.ftcup, DIM(dsF570861.ftcup));<br/>			jdeStrncpy(dsKeyF570861.ftcoddes, (const JCHAR *) dsF570861.ftcoddes, DIM(dsF570861.ftcoddes));<br/>			jdeStrncpy(dsKeyF570861.ftunid2, (const JCHAR *) dsF570861.ftunid2, DIM(dsF570861.ftunid2));<br/>			jdeStrncpy(dsKeyF570861.fta801, (const JCHAR *) dsF570861.fta801, DIM(dsF570861.fta801));<br/>			//			<br/>			jdeStrncpy(dsF570861.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>			jdeStrncpy(dsF570861.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>			jdeStrncpy(dsF570861.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>			MathCopy(&dsF570861.ftupmt, &dsB9800100.mnTime);<br/>			memcpy((void *)(&dsF570861.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/>			//<br/>			JDB_UpdateTable(hReqF570861_UP, NID_F570861, (ID)0, ID_F570861_PK, (void *)&dsKeyF570861, (short)8, (void *)&dsF570861);<br/>			//<br/>			if (dsF57080D.peev02 == _J('S'))<br/>			{<br/>				//<br/>				//MathAdd(&mnReceitaDesconto, &mnReceitaDesconto, &dsF570861.ftaa);<br/>				//MathAdd(&mnTabelaDesconto, &mnTabelaDesconto, &dsF570861.ftanqt);<br/>				//<br/>			} else {<br/>				//<br/>				if ( (dsF570861.ftjdeevnt == _J('N')) )<br/>					MathAdd(&mnTotalQualificador, &mnTotalQualificador, &dsF570861.ftvlrtotli);<br/>				//<br/>			}<br/>			//<br/>		}<br/>	}<br/>	//<br/>	dsF57080D = I570860G_GetInfoQualificador(dsPaiF570861-&gtftcoddes, lpBhvrCom, hUser);<br/>	//<br/>	if (dsF57080D.peev02 == _J('S'))<br/>	{<br/>		//<br/>		MathAdd(&dsPaiF570861-&gtftaa, &dsPaiF570861-&gtftaa, &mnReceitaDesconto);<br/>		MathAdd(&dsPaiF570861-&gtftanqt, &dsPaiF570861-&gtftanqt, &mnTabelaDesconto);<br/>        //<br/>		if (MathZeroTest(&dsPaiF570861-&gtftaa) != 0 && MathZeroTest(&dsPaiF570861-&gtftanqt) != 0)<br/>		{<br/>			//<br/>			MathDivide(&mnQuociente, &mnResto, &dsPaiF570861-&gtftaa, &dsPaiF570861-&gtftanqt, &nDecimais, &nArredondar);<br/>			MathSubtract(&dsPaiF570861-&gtftvlrtotli, &mnUm, &mnQuociente);<br/>			MathAbs(&dsPaiF570861-&gtftvlrtotli, &dsPaiF570861-&gtftvlrtotli);<br/>			MathMultiply (&dsPaiF570861-&gtftvlrtotli, &dsPaiF570861-&gtftvlrtotli, &mnCem);<br/>			//<br/>		} else {<br/>			//<br/>			//<br/>		}<br/>		//<br/>	} else {<br/>		//<br/>		if (dsPaiF570861-&gtftjdeevnt == _J('N'))<br/>			MathAdd(&dsPaiF570861-&gtftvlrtotli, &dsPaiF570861-&gtftvlrtotli, &mnTotalQualificador);<br/>		//<br/>	}<br/>	//<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570861 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861);<br/><br/>	if (hReqF570861_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/>/**************************************************************************<br/> *   Function: I570860B_SomaPedidosQualificadores<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/> void I570860B_SomaPedidosQualificadores(F570861 *dsF570861, LPBHVRCOM lpBhvrCom){<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn						=  JDEDB_PASSED;<br/>	int					iCount							= 0;<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	MATH_NUMERIC			mnTotalExecutado				= { 0 };<br/>	MATH_NUMERIC			mnReceitaDesconto				= { 0 };<br/>	MATH_NUMERIC			mnTabelaDesconto				= { 0 };<br/>	SELECTSTRUCT		    lpF570862[6]					= { 0 };<br/>	F570862					dsF570862						= { 0 };<br/>	 <br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570862						= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	ZeroMathNumeric(&mnTotalExecutado);<br/>	ZeroMathNumeric(&mnReceitaDesconto);<br/>	ZeroMathNumeric(&mnTabelaDesconto);<br/>	iCount = 0;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftanmesent;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_UNID1 );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftunid1;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_CUP );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftcup;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_CODDES );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftcoddes;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if (dsF570861-&gtftjdeevnt == _J('N'))<br/>	{<br/>		jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_NIVC );<br/>		jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>		lpF570862[iCount].Item1.idInstance = 0;<br/>		lpF570862[iCount].lpValue = &dsF570861-&gtftnivc;<br/>		lpF570862[iCount].nValues = 1;<br/>		lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570862, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570862);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570862);<br/>		idJDBReturn = JDB_SetSelection(hReqF570862, lpF570862, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570862, (ID)(0), (void *) NULL, (short)(0));<br/>		//		<br/>		while(JDB_Fetch( hReqF570862 , &dsF570862 , 0 ))<br/>		{<br/> 			MathAdd(&mnTotalExecutado, &mnTotalExecutado, &dsF570862.ftvlrtotli);<br/>			MathAdd(&mnReceitaDesconto, &mnReceitaDesconto, &dsF570862.ftaa);<br/>			MathAdd(&mnTabelaDesconto, &mnTabelaDesconto, &dsF570862.ftanqt);<br/>		}<br/>		//<br/>	}<br/>	<br/>	MathAdd(&dsF570861-&gtftvlrtotli, &dsF570861-&gtftvlrtotli, &mnTotalExecutado);<br/>	MathAdd(&dsF570861-&gtftaa, &dsF570861-&gtftaa, &mnReceitaDesconto);<br/>	MathAdd(&dsF570861-&gtftanqt, &dsF570861-&gtftanqt, &mnTabelaDesconto);<br/> <br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570862 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570862);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/> }<br/><br/><br/>/**************************************************************************<br/> *   Function: I570860B_SomaPedidosDesconto<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/> void I570860B_SomaPedidosDesconto(F570861 *dsF570861, LPBHVRCOM lpBhvrCom){<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn						=  JDEDB_PASSED;<br/>	int					iCount							= 0;<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	MATH_NUMERIC			mnReceitaBase    				= { 0 };<br/>	MATH_NUMERIC			mnTabelaBase    				= { 0 };<br/>	MATH_NUMERIC	        mnQuociente                     = { 0 };<br/>	MATH_NUMERIC	        mnResto                         = { 0 };<br/>	MATH_NUMERIC	        mnUm                            = { 0 };<br/>	MATH_NUMERIC	        mnCem                           = { 0 };<br/>	int                     nDecimais                       = 2;<br/>    int                     nArredondar                     = 1;<br/>	SELECTSTRUCT		    lpF570862[6]					= { 0 };<br/>	F570862					dsF570862						= { 0 };<br/>	 <br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570862						= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	ParseNumericString(&mnUm, _J("1"));<br/>	ParseNumericString(&mnCem, _J("100"));<br/>	iCount = 0;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftanmesent;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_UNID1 );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftunid1;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_CUP );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftcup;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	/*jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_CODDES );<br/>    jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>    lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftcoddes;<br/>	lpF570862[iCount].nValues = 1;<br/>    lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570862[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;*/<br/><br/>	jdeNIDcpy( lpF570862[iCount].Item1.szDict , NID_NIVC );<br/>	jdeNIDcpy( lpF570862[iCount].Item1.szTable , NID_F570862 );<br/>	lpF570862[iCount].Item1.idInstance = 0;<br/>	lpF570862[iCount].lpValue = &dsF570861-&gtftnivc;<br/>	lpF570862[iCount].nValues = 1;<br/>	lpF570862[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>	lpF570862[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570862, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570862);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570862);<br/>		idJDBReturn = JDB_SetSelection(hReqF570862, lpF570862, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570862, (ID)(0), (void *) NULL, (short)(0));<br/>		//<br/>		while(JDB_Fetch( hReqF570862 , &dsF570862 , 0 ))<br/>		{<br/> 			MathAdd(&mnReceitaBase, &mnReceitaBase, &dsF570862.ftaa);<br/>			MathAdd(&mnTabelaBase, &mnTabelaBase, &dsF570862.ftanqt);<br/>		}<br/>		//<br/>	}<br/>	//<br/>	if (MathZeroTest(&mnReceitaBase) != 0 && MathZeroTest(&mnTabelaBase) != 0)<br/>	{<br/>		//<br/>		MathAdd(&dsF570861-&gtftaa, &dsF570861-&gtftaa, &mnReceitaBase);<br/>		MathAdd(&dsF570861-&gtftanqt, &dsF570861-&gtftanqt, &mnTabelaBase);<br/>		MathDivide(&mnQuociente, &mnResto, &mnReceitaBase, &mnTabelaBase, &nDecimais, &nArredondar);<br/>		MathSubtract(&dsF570861-&gtftvlrtotli, &mnUm, &mnQuociente);<br/>		MathAbs(&dsF570861-&gtftvlrtotli, &dsF570861-&gtftvlrtotli);<br/>		MathMultiply (&dsF570861-&gtftvlrtotli, &dsF570861-&gtftvlrtotli, &mnCem);<br/>		//<br/>	}; <br/>	//<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570862 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570862);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/> }<br/><br/> /**************************************************************************<br/> *   Function: I570860C_SomaQualificadoresExecutivo<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570860C_SomaQualificadoresExecutivo(F570860   *dsF570860, LPBHVRCOM lpBhvrCom) {<br/><br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn				=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnTotalQualificador		= { 0 };<br/>	int					iCount					= 0;<br/>	JCHAR				cEvento					= _J('S');<br/>	<br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT		    lpF570861[8]					= { 0 };<br/>	F570861					dsF570861						= { 0 };<br/>	 <br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			    hReqF570861						= (HREQUEST)NULL;<br/>	HUSER					hUser							= (HUSER)NULL;<br/>	<br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>	idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	ZeroMathNumeric(&mnTotalQualificador);<br/>	iCount = 0;<br/>		<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_UNID1 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftunid1;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftanmesent;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_CUP );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftcup;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_NIVC );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftnivc;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_NIVP );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftnivp;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_JDEEVNT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &cEvento;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_UNID2 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtftunid2;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict  , NID_A801 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &dsF570860-&gtfta801;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>    <br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861);<br/>	 <br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570861);<br/>		idJDBReturn = JDB_SetSelection(hReqF570861, lpF570861, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570861, (ID)(0), (void *) NULL, (short)(0));<br/>		 <br/>		while(JDB_Fetch( hReqF570861 , &dsF570861 , 0 ))<br/>			MathAdd(&dsF570860-&gtftvlrtotli, &dsF570860-&gtftvlrtotli, &dsF570861.ftvlrtotli);<br/>	}<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570861 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/> /**************************************************************************<br/> *   Function: I570860D_SomaFilhosExecutivo<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570860D_SomaFilhosExecutivo(F570860   *dsPaiF570860, LPBHVRCOM lpBhvrCom,MATH_NUMERIC mnNivelPai, DSD9800100 dsB9800100) {<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	JCHAR				PROGRAM_ID[11]			= { 0 };<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	MATH_NUMERIC		mnNivel				= { 0 };<br/>	int					iCount				= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570860[4]					= { 0 };<br/>	F570860				dsF570860						= { 0 };<br/>	KEY1_F570860		dsKeyF570860					= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570860						= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570860_UP					= (HREQUEST)NULL;	<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>    idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>    ZeroMathNumeric(&mnZero);<br/>	MathCopy(&mnNivel,	&mnNivelPai);<br/>	IncrementMathNumeric(&mnNivel, (int)1);<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570860"), DIM(_J("B570860")));<br/>	<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftanmesent;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_NIVP );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftnivc;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	<br/>	/*jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID1 );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftunid1;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/>	<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_CUP );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftcup;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;*/<br/><br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID2 );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftunid1;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_A801 );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &dsPaiF570860-&gtftcup;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;	<br/><br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570860);<br/>		idJDBReturn = JDB_SetSelection(hReqF570860, lpF570860, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570860, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570860 , &dsF570860 , 0 ))<br/>		{<br/>			I570860C_SomaQualificadoresExecutivo(&dsF570860, lpBhvrCom);<br/><br/>			MathCopy(&dsKeyF570860.ftanmesent,	&dsF570860.ftanmesent);<br/>			MathCopy(&dsKeyF570860.ftnivc,		&dsF570860.ftnivc);<br/>			MathCopy(&dsKeyF570860.ftnivp,		&dsF570860.ftnivp);<br/>			jdeStrncpy(dsKeyF570860.ftunid1, (const JCHAR *) dsF570860.ftunid1, DIM(dsF570860.ftunid1));<br/>			jdeStrncpy(dsKeyF570860.ftcup, (const JCHAR *) dsF570860.ftcup, DIM(dsF570860.ftcup));<br/>			jdeStrncpy(dsKeyF570860.ftunid2, (const JCHAR *) dsF570860.ftunid2, DIM(dsF570860.ftunid2));<br/>			jdeStrncpy(dsKeyF570860.fta801, (const JCHAR *) dsF570860.fta801, DIM(dsF570860.fta801));<br/><br/>			jdeStrncpy(dsF570860.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>			jdeStrncpy(dsF570860.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>			jdeStrncpy(dsF570860.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>			MathCopy(&dsF570860.ftupmt, &dsB9800100.mnTime);<br/>			memcpy((void *)(&dsF570860.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>			MathCopy(&dsF570860.fthlvl, &mnNivel);<br/>			JDB_UpdateTable(hReqF570860_UP, NID_F570860, (ID)0, ID_F570860_PK, (void *)&dsKeyF570860, (short)7, (void *)&dsF570860);<br/>			I570860D_SomaFilhosExecutivo(&dsF570860, lpBhvrCom, mnNivel, dsB9800100);<br/><br/>		}<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570860 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860);<br/>	<br/>	if (hReqF570860_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/><br/>/**************************************************************************<br/> *   Function: I570860E_ZeraTodosNiveis<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void    I570860E_ZeraTodosNiveis(MATH_NUMERIC mnAnoMes, JCHAR *szUnidade, LPBHVRCOM lpBhvrCom)<br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	int					iCount				= 0;<br/><br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570860[3]					= { 0 };<br/>	SELECTSTRUCT   		lpF570861[3]					= { 0 };<br/>	F570860				dsF570860						= { 0 };<br/>	F570861				dsF570861						= { 0 };<br/>	//F57080D             dsF57080D                       = { 0 };<br/>	KEY1_F570860		dsKeyF570860					= { 0 };<br/>	KEY1_F570861		dsKeyF570861					= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570860						= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570861						= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570860_UP					= (HREQUEST)NULL;	<br/>	HREQUEST			hReqF570861_UP					= (HREQUEST)NULL;	<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>    idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>    ZeroMathNumeric(&mnZero);<br/>	iCount = 0;<br/>	<br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = &mnAnoMes;<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if (!(IsStringBlank(szUnidade)))<br/>	{<br/>		jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID1 );<br/>	    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>		lpF570860[iCount].Item1.idInstance = 0;<br/>		lpF570860[iCount].lpValue = szUnidade;<br/>		lpF570860[iCount].nValues = 1;<br/>		lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570860[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>	jdeNIDcpy( lpF570860[iCount].Item1.szDict , NID_UNID2 );<br/>    jdeNIDcpy( lpF570860[iCount].Item1.szTable , NID_F570860 );<br/>    lpF570860[iCount].Item1.idInstance = 0;<br/>	lpF570860[iCount].lpValue = _J("GER");<br/>	lpF570860[iCount].nValues = 1;<br/>    lpF570860[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570860[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570860, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570860);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570860);<br/>		idJDBReturn = JDB_SetSelection(hReqF570860, lpF570860, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570860, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570860 , &dsF570860 , 0 ))<br/>		{<br/>			MathCopy(&dsKeyF570860.ftanmesent,	&dsF570860.ftanmesent);<br/>			MathCopy(&dsKeyF570860.ftnivc,		&dsF570860.ftnivc);<br/>			MathCopy(&dsKeyF570860.ftnivp,		&dsF570860.ftnivp);<br/>			jdeStrncpy(dsKeyF570860.ftunid1, (const JCHAR *) dsF570860.ftunid1, DIM(dsF570860.ftunid1));<br/>			jdeStrncpy(dsKeyF570860.ftcup, (const JCHAR *) dsF570860.ftcup, DIM(dsF570860.ftcup));<br/>			jdeStrncpy(dsKeyF570860.ftunid2, (const JCHAR *) dsF570860.ftunid2, DIM(dsF570860.ftunid2));<br/>			jdeStrncpy(dsKeyF570860.fta801, (const JCHAR *) dsF570860.fta801, DIM(dsF570860.fta801));<br/>			MathCopy(&dsF570860.ftvlrtotli, &mnZero);<br/><br/>			JDB_UpdateTable(hReqF570860_UP, NID_F570860, (ID)0, ID_F570860_PK, (void *)&dsKeyF570860, (short)7, (void *)&dsF570860);<br/>		}<br/>	}<br/><br/>	iCount = 0;<br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &mnAnoMes;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if (!(IsStringBlank(szUnidade)))<br/>	{<br/>		jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID1 );<br/>	    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>		lpF570861[iCount].Item1.idInstance = 0;<br/>		lpF570861[iCount].lpValue = szUnidade;<br/>		lpF570861[iCount].nValues = 1;<br/>		lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>	}<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID2 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = _J("GER");<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/><br/>	<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570861);<br/>		idJDBReturn = JDB_SetSelection(hReqF570861, lpF570861, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570861, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570861 , &dsF570861 , 0 ))<br/>		{<br/>			//<br/>			//dsF57080D = I570860G_GetInfoQualificador(dsF570861.ftcoddes, lpBhvrCom, hUser);<br/>			//<br/>			//if (dsF57080D.peev02 != 'S')<br/>			//{<br/>			//<br/>			MathCopy(&dsKeyF570861.ftanmesent,	&dsF570861.ftanmesent);<br/>			MathCopy(&dsKeyF570861.ftnivc,		&dsF570861.ftnivc);<br/>			MathCopy(&dsKeyF570861.ftnivp,		&dsF570861.ftnivp);<br/>			jdeStrncpy(dsKeyF570861.ftunid1, (const JCHAR *) dsF570861.ftunid1, DIM(dsF570861.ftunid1));<br/>			jdeStrncpy(dsKeyF570861.ftcup, (const JCHAR *) dsF570861.ftcup, DIM(dsF570861.ftcup));<br/>			jdeStrncpy(dsKeyF570861.ftunid2, (const JCHAR *) dsF570861.ftunid2, DIM(dsF570861.ftunid2));<br/>			jdeStrncpy(dsKeyF570861.fta801, (const JCHAR *) dsF570861.fta801, DIM(dsF570861.fta801));<br/>			jdeStrncpy(dsKeyF570861.ftcoddes, (const JCHAR *) dsF570861.ftcoddes, DIM(dsF570861.ftcoddes));<br/>			MathCopy(&dsF570861.ftvlrtotli, &mnZero);<br/>			MathCopy(&dsF570861.ftaa, &mnZero);<br/>			MathCopy(&dsF570861.ftanqt, &mnZero);<br/>			//<br/>			JDB_UpdateTable(hReqF570861_UP, NID_F570861, (ID)0, ID_F570861_PK, (void *)&dsKeyF570861, (short)8, (void *)&dsF570861);			<br/>			//<br/>			//}<br/>		}<br/>	}<br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570860 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860);<br/>	<br/>	if (hReqF570860_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570860_UP);<br/><br/>	if (hReqF570861 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861);<br/>	<br/>	if (hReqF570861_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861_UP);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/>/**************************************************************************<br/> *   Function: I570860F_RefazAjustes<br/> *                           <br/> *      Notes: <br/> *<br/> *    Returns: <br/> *<br/> * Parameters: <br/> **************************************************************************/<br/>void I570860F_RefazAjustes(LPDSD570860 lpDS,  LPBHVRCOM lpBhvrCom, DSD9800100 dsB9800100)<br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID					idJDBReturn			=  JDEDB_PASSED;<br/>	MATH_NUMERIC		mnZero				= { 0 };<br/>	MATH_NUMERIC		mnUm				= { 0 };<br/>	MATH_NUMERIC		mnMaior				= { 0 };<br/>	MATH_NUMERIC		mnValor				= { 0 };<br/>	MATH_NUMERIC		mnValorAntigo		= { 0 };<br/>	int					iCount				= 0;<br/>	int					iCount2				= 0;<br/>	JCHAR				cAtualiza			= _J('N');<br/>	JCHAR				szReajuste[30]		= { 0 };<br/>	JCHAR				PROGRAM_ID[11]		= { 0 };<br/>	JCHAR*				pszConcat			= (JCHAR*)NULL;<br/><br/>	/************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	SELECTSTRUCT   		lpF570861[8]					= { 0 };<br/>	SELECTSTRUCT   		lpF570861L[8]					= { 0 };<br/>	F570861				dsF570861						= { 0 };<br/>	F570861L			dsF570861L						= { 0 };<br/>	F570861L			dsF570861L_Ins					= { 0 };<br/>	KEY1_F570861		dsKeyF570861					= { 0 };<br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST			hReqF570861						= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570861L					= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570861_UP					= (HREQUEST)NULL;<br/>	HREQUEST			hReqF570861L_INS				= (HREQUEST)NULL;<br/>	HUSER				hUser							= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/>    idJDBReturn  = JDB_InitBhvr( lpBhvrCom , &hUser , NULL , JDEDB_COMMIT_AUTO );<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/><br/>	memset((void *)(&lpF570861),    (int)(_J('\0')), sizeof(lpF570861));<br/>	memset((void *)(&lpF570861L),   (int)(_J('\0')), sizeof(lpF570861L));<br/>	memset((void *)(&dsF570861),    (int)(_J('\0')), sizeof(dsF570861));<br/>	memset((void *)(&dsF570861L),   (int)(_J('\0')), sizeof(dsF570861L));<br/>	memset((void *)(&dsKeyF570861), (int)(_J('\0')), sizeof(dsKeyF570861));<br/>	jdeStrncpy(PROGRAM_ID, (const JCHAR *) _J("B570860"), DIM(_J("B570860")));<br/>	ParseNumericStringEx(&mnUm , _J("1") ,  DEFAULT_SEPARATOR | CURRENCY_KEEP );<br/>	ZeroMathNumeric(&mnZero);<br/>	ZeroMathNumeric(&mnMaior);<br/>	ZeroMathNumeric(&mnValor);<br/>	iCount = 0;<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_ANMESENT );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = &lpDS-&gtmnAnoMesEntrada;<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>	iCount++;<br/><br/>	if (!(IsStringBlank(lpDS-&gtszUnidade))) <br/>	{<br/>		//<br/>		jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID1);<br/>		jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>		lpF570861[iCount].Item1.idInstance = 0;<br/>		lpF570861[iCount].lpValue = lpDS-&gtszUnidade;<br/>		lpF570861[iCount].nValues = 1;<br/>		lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>		lpF570861[iCount].nCmp = JDEDB_CMP_EQ;<br/>		iCount++;<br/>		//<br/>	}<br/><br/>	jdeNIDcpy( lpF570861[iCount].Item1.szDict , NID_UNID2 );<br/>    jdeNIDcpy( lpF570861[iCount].Item1.szTable , NID_F570861 );<br/>    lpF570861[iCount].Item1.idInstance = 0;<br/>	lpF570861[iCount].lpValue = _J("GER");<br/>	lpF570861[iCount].nValues = 1;<br/>    lpF570861[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>    lpF570861[iCount].nCmp = JDEDB_CMP_NE;<br/>	iCount++;<br/>	<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861,  0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861_UP);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861,  0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861L, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861L);<br/>	idJDBReturn = JDB_OpenTable(hUser, NID_F570861L, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF570861L_INS);<br/><br/>	if (idJDBReturn != JDEDB_FAILED)<br/>	{<br/>		JDB_ClearSelection(hReqF570861);<br/>		idJDBReturn = JDB_SetSelection(hReqF570861, lpF570861, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF570861, (ID) 0, (void *) NULL, (short)(0));<br/><br/>		while(JDB_Fetch( hReqF570861 , &dsF570861 , 0 ))<br/>		{<br/><br/>			memset((void *)(&lpF570861L),   (int)(_J('\0')), sizeof(lpF570861L));<br/>			memset((void *)(&dsF570861L),   (int)(_J('\0')), sizeof(dsF570861L));<br/>			ZeroMathNumeric(&mnMaior);<br/>			ZeroMathNumeric(&mnValor);<br/>			ZeroMathNumeric(&mnValorAntigo);<br/>			cAtualiza = _J('N');<br/>			iCount2 = 0;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_ANMESENT );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftanmesent;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_UNID1 );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftunid1;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/>			<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_CUP );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftcup;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_CODDES );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftcoddes;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_NIVC );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftnivc;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_NIVP );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftnivp;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_UNID2 );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.ftunid2;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/>			<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szDict , NID_A801 );<br/>			jdeNIDcpy( lpF570861L[iCount2].Item1.szTable , NID_F570861L );<br/>			lpF570861L[iCount2].Item1.idInstance = 0;<br/>			lpF570861L[iCount2].lpValue = &dsF570861.fta801;<br/>			lpF570861L[iCount2].nValues = 1;<br/>			lpF570861L[iCount2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpF570861L[iCount2].nCmp = JDEDB_CMP_EQ;<br/>			iCount2++;<br/><br/>			JDB_ClearSelection(hReqF570861L);<br/>			idJDBReturn = JDB_SetSelection(hReqF570861L, lpF570861L, (short)iCount2, JDEDB_SET_REPLACE);<br/>			idJDBReturn = JDB_SelectKeyed(hReqF570861L, (ID) 0, (void *) NULL, (short)(0));<br/><br/>			while(JDB_Fetch( hReqF570861L , &dsF570861L , 0 ))<br/>			{<br/>				if (MathCompare(&dsF570861L.ftseq, &mnMaior) &gt 0)<br/>				{<br/>					MathCopy(&mnMaior,	&dsF570861L.ftseq);<br/><br/>					if ((dsF570861L.ftev01 == _J('N')) && (dsF570861L.ftev02 == _J('E')))<br/>					{<br/>						cAtualiza = _J('S');<br/>						MathCopy(&mnValor,	&dsF570861L.ftvlrtotli);<br/>						memcpy ((void *)(&dsF570861L_Ins), (const void *)(&dsF570861L), sizeof (F570861L));<br/>					}<br/>				}<br/>				<br/>			}<br/><br/>			if(cAtualiza == _J('S'))<br/>			{<br/>				MathCopy(&dsKeyF570861.ftanmesent,	&dsF570861.ftanmesent);<br/>				MathCopy(&dsKeyF570861.ftnivc,		&dsF570861.ftnivc);<br/>				MathCopy(&dsKeyF570861.ftnivp,		&dsF570861.ftnivp);<br/>				jdeStrncpy(dsKeyF570861.ftunid1, (const JCHAR *) dsF570861.ftunid1, DIM(dsF570861.ftunid1));<br/>				jdeStrncpy(dsKeyF570861.ftcup, (const JCHAR *) dsF570861.ftcup, DIM(dsF570861.ftcup));<br/>				jdeStrncpy(dsKeyF570861.ftcoddes, (const JCHAR *) dsF570861.ftcoddes, DIM(dsF570861.ftcoddes));<br/>				jdeStrncpy(dsKeyF570861.ftunid2, (const JCHAR *) dsF570861.ftunid2, DIM(dsF570861.ftunid2));<br/>				jdeStrncpy(dsKeyF570861.fta801, (const JCHAR *) dsF570861.fta801, DIM(dsF570861.fta801));<br/><br/>				<br/>				MathCopy(&mnValorAntigo, &dsF570861.ftvlrtotli);<br/>				MathCopy(&dsF570861.ftvlrtotli, &mnValor);<br/><br/>				jdeStrncpy(dsF570861.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>				jdeStrncpy(dsF570861.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>				jdeStrncpy(dsF570861.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>				MathCopy(&dsF570861.ftupmt, &dsB9800100.mnTime);<br/>				memcpy((void *)(&dsF570861.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/><br/>				JDB_UpdateTable(hReqF570861_UP, NID_F570861, (ID)0, ID_F570861_PK, (void *)&dsKeyF570861, (short)8, (void *)&dsF570861);<br/><br/>				<br/>				if(lpDS-&gtcSobreporAjustes == _J('2'))<br/>				{<br/>					MathAdd(&dsF570861L_Ins.ftseq, &mnMaior, &mnUm);<br/>					MathCopy(&dsF570861L_Ins.ftvlrtotli, &mnValor);<br/>					MathCopy(&dsF570861L_Ins.ftvlr1, &mnValorAntigo);<br/>					dsF570861L_Ins.ftev01 = _J('S');<br/><br/>					jdeStrncpy(szReajuste, (const JCHAR *)_J("Re-Ajustado "), DIM(_J("Re-Ajustado ")));<br/>					if ( pszConcat ) { <br/>						jdeFree(pszConcat ); <br/>					}<br/>					pszConcat = (JCHAR*)jdeAlloc( COMMON_POOL , (jdeStrlen(szReajuste)+jdeStrlen(lpDS-&gtszProgramId)+1)*sizeof(JCHAR) ,MEM_ZEROINIT );<br/>					jdeStrcpy( pszConcat , szReajuste );<br/>					jdeStrcat( pszConcat , lpDS-&gtszProgramId );<br/>					jdeStrncpyTerminate(szReajuste, pszConcat, DIM(szReajuste));<br/><br/>					if ( pszConcat ) { <br/>						jdeFree(pszConcat ); <br/>					}<br/>					pszConcat = (JCHAR*)jdeAlloc( COMMON_POOL , (jdeStrlen(szReajuste)+jdeStrlen(_J(" - "))+1)*sizeof(JCHAR) ,MEM_ZEROINIT );<br/>					jdeStrcpy( pszConcat , szReajuste );<br/>					jdeStrcat( pszConcat , _J(" - ") );<br/>					jdeStrncpyTerminate(szReajuste, pszConcat, DIM(szReajuste));<br/><br/>					if ( pszConcat ) { <br/>						jdeFree(pszConcat ); <br/>					}<br/><br/>					pszConcat = (JCHAR*)jdeAlloc( COMMON_POOL , (jdeStrlen(szReajuste)+jdeStrlen(dsF570861L_Ins.ftstr350)+1)*sizeof(JCHAR) ,MEM_ZEROINIT );<br/>					jdeStrcpy( pszConcat , szReajuste );<br/>					jdeStrcat( pszConcat , dsF570861L_Ins.ftstr350);<br/>					jdeStrncpyTerminate(dsF570861L_Ins.ftstr350, pszConcat, DIM(dsF570861L_Ins.ftstr350));<br/><br/><br/>					jdeStrncpy(dsF570861L_Ins.ftuser, (const JCHAR *) dsB9800100.szUserName, DIM(dsB9800100.szUserName));<br/>					jdeStrncpy(dsF570861L_Ins.ftjobn, (const JCHAR *) dsB9800100.szWorkstation_UserId, DIM(dsB9800100.szWorkstation_UserId));<br/>					jdeStrncpy(dsF570861L_Ins.ftpid, (const JCHAR *) PROGRAM_ID, DIM(PROGRAM_ID));<br/>					MathCopy(&dsF570861L_Ins.ftupmt, &dsB9800100.mnTime);<br/>					memcpy((void *)(&dsF570861L_Ins.ftupmj), (const void *)(&dsB9800100.jdDate),sizeof(JDEDATE));<br/>					<br/>					JDB_InsertTable(hReqF570861L_INS, NID_F570861L, (ID)NULL, (void *)&dsF570861L_Ins);<br/>				}<br/>			}<br/><br/>		}<br/>	}<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF570861_UP != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861_UP);<br/>	<br/>	if (hReqF570861 != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861);<br/><br/>	if (hReqF570861L != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861L);<br/>	<br/>	if (hReqF570861L_INS != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF570861L_INS);<br/><br/>	if (hUser != (HUSER) NULL)<br/>		JDB_FreeBhvr(hUser);<br/>}<br/>/**************************************************************************<br/> *   Function: I570870_GetInfoQualificador<br/> *                           <br/> *      Notes: Retorna Informacoes do Qualificador<br/> *<br/> *    Returns: Estrutura F57080D<br/> * <br/> * Parameters: CODDES    = Codigo do Qualificador<br/> *			   lpBhvrCom = Business Function Communications<br/> **************************************************************************/<br/> F57080D I570860G_GetInfoQualificador (JCHAR* CODDES, LPBHVRCOM lpBhvrCom, HUSER hUser)<br/> {<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID								idJDBReturn				=  JDEDB_PASSED;<br/>	int								iCount					=  0;<br/>	<br/>   /************************************************************************<br/>    * Declare structures<br/>    ************************************************************************/<br/>	NEWSELECTSTRUCT					lpF57080D[20]			= { 0 };<br/>	F57080D							dsF57080D				= { 0 };<br/><br/><br/>   /************************************************************************<br/>    * Declare pointers<br/>    ************************************************************************/<br/>	HREQUEST				hReqF57080D						= (HUSER)NULL;<br/><br/>   /************************************************************************<br/>    * Set pointers<br/>    ************************************************************************/<br/><br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	<br/>	 jdeNIDcpy( lpF57080D[iCount].Item1.szDict , NID_CODDES );<br/>     jdeNIDcpy( lpF57080D[iCount].Item1.szTable , NID_F57080D );<br/>     lpF57080D[iCount].Item1.idInstance = 0;<br/>	 lpF57080D[iCount].lpValue = CODDES;<br/>	 lpF57080D[iCount].nValues = 1;<br/>     lpF57080D[iCount].nAndOr = JDEDB_ANDOR_AND;<br/>     lpF57080D[iCount].nCmp = JDEDB_CMP_EQ;<br/>	 iCount++;<br/><br/>	 idJDBReturn = JDB_OpenTable(hUser, NID_F57080D, 0, NULL, (ushort) 0, (JCHAR *) NULL, &hReqF57080D);<br/><br/>	 if (idJDBReturn != JDEDB_FAILED)<br/>	 {<br/>		JDB_ClearSelection(hReqF57080D);<br/>		idJDBReturn = JDB_SetSelectionX(hReqF57080D, lpF57080D, (short)iCount, JDEDB_SET_REPLACE);<br/>		idJDBReturn = JDB_SelectKeyed(hReqF57080D, (ID) 0, (void *) NULL, (short)(0));<br/>		JDB_Fetch( hReqF57080D , &dsF57080D , 0 );<br/>	 }<br/><br/><br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hReqF57080D != (HREQUEST) NULL)<br/>		JDB_CloseTable(hReqF57080D);<br/><br/>	return (dsF57080D);<br/> }<br/><br/></pre></div></div></body></html>