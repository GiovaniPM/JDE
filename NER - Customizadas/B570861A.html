<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: B570861A - Cache F570861<BR>Function Type: C</div><div class='section'>EVENTS<div class='objectheader'>C Function: Cache F570861 - [FinalizaCacheF570861]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570861 - Estrutura de Dados da Função B570861A                       </B><BR>BF szNomeCache [AA12]<BR>BF mnAnoMes [ANMESENT]<BR>BF szUnidade [UNID1]<BR>BF szOrigem [CUP]<BR>BF mnNivelPai [NIVP]<BR>BF mnNivelFilho [NIVC]<BR>BF nNumChaves [CIP]<BR>BF idCache [GENLNG]<BR>BF cSegueBusca [EV01]<BR>BF szQualificador [CODDES]<BR></div><pre><div class='dstrmembers'><B>Header File: b570861a.h</B><BR></div><br/>/*****************************************************************************<br/> *    Header File:  B570861A.h<br/> *<br/> *    Description:  Cache F570861 Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 07/12/10                Unknown  - Created  <br/> *<br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source <br/> * Company.  All rights reserved.  The methods and techniques described <br/> * herein are considered trade secrets and/or confidential.  Reproduction<br/> * or distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/><br/>#ifndef __B570861A_H<br/>#define __B570861A_H<br/><br/>/*****************************************************************************<br/> * Table Header Inclusions<br/> ****************************************************************************/<br/>#include &ltf570861.h&gt<br/><br/>/*****************************************************************************<br/> * Structure Definitions<br/> ****************************************************************************/<br/>typedef struct<br/>{<br/>  MATH_NUMERIC      mnAnoMes;                            <br/>  JCHAR              szUnidade[4];                        <br/>  JCHAR              szOrigem[9];                         <br/>  MATH_NUMERIC      mnNivelPai;                          <br/>  MATH_NUMERIC      mnNivelFilho;      <br/>  JCHAR              szQualificador[11];<br/>} DSCACHE, *LPDSCACHE, DSCACHE_KEY, *LPDSCACHE_KEY;<br/><br/>/*****************************************************************************<br/> * DS Template Type Definitions<br/> ****************************************************************************/<br/>/*****************************************<br/> * TYPEDEF for Data Structure<br/> *    Template Name: Estrutura de Dados da Função B570861A<br/> *    Template ID:   D570861<br/> *    Generated:     Tue Dec 07 10:28:29 2010<br/> *<br/> * DO NOT EDIT THE FOLLOWING TYPEDEF<br/> *    To make modifications, use the OneWorld Data Structure<br/> *    Tool to Generate a revised version, and paste from<br/> *    the clipboard.<br/> *<br/> **************************************/<br/><br/>#ifndef DATASTRUCTURE_D570861<br/>#define DATASTRUCTURE_D570861<br/><br/>typedef struct tagDSD570861<br/>{<br/>  JCHAR              szNomeCache[13];                     <br/>  MATH_NUMERIC      mnAnoMes;                            <br/>  JCHAR              szUnidade[4];                        <br/>  JCHAR              szOrigem[9];                         <br/>  MATH_NUMERIC      mnNivelPai;                          <br/>  MATH_NUMERIC      mnNivelFilho;                        <br/>  int               nNumChaves;                          <br/>  ID                idCache;                             <br/>  JCHAR              cSegueBusca;                         <br/>  JCHAR              szQualificador[11];                  <br/>} DSD570861, *LPDSD570861;<br/><br/>#define IDERRszNomeCache_1                        1L<br/>#define IDERRmnAnoMes_2                           2L<br/>#define IDERRszUnidade_3                          3L<br/>#define IDERRszOrigem_4                           4L<br/>#define IDERRmnNivelPai_5                         5L<br/>#define IDERRmnNivelFilho_6                       6L<br/>#define IDERRnNumChaves_7                         7L<br/>#define IDERRidCache_8                            8L<br/>#define IDERRcSegueBusca_9                        9L<br/>#define IDERRszQualificador_10                    10L<br/><br/>#endif<br/><br/>/*****************************************************************************<br/> * Source Preprocessor Definitions<br/> ****************************************************************************/<br/>#if defined (JDEBFRTN)<br/>	#undef JDEBFRTN<br/>#endif<br/><br/>#if defined (WIN32)<br/>	#if defined (WIN32)<br/>		#define JDEBFRTN(r) __declspec(dllexport) r<br/>	#else<br/>		#define JDEBFRTN(r) __declspec(dllimport) r<br/>	#endif<br/>#else<br/>	#define JDEBFRTN(r) r<br/>#endif<br/><br/>/*****************************************************************************<br/> * Business Function Prototypes<br/> ****************************************************************************/<br/>JDEBFRTN (ID) JDEBFWINAPI FinalizaCacheF570861             (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI InicializaCacheF570861           (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI PesquisaCacheF570861             (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS);<br/>JDEBFRTN (ID) JDEBFWINAPI ProximoRegistroCacheF570861      (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS);<br/><br/>/*****************************************************************************<br/> * Internal Function Prototypes<br/> ****************************************************************************/<br/>int I570861A_IniciaCache(HUSER Usuario, HCACHE *lpCache, JCHAR *Nome);<br/>void I570861A_PopulaRegistroCache(DSCACHE *RegistroCache, F570861 Registro);<br/>void I570861A_PopulaParametros(DSCACHE RegistroCache, LPDSD570861 Parametros);<br/>int I570861A_PegaCursorCache(HUSER hUser, HCACHE hCache, HJDECURSOR *Cursor, long int idCursor, BOOL bResetCursor);<br/><br/>#endif    /* __B570861A_H */<br/><br/></pre><BR/><pre><div class='dstrmembers'><B>Source File: b570861a.c</B><BR></div>#include &ltjde.h&gt<br/><br/>#define b570861a_c<br/><br/><br/>/*****************************************************************************<br/> *    Source File:  b570810a<br/> *<br/> *    Description:  Cache F570861 Header File<br/> *<br/> *        History:<br/> *          Date        Programmer  SAR# - Description<br/> *          ----------  ----------  -------------------------------------------<br/> *   Author 07/12/10                Unknown  - Created  <br/> *<br/> * Copyright (c) J.D. Edwards World Source Company, 1996<br/> *<br/> * This unpublished material is proprietary to J.D. Edwards World Source Company.<br/> * All rights reserved.  The methods and techniques described herein are<br/> * considered trade secrets and/or confidential.  Reproduction or<br/> * distribution, in whole or in part, is forbidden except by express<br/> * written permission of J.D. Edwards World Source Company.<br/> ****************************************************************************/<br/>/**************************************************************************<br/> * Notes:<br/> *<br/> **************************************************************************/<br/><br/>#include &ltb570861a.h&gt<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  FinalizaCache<br/> *<br/> *        Description:  Finaliza Cache F570861<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810C        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI FinalizaCacheF570861 (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HCACHE						 hCache					   = (HCACHE)NULL;<br/>	ID                           idJDEDBReturn             = ER_SUCCESS;<br/>	int                          ErroCache                 = 0;<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570861)	NULL))<br/>    {<br/>     jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>     return ER_ERROR;<br/>    }<br/>    //<br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_AUTO);<br/>    //<br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>    //<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>    ErroCache = I570861A_IniciaCache(hUser, &hCache, lpDS-&gtszNomeCache);<br/>	if (ErroCache == 0){<br/>		jdeCacheTerminateAll(hUser, hCache);<br/>	}    <br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hUser)<br/>    {<br/>		JDB_FreeBhvr(hUser);<br/>    }	<br/>    return (ER_SUCCESS);<br/>}<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  InicializaCache<br/> *<br/> *        Description:  Inicializa Cache F570861<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810C        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI InicializaCacheF570861 (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>    HREQUEST                     hF570861                  = (HREQUEST)NULL; <br/>    SELECTSTRUCT                 *lpSelect                 = (SELECTSTRUCT *)NULL; <br/>    JDECM_RESULT                 lResultado                = 0;<br/>	int                          ErroCache                 = 0;<br/>	DSCACHE                      dsRegistroCache           = {0};<br/>	ID                           idJDEDBReturn             = ER_SUCCESS;<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HCACHE						 hCache					   = (HCACHE)NULL;<br/>	F570861                      RegistroF570861           = {0};<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570861)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/>    //<br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_AUTO);<br/>    //<br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>    //<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/   <br/>	lResultado = JDB_OpenTable(hUser, _J("F570861"), 0, NULL, 0, NULL, &hF570861); <br/>	if (lResultado == JDEDB_PASSED) {<br/>		lpSelect = jdeAlloc(COMMON_POOL,lpDS-&gtnNumChaves * sizeof (SELECTSTRUCT), MEM_ZEROINIT); <br/>		//<br/>		if (lpDS-&gtnNumChaves &gt= 1) {<br/>			jdeNIDcpy(lpSelect[0].Item1.szDict, _J("ANMESENT"));<br/>			jdeNIDcpy(lpSelect[0].Item1.szTable, _J("F570861"));<br/>			lpSelect[0].Item1.idInstance = 0;<br/>			jdeNIDcpy(lpSelect[0].Item2.szDict, _J(""));<br/>			jdeNIDcpy(lpSelect[0].Item2.szTable, _J(""));<br/>			lpSelect[0].Item1.idInstance = 0;<br/>			lpSelect[0].lpValue = &lpDS-&gtmnAnoMes;<br/>			lpSelect[0].nAndOr = JDEDB_ANDOR_AND;<br/>			lpSelect[0].nCmp   = JDEDB_CMP_EQ;<br/>			lpSelect[0].nValues = 1;<br/>		}<br/>		//<br/>		if (lpDS-&gtnNumChaves &gt= 2) {<br/>			jdeNIDcpy(lpSelect[1].Item1.szDict, _J("UNID1"));<br/>			jdeNIDcpy(lpSelect[1].Item1.szTable, _J("F570861"));<br/>			lpSelect[1].Item1.idInstance = 0;<br/>			jdeNIDcpy(lpSelect[1].Item2.szDict, _J(""));<br/>			jdeNIDcpy(lpSelect[1].Item2.szTable, _J(""));<br/>			lpSelect[1].Item1.idInstance = 0;<br/>			lpSelect[1].lpValue = &lpDS-&gtszUnidade;<br/>			lpSelect[1].nAndOr = JDEDB_ANDOR_AND;<br/>			lpSelect[1].nCmp   = JDEDB_CMP_EQ;<br/>			lpSelect[1].nValues = 1;<br/>		}<br/>		//<br/>		if (lpDS-&gtnNumChaves &gt= 3) {<br/>			jdeNIDcpy(lpSelect[2].Item1.szDict, _J("CUP"));<br/>			jdeNIDcpy(lpSelect[2].Item1.szTable, _J("F570861"));<br/>			lpSelect[2].Item1.idInstance = 0;<br/>			jdeNIDcpy(lpSelect[2].Item2.szDict, _J(""));<br/>			jdeNIDcpy(lpSelect[2].Item2.szTable, _J(""));<br/>			lpSelect[2].Item1.idInstance = 0;<br/>			lpSelect[2].lpValue = &lpDS-&gtszOrigem;<br/>			lpSelect[2].nAndOr = JDEDB_ANDOR_AND;<br/>			lpSelect[2].nCmp   = JDEDB_CMP_EQ;<br/>			lpSelect[2].nValues = 1;<br/>		}<br/>		//<br/>		JDB_ClearSelection(hF570861);<br/>		lResultado = JDB_SetSelection(hF570861, lpSelect, (unsigned short)(lpDS-&gtnNumChaves), JDEDB_SET_REPLACE); <br/>		if (lResultado == JDEDB_PASSED) {<br/>			//executa o select<br/>			lResultado = JDB_SelectKeyed(hF570861, 0, NULL, 0); <br/>			if (lResultado == JDEDB_PASSED) {<br/>				//<br/>				ErroCache = I570861A_IniciaCache(hUser, &hCache, lpDS-&gtszNomeCache);<br/>				if (ErroCache == 0){<br/>					//<br/>					while (JDB_Fetch(hF570861, &RegistroF570861, FALSE) == JDEDB_PASSED) {<br/>						//<br/>						I570861A_PopulaRegistroCache(&dsRegistroCache, RegistroF570861);<br/>						ErroCache = jdeCacheAdd(hCache, (void *)&dsRegistroCache, sizeof(DSCACHE));<br/>						//<br/>					}<br/>					//<br/>				}<br/>				//<br/>			} else {<br/>				//seta erro<br/>			}<br/>		//<br/>		} else {<br/>			//seta erro<br/>		}<br/>		//<br/>	} else {<br/>		//seta erro<br/>	};	<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hF570861)<br/>	{<br/>		JDB_CloseTable(hF570861);<br/>	}	<br/>	if (hUser)<br/>    {<br/>		JDB_FreeBhvr(hUser);<br/>    }<br/>    return (ER_SUCCESS);<br/>}<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  PesquisaCache<br/> *<br/> *        Description:  Pesquisa Cache F570861<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810C        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI PesquisaCacheF570861 (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	ID                           idJDEDBReturn             = ER_SUCCESS;<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HCACHE						 hCache					   = (HCACHE)NULL;<br/>	HJDECURSOR				     hCursor				   = (HJDECURSOR)NULL;<br/>	DSCACHE                      dsRegistroCache           = {0};<br/>	LPDSCACHE_KEY				 lpChaveCache			   = NULL;<br/>	JDECM_RESULT			     jdeCacheReturn			   = JDECM_PASSED;<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570861)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/>	//<br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_AUTO);<br/>	//<br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>	//<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	if (I570861A_IniciaCache(hUser, &hCache, lpDS-&gtszNomeCache) != 0) {<br/>		return ER_ERROR;<br/>	}<br/>	if (I570861A_PegaCursorCache(hUser, hCache, &hCursor, lpDS-&gtidCache, FALSE) == 0) <br/>	{<br/>		//<br/>		jdeCacheSetIndex(hCache,hCursor,2);<br/>		//<br/>		memset((void *)&dsRegistroCache, (int)_J('\0'), sizeof(dsRegistroCache));<br/>		//<br/>		lpChaveCache = malloc(sizeof(DSCACHE));<br/>		MathCopy(&lpChaveCache-&gtmnAnoMes, &lpDS-&gtmnAnoMes);<br/>		MathCopy(&lpChaveCache-&gtmnNivelFilho, &lpDS-&gtmnNivelFilho);<br/>		//<br/>		jdeCacheReturn = jdeCacheFetchPosition(hCache, hCursor,<br/>											  (void *)lpChaveCache,<br/>                                              (short)2,<br/>                                              (void *)&dsRegistroCache,<br/>                                              sizeof(dsRegistroCache));<br/>		//<br/>		I570861A_PopulaParametros(dsRegistroCache, lpDS);<br/>		//<br/>		if (jdeCacheReturn == JDECM_PASSED) {<br/>			//<br/>			if (lpDS-&gtcSegueBusca != _J('S'))<br/>			{<br/>				jdeCacheCloseCursor(hCache, hCursor);<br/>			}<br/>			else<br/>			{<br/>				if (lpDS-&gtidCache == (ID)0)<br/>				{<br/>					lpDS-&gtidCache = jdeStoreDataPtr(hUser, (void *)hCursor);<br/>	                if (lpDS-&gtidCache == (ID)0)<br/>					{<br/>						jdeCacheCloseCursor(hCache, hCursor);<br/>					}<br/>				}<br/>			}<br/>			//<br/>		} else {<br/>			//<br/>	        jdeCacheCloseCursor(hCache, hCursor);<br/>  	        if (lpDS-&gtidCache != (ID)0)<br/>			{<br/>				jdeRemoveDataPtr(hUser, lpDS-&gtidCache);<br/>	            lpDS-&gtidCache = (ID)0;<br/>		    }	<br/>	    }<br/>		//<br/>	} else {<br/>		//seta erro<br/>	}<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hUser)<br/>    {<br/>		JDB_FreeBhvr(hUser);<br/>    }<br/>    return (ER_SUCCESS);<br/>}<br/><br/><br/>/**************************************************************************<br/> *  Business Function:  ProximoRegistroCache<br/> *<br/> *        Description:  Proximo Registro Cache F570861<br/> *<br/> *         Parameters:<br/> *           LPBHVRCOM           lpBhvrCom    Business Function Communications<br/> *           LPVOID              lpVoid       Void Parameter - DO NOT USE!<br/> *           LPDSD570810C        lpDS         Parameter Data Structure Pointer  <br/> *<br/> *************************************************************************/<br/><br/>JDEBFRTN (ID) JDEBFWINAPI ProximoRegistroCacheF570861 (LPBHVRCOM lpBhvrCom, LPVOID lpVoid, LPDSD570861 lpDS)  <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>	HUSER						 hUser					   = (HUSER)NULL;<br/>	HCACHE						 hCache					   = (HCACHE)NULL;<br/>	HJDECURSOR				     hCursor				   = (HJDECURSOR)NULL;<br/>	ID                           idJDEDBReturn             = ER_SUCCESS;<br/>	DSCACHE                      dsRegistroCache           = {0};<br/>	JDECM_RESULT			     jdeCacheReturn			   = JDECM_PASSED;<br/>   /************************************************************************<br/>    * Check for NULL pointers<br/>    ************************************************************************/<br/>    if ((lpBhvrCom == (LPBHVRCOM) NULL) ||<br/>       (lpVoid    == (LPVOID)    NULL) ||<br/>       (lpDS      == (LPDSD570861)	NULL))<br/>    {<br/>      jdeErrorSet (lpBhvrCom, lpVoid, (ID) 0, _J("4363"), (LPVOID) NULL);<br/>      return ER_ERROR;<br/>    }<br/> 	//<br/>    idJDEDBReturn = JDB_InitBhvr(lpBhvrCom, &hUser, (JCHAR *) NULL,<br/> 	                             JDEDB_COMMIT_AUTO);<br/>	//<br/> 	if (idJDEDBReturn == JDEDB_FAILED)<br/>	{<br/>      jdeSetGBRError ( lpBhvrCom, lpVoid, (ID)0, _J("3143"));<br/>      return ER_ERROR;<br/>	}<br/>	//<br/>   /************************************************************************<br/>    * Main Processing<br/>    ************************************************************************/<br/>	if (I570861A_IniciaCache(hUser, &hCache, lpDS-&gtszNomeCache) != 0) {<br/>		return ER_ERROR;<br/>	}<br/>	if (I570861A_PegaCursorCache(hUser, hCache, &hCursor, lpDS-&gtidCache, FALSE) == 0) {<br/>		//<br/>		memset((void *)&dsRegistroCache, (int)_J('\0'), sizeof(dsRegistroCache));<br/>		//<br/>		jdeCacheReturn = jdeCacheFetch(hCache, hCursor, (void *)&dsRegistroCache, (void *)NULL);<br/>		//		<br/>		if (jdeCacheReturn == JDECM_PASSED && (MathCompare(&lpDS-&gtmnNivelFilho, &dsRegistroCache.mnNivelFilho) ==0)) {<br/>			//<br/>			I570861A_PopulaParametros(dsRegistroCache, lpDS);<br/>			//<br/>			if (lpDS-&gtcSegueBusca != _J('S'))<br/>			{<br/>				jdeCacheCloseCursor(hCache, hCursor);<br/>			}<br/>			else<br/>			{<br/>				if (lpDS-&gtidCache == (ID)0)<br/>				{<br/>					lpDS-&gtidCache = jdeStoreDataPtr(hUser, (void *)hCursor);<br/>	                if (lpDS-&gtidCache == (ID)0)<br/>					{<br/>						jdeCacheCloseCursor(hCache, hCursor);<br/>					}<br/>				}<br/>			}<br/>			//<br/>		} else {<br/>			//<br/>	        jdeCacheCloseCursor(hCache, hCursor);<br/>  	        if (lpDS-&gtidCache != (ID)0)<br/>			{<br/>				jdeRemoveDataPtr(hUser, lpDS-&gtidCache);<br/>	            lpDS-&gtidCache = (ID)0;<br/>		    }	<br/>	    }<br/>		//<br/>	}<br/>   /************************************************************************<br/>    * Function Clean Up<br/>    ************************************************************************/<br/>	if (hUser)<br/>    {<br/>		JDB_FreeBhvr(hUser);<br/>    }<br/>    return (ER_SUCCESS);<br/>}<br/>//<br/>/***************************************************************************<br/> *							 Funções Internas							   *<br/> ***************************************************************************/<br/>int I570861A_IniciaCache(HUSER Usuario, HCACHE *lpCache, JCHAR *Nome)<br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>    JDECMINDEXSTRUCT     dsCacheIndex[2];<br/>    DSCACHE              dsCache;<br/>    JCHAR                 szNomeCache[40];  <br/>    //<br/>   /************************************************************************<br/>    *  Processing<br/>    ************************************************************************/<br/>	//<br/>    jdeStrcpy((JCHAR*)(szNomeCache), (const JCHAR *)_J("B570861A-"));<br/>    jdeStrcat((JCHAR*)(szNomeCache), (const JCHAR *)(Nome));<br/>	//<br/>	dsCacheIndex[0].nKeyID = 1;<br/>    dsCacheIndex[0].nNumSegments = 5;<br/>    dsCacheIndex[0].CacheKey[0].nOffset = offsetof(DSCACHE_KEY,mnAnoMes);<br/>    dsCacheIndex[0].CacheKey[0].nSize = sizeof(dsCache.mnAnoMes);<br/>    dsCacheIndex[0].CacheKey[0].idDataType = EVDT_MATH_NUMERIC;<br/>    dsCacheIndex[0].CacheKey[1].nOffset = offsetof(DSCACHE_KEY,szUnidade);<br/>    dsCacheIndex[0].CacheKey[1].nSize = sizeof(dsCache.szUnidade);<br/>    dsCacheIndex[0].CacheKey[1].idDataType = EVDT_STRING;<br/>    dsCacheIndex[0].CacheKey[2].nOffset = offsetof(DSCACHE_KEY,szOrigem);<br/>    dsCacheIndex[0].CacheKey[2].nSize = sizeof(dsCache.szOrigem);<br/>    dsCacheIndex[0].CacheKey[2].idDataType = EVDT_STRING;<br/>    dsCacheIndex[0].CacheKey[3].nOffset = offsetof(DSCACHE_KEY,mnNivelPai);<br/>    dsCacheIndex[0].CacheKey[3].nSize  = sizeof(dsCache.mnNivelPai);<br/>    dsCacheIndex[0].CacheKey[3].idDataType = EVDT_MATH_NUMERIC;<br/>    dsCacheIndex[0].CacheKey[4].nOffset = offsetof(DSCACHE_KEY,mnNivelFilho);<br/>    dsCacheIndex[0].CacheKey[4].nSize  = sizeof(dsCache.mnNivelFilho);<br/>    dsCacheIndex[0].CacheKey[4].idDataType = EVDT_MATH_NUMERIC;<br/>    //   <br/>	dsCacheIndex[1].nKeyID = 2;<br/>    dsCacheIndex[1].nNumSegments = 2;<br/>    dsCacheIndex[1].CacheKey[0].nOffset = offsetof(DSCACHE_KEY,mnAnoMes);<br/>    dsCacheIndex[1].CacheKey[0].nSize = sizeof(dsCache.mnAnoMes);<br/>    dsCacheIndex[1].CacheKey[0].idDataType = EVDT_MATH_NUMERIC;<br/>    dsCacheIndex[1].CacheKey[1].nOffset = offsetof(DSCACHE_KEY,mnNivelFilho);<br/>    dsCacheIndex[1].CacheKey[1].nSize  = sizeof(dsCache.mnNivelFilho);<br/>    dsCacheIndex[1].CacheKey[1].idDataType = EVDT_MATH_NUMERIC;<br/>	//<br/>    if (jdeCacheInitMultipleIndex(Usuario, lpCache, szNomeCache, dsCacheIndex, 2) != JDECM_PASSED)<br/>    {<br/>	   //<br/>       return 1;<br/>	   //<br/>    } else {<br/>	   //<br/>	   return 0;<br/>	   //<br/>    }<br/>    //<br/>}<br/>//<br/>void I570861A_PopulaRegistroCache(DSCACHE *RegistroCache, F570861 Registro)<br/>{<br/>	MathCopy(&RegistroCache-&gtmnAnoMes, &Registro.ftanmesent);<br/>	jdeStrncpyTerminate(RegistroCache-&gtszUnidade, Registro.ftunid1, DIM(Registro.ftunid1));<br/>	jdeStrncpyTerminate(RegistroCache-&gtszOrigem, Registro.ftcup, DIM(Registro.ftcup));<br/>	MathCopy(&RegistroCache-&gtmnNivelPai, &Registro.ftnivp);<br/>	MathCopy(&RegistroCache-&gtmnNivelFilho, &Registro.ftnivc);<br/>	jdeStrncpyTerminate(RegistroCache-&gtszQualificador, Registro.ftcoddes, DIM(Registro.ftcoddes));<br/>}<br/>//<br/>void I570861A_PopulaParametros(DSCACHE RegistroCache, LPDSD570861 Parametros)<br/>{<br/>	MathCopy(&Parametros-&gtmnAnoMes, &RegistroCache.mnAnoMes);<br/>	jdeStrncpyTerminate(Parametros-&gtszUnidade, RegistroCache.szUnidade, DIM(RegistroCache.szUnidade));<br/>	jdeStrncpyTerminate(Parametros-&gtszOrigem, RegistroCache.szOrigem, DIM(RegistroCache.szOrigem));<br/>	MathCopy(&Parametros-&gtmnNivelPai, &RegistroCache.mnNivelPai);<br/>	MathCopy(&Parametros-&gtmnNivelFilho, &RegistroCache.mnNivelFilho);<br/>	jdeStrncpyTerminate(Parametros-&gtszQualificador, RegistroCache.szQualificador, DIM(RegistroCache.szQualificador));<br/>}<br/>//<br/>int I570861A_PegaCursorCache(HUSER hUser, HCACHE hCache, HJDECURSOR *Cursor, long int idCursor, BOOL bResetCursor) <br/>{<br/>   /************************************************************************<br/>    *  Variable declarations<br/>    ************************************************************************/<br/>    JDECM_RESULT      jdeCacheReturn       = JDECM_PASSED;<br/>   /************************************************************************<br/>    *  Processing<br/>    ************************************************************************/<br/>    if (idCursor != (ID)0)<br/>	{<br/>	  //<br/>      *Cursor = jdeRetrieveDataPtr(hUser, idCursor);<br/>      // <br/>      if (*Cursor == (HJDECURSOR)NULL) {<br/>		  return 1; <br/>      } else {<br/>         if (bResetCursor) {<br/>            jdeCacheReturn = jdeCacheResetCursor(hCache, *Cursor);<br/>			if (jdeCacheReturn == JDECM_PASSED) {<br/>				return 0;<br/>			} else {<br/>				return 1;<br/>			}<br/>         } else {<br/>			 return 0;<br/>		 }<br/>      }<br/>    } else {<br/>       if(jdeCacheGetNumRecords(hCache) &gt (long int)0) {<br/>          jdeCacheReturn = jdeCacheOpenCursor(hCache, Cursor);<br/>		  if (jdeCacheReturn == JDECM_PASSED) {<br/>			  return 0;<br/>		  } else {<br/>		 	  return 1;<br/>		  }<br/>       } else {<br/>          return 1;<br/>       }<br/>    }   <br/>}<br/></pre></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: Cache F570861 - [InicializaCacheF570861]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570861 - Estrutura de Dados da Função B570861A                       </B><BR>BF szNomeCache [AA12]<BR>BF mnAnoMes [ANMESENT]<BR>BF szUnidade [UNID1]<BR>BF szOrigem [CUP]<BR>BF mnNivelPai [NIVP]<BR>BF mnNivelFilho [NIVC]<BR>BF nNumChaves [CIP]<BR>BF idCache [GENLNG]<BR>BF cSegueBusca [EV01]<BR>BF szQualificador [CODDES]<BR></div></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: Cache F570861 - [PesquisaCacheF570861]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570861 - Estrutura de Dados da Função B570861A                       </B><BR>BF szNomeCache [AA12]<BR>BF mnAnoMes [ANMESENT]<BR>BF szUnidade [UNID1]<BR>BF szOrigem [CUP]<BR>BF mnNivelPai [NIVP]<BR>BF mnNivelFilho [NIVC]<BR>BF nNumChaves [CIP]<BR>BF idCache [GENLNG]<BR>BF cSegueBusca [EV01]<BR>BF szQualificador [CODDES]<BR></div></div></div><div class='section'>EVENTS<div class='objectheader'>C Function: Cache F570861 - [ProximoRegistroCacheF570861]</div><div class='er'><div class='dstrmembers'><B>Data Structure: D570861 - Estrutura de Dados da Função B570861A                       </B><BR>BF szNomeCache [AA12]<BR>BF mnAnoMes [ANMESENT]<BR>BF szUnidade [UNID1]<BR>BF szOrigem [CUP]<BR>BF mnNivelPai [NIVP]<BR>BF mnNivelFilho [NIVC]<BR>BF nNumChaves [CIP]<BR>BF idCache [GENLNG]<BR>BF cSegueBusca [EV01]<BR>BF szQualificador [CODDES]<BR></div></div></div></body></html>