<!DOCTYPE html><html lang = "en"><head><meta charset = "utf-8"><meta name = "viewport" content = "width=device-width, initial-scale=1"><title>JDE Object Browser HTML Extract</title>
<style type='text/css'>body,th{font-family: Courier New, Courier, mono;font-size: 12px; width:auto}
.section{font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width: 100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.objectheader {font-family: Arial, Helvetica, sans-serif;font-size: 12px;font-weight: bold;border: thin groove #CC9966;width:auto;background-color: #FFFFCC;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.details{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:100%;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px;box-sizing: border-box }
.er {background-color: #FFFFFF;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal; border: thin solid #CCCCCC; width:auto; padding-left: 5px;padding-top: 5px;padding-bottom: 5px; padding-right: 5px; box-sizing: border-box }
.dstrmembers {background-color: #FFFDDD;font-family: Courier New, Courier, mono;font-size: 12px;border: thin groove #CC9966;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; box-sizing: border-box }
.disabled {font-family: Courier New, Courier, mono;font-size: 12px;	font-style: italic; color:#CC9933}
.parameters {font-family: Courier New, Courier, mono;font-size: 12px; color:#3333FF}
.comment {font-family: Courier New, Courier, mono;font-size: 12px;	color: #339933}
.subtable {font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;width:100%}
.lineno {color:#6E6E6E;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.iokey {color:#FF6905;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.logicline {color:#000000;font-family: Courier New, Courier, mono;font-size: 12px; font-weight: normal;}
.versionoverride {background-color: #FFCC99;}
.overrideflags{font-family: Arial, Helvetica, sans-serif;font-size: 11px;font-weight: normal;border: thin groove #CC9966;width:auto;padding-left: 5px;padding-top: 5px;padding-bottom: 5px;padding-right: 5px; background-color: #FFCC99; box-sizing: border-box }
.bsfnprops {font-family: Courier New, Courier, mono;font-size: 12px; color:#E01B4C}
.searchresult {font-family: Courier New, Courier, mono;font-size: 12px; font-weight: bold; background-color:#8BF3A0}
.expand {font-family: Courier New, Courier, mono;font-size: 11px; font-weight: bold; cursor:pointer; border: 1px solid gray; position: relative; left: -3px; display:inline; line-height:8px;}
.expand2 { display:inline; cursor:pointer; font-size: 9px; border: 1px solid gray; position: relative; left: -3px;}
</style>
<script type='text/javascript'>function load(){location.href = '#result';}</script>
<script language='JavaScript' type='text/javascript'>function ExpandCollapse(ElementId){ var ClickedElement = document.getElementById(ElementId); var SectionName = ElementId + ':hide'; var Section = document.getElementById(SectionName); if (ClickedElement.innerHTML == '-') { 	 ClickedElement.innerHTML = '+';	Section.style.display = 'none'; }  else  { 		ClickedElement.innerHTML = '-'; 	Section.style.display = 'inline';}} </script>
<base target = "_parent"></head><body onload='load()'>
<div class ='objectheader'>Business Function: N5576B12 - Converte um TXT para um XML com base num template<BR>Function Type: NER</div><div class='section'>EVENTS<div class='objectheader'>NER: ConverteTXTparaXML <BR>Event GUID: 0a32225b-860b-4b4e-a106-0fd95060abe7</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576B12 - Converte um TXT para um XML com base num template           </B><BR>BF cSeparador [AA01]<BR>BF szModelo [WSTPVAL]<BR>BF szTXT [JOBTEXT]<BR>BF szXML [XMLCMPST]<BR>BF szMsgErr [BSSVERR]<BR></div>----------------------------------------</BR>Event Level Variables</BR>----------------------------------------</BR>evt_cBlank [AA01]<br>evt_mnZero [UKID]<br>evt_szEndOfRec [AA02]<br>evt_mnXMLPosAnt [IA07]<br>evt_mnTMPSegAnt [UKID]<br>evt_mnTMPSegAtu [UKID]<br>evt_szRetCpo [CNLS]<br>evt_mnPosFin [IA07]<br>evt_mnTam [IA07]<br>evt_mnUm [UKID]<br>evt_mnTMPPosAnt [IA07]<br>evt_szTMPTag [UKTAG5]<br>evt_szTMPTagPai [ASID]<br>evt_szOpenTag [TYPT]<br>evt_szCloseTag [TYPT]<br>evt_szOpenEndTag [AA02]<br>evt_szTXTTipReg [TTYPE]<br>evt_szTMPTipReg [TTYPE]<br>evt_mnTXTPosAnt [IA07]<br>evt_szTMPTagTipo [TSTS]<br>evt_szAttrTag [TSTS]<br>evt_mnDois [UKID]<br>evt_mnTXTPosIni [IA05]<br>evt_mnTXTSegAnt [UKID]<br>evt_mnTXTSegAtu [UKID]<br>evt_szXMLReg [XMLCMPST]<br>evt_szChave [UKTAG5]<br>evt_mnTMPPosIni [IA05]<br>evt_szXMLRegEnd [XMLCMPST]<br>evt_mnLength [IA07]<br>evt_szAttrOpen [AA02]<br>evt_mnTMPQtdCol [IA05]<br>evt_cAttrClose [AA01]<br>evt_szTXTReg [TXVC]<br>evt_szTMPReg [TXVC]<br>evt_szBlank [DTA1]<br>evt_cNull [EV01]<br>evt_cCharAux [AA01]<br>----------------------------------------</BR><span class='comment'>  //</span><span class='comment'><br>  // Se BF MsgErro is equal to or empty &#60;Blank&#62;, então, conversão para XML ok</span><span class='comment'><br>  // Se BF Separador is equal to or empty &#60;Blank&#62;, então, assume o pipe ("|")</span><span class='comment'><br>  //</span><br>  VA evt_szBlank [DTA1] = &#60;Blank&#62;<br> <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:6' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If BF szModelo [WSTPVAL] is equal to or empty VA evt_szBlank [DTA1]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:6:hide' style='display: inline;'><span class='comment'><br>       // Sem template, não faz nada</span><br>       BF szMsgErr [BSSVERR] = "#O Modelo não foi informado"</div><br> <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:9' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:9:hide' style='display: inline;'><br>      <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:10' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If BF szTXT [JOBTEXT] is equal to or empty VA evt_szBlank [DTA1]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:10:hide' style='display: inline;'><span class='comment'><br>            // Sem TXT, não faz nada</span><br>            BF szMsgErr [BSSVERR] = "#O TXT não foi informado"</div><br>      <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:13' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:13:hide' style='display: inline;'><span class='comment'><br>            // monta o VA evt_szAttrOpen com =", pois dá erro ao atribuir " a uma string</span><span class='comment'><br>            // obs.: atribuir " (aspas duplas) a um char não dá problema</span><br>            VA evt_cAttrClose [AA01] = """<br>            VA evt_szAttrOpen [AA02] = "="<br>            VA evt_szAttrOpen [AA02] = concat([VA evt_szAttrOpen [AA02]], [VA evt_cAttrClose [AA01]])<br>            VA evt_szAttrTag [TSTS] = "A"<span class='comment'><br>            //</span><br>            VA evt_cNull [EV01] = &#60;NULL&#62;<br>            VA evt_cBlank [AA01] = &#60;Blank&#62;<br>            VA evt_mnZero [UKID] = "0"<br>            VA evt_mnUm [UKID] = "1"<br>            VA evt_mnDois [UKID] = "2"<br>            VA evt_szOpenTag [TYPT] = "&#60;"<br>            VA evt_szOpenEndTag [AA02] = "&#60;/"<br>            VA evt_szCloseTag [TYPT] = "&#62;"<br>            VA evt_szEndOfRec [AA02] = "}{"<span class='comment'><br>            //</span><br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:31' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If BF cSeparador [AA01] is equal to or empty VA evt_cBlank [AA01]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:31:hide' style='display: inline;'><br>                 BF cSeparador [AA01] = "|"</div><br>            End If<span class='comment'><br>            //</span><span class='comment'><br>            // busca o primeiro registro do Template para ver se é "0", que é a tagRaiz</span><br>            VA evt_mnTMPPosAnt [IA07] = VA evt_mnZero [UKID]<span class='comment'><br>            // busca o primeiro EndOfRec ("}{") do BF szModelo</span><br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:38' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:38:hide' style='display: inline;'><span class='parameters'><br>                 BF szModelo [WSTPVAL] -&#62; szSourceString [TXVC]<br>                 VA evt_szEndOfRec [AA02] -&#62; szStringToFind [TXVC]<br>                 VA evt_mnTMPPosAnt [IA07] -&#62; mnStartingPosition [IA07]<br>                 VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                 VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                 VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                 VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><br>            VA evt_szTMPReg [TXVC] = substr([BF szModelo [WSTPVAL]], [VA evt_mnZero [UKID]], [VA evt_mnPosFin [IA07]])<br>            VA evt_mnTMPPosAnt [IA07] = VA evt_mnPosFin [IA07]<span class='comment'><br>            //</span><span class='comment'><br>            // busca a Versão do template para verificar versão do TXT</span><br>            VA evt_mnTMPPosIni [IA05] = VA evt_mnZero [UKID]<br>            VA evt_mnTMPSegAnt [UKID] = VA evt_mnZero [UKID]<br>            VA evt_mnTMPSegAtu [UKID] = VA evt_mnZero [UKID]<br>            VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:47' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:47:hide' style='display: inline;'><span class='parameters'><br>                 BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                 VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                 VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                 VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                 VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                 VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                 VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><span class='comment'><br>            //</span><span class='comment'><br>            // verifica se encontra a Versão do template no TXT</span><br>            VA evt_szRetCpo [CNLS] = concat([BF cSeparador [AA01]], [VA evt_szRetCpo [CNLS]])<br>            VA evt_szRetCpo [CNLS] = concat([VA evt_szRetCpo [CNLS]], [BF cSeparador [AA01]])<br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:52' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:52:hide' style='display: inline;'><span class='parameters'><br>                 BF szTXT [JOBTEXT] -&#62; szSourceString [TXVC]<br>                 VA evt_szRetCpo [CNLS] -&#62; szStringToFind [TXVC]<br>                 VA evt_mnZero [UKID] -&#62; mnStartingPosition [IA07]<br>                 VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                 VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                 VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                 VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><span class='comment'><br>            //</span><br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:54' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_mnPosFin [IA07] is less than VA evt_mnZero [UKID]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:54:hide' style='display: inline;'><span class='comment'><br>                 // A versão do TXT é incompatível com versão do Modelo</span><br>                 BF szMsgErr [BSSVERR] = "#A versão do TXT é incompatível com versão do Modelo"</div><br>           <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:57' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:57:hide' style='display: inline;'><span class='comment'><br>                 // busca o TipReg para verificar se é o "0", tagRaiz</span><br>                 VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:60' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:60:hide' style='display: inline;'><span class='parameters'><br>                      BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                      VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                      VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                      VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                      VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                      VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                      VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                 VA evt_szTMPTipReg [TTYPE] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                 //</span><br>                 VA evt_szTXTTipReg [TTYPE] = "0"<br>                <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:64' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTipReg [TTYPE] is equal to VA evt_szTXTTipReg [TTYPE]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:64:hide' style='display: inline;'><span class='comment'><br>                      // o primeiro registro é o "0", ou seja, é a tagRaiz, então carrega no XML</span><span class='comment'><br>                      //</span><span class='comment'><br>                      // guarda a tag para incluir a endTag</span><br>                      VA evt_mnTMPSegAtu [UKID] = "3"<br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:70' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:70:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_szTMPTag [UKTAG5] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca a máscara do registro do Template, que é a tagRaiz do XML</span><br>                      VA evt_mnTMPSegAtu [UKID] = "6"<br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:76' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:76:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      BF szXML [XMLCMPST] = VA evt_szRetCpo [CNLS]<br>                      VA evt_mnXMLPosAnt [IA07] = length([BF szXML [XMLCMPST]])<span class='comment'><br>                      //</span><span class='comment'><br>                      // montar a endTag</span><br>                      BF szXML [XMLCMPST] = concat([BF szXML [XMLCMPST]], [VA evt_szOpenEndTag [AA02]])<br>                      BF szXML [XMLCMPST] = concat([BF szXML [XMLCMPST]], [VA evt_szTMPTag [UKTAG5]])<br>                      BF szXML [XMLCMPST] = concat([BF szXML [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                 End If<span class='comment'><br>                 //</span><span class='comment'><br>                 // ===========================================================================</span><span class='comment'><br>                 // Loop para tratar os registros desse TXT, ié, não varre todo o template</span><span class='comment'><br>                 // busca o primeiro registro do TXT</span><br>                 VA evt_mnTXTPosAnt [IA07] = VA evt_mnZero [UKID]<span class='comment'><br>                 // busca o primeiro EndOfRec ("}{") do BF szTXT</span><br>                <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:91' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:91:hide' style='display: inline;'><span class='parameters'><br>                      BF szTXT [JOBTEXT] -&#62; szSourceString [TXVC]<br>                      VA evt_szEndOfRec [AA02] -&#62; szStringToFind [TXVC]<br>                      VA evt_mnTXTPosAnt [IA07] -&#62; mnStartingPosition [IA07]<br>                      VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                      VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                      VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                      VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><span class='comment'><br>                 // a bsfn devolve VA evt_mnPosFin = -1, quando não encontrar o registro</span><br>                <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:93' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>While VA evt_mnPosFin [IA07] is greater than VA evt_mnZero [UKID]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:93:hide' style='display: inline;'><span class='comment'><br>                      //</span><span class='comment'><br>                      // carrega o TXTreg (valores) a ser expandido</span><br>                      VA evt_mnTam [IA07] = [VA evt_mnPosFin [IA07]]-[VA evt_mnTXTPosAnt [IA07]]<br>                      VA evt_szTXTReg [TXVC] = substr([BF szTXT [JOBTEXT]], [VA evt_mnTXTPosAnt [IA07]], [VA evt_mnTam [IA07]])<span class='comment'><br>                      // Já avança dois, para pular o EndOfRec ("}{")</span><br>                      VA evt_mnTXTPosAnt [IA07] = [VA evt_mnPosFin [IA07]]+[VA evt_mnDois [UKID]]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca o tipReg no TXTReg</span><br>                      VA evt_mnTXTPosIni [IA05] = VA evt_mnZero [UKID]<br>                      VA evt_mnTXTSegAnt [UKID] = VA evt_mnZero [UKID]<br>                      VA evt_mnTXTSegAtu [UKID] = VA evt_mnZero [UKID]<br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:106' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:106:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTXTPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTXTReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTXTSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTXTSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_szTXTTipReg [TTYPE] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                      //</span><span class='comment'><br>                      // ===========================================================================</span><span class='comment'><br>                      // carrega o TMPReg (cabeçalhos) ref ao TXTTipReg, p/ex: "}{A|", "}{N10a|"</span><br>                      VA evt_szChave [UKTAG5] = concat([VA evt_szEndOfRec [AA02]], [VA evt_szTXTTipReg [TTYPE]])<br>                      VA evt_szChave [UKTAG5] = concat([VA evt_szChave [UKTAG5]], [BF cSeparador [AA01]])<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:113' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:113:hide' style='display: inline;'><span class='parameters'><br>                           BF szModelo [WSTPVAL] -&#62; szSourceString [TXVC]<br>                           VA evt_szChave [UKTAG5] -&#62; szStringToFind [TXVC]<br>                           VA evt_mnZero [UKID] -&#62; mnStartingPosition [IA07]<br>                           VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                           VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                           VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                           VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><br>                      VA evt_mnTMPPosAnt [IA07] = [VA evt_mnPosFin [IA07]]+[VA evt_mnDois [UKID]]<span class='comment'><br>                      // busca o próximo EndOfRec ("}{") do BF szModelo</span><br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:116' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:116:hide' style='display: inline;'><span class='parameters'><br>                           BF szModelo [WSTPVAL] -&#62; szSourceString [TXVC]<br>                           VA evt_szEndOfRec [AA02] -&#62; szStringToFind [TXVC]<br>                           VA evt_mnTMPPosAnt [IA07] -&#62; mnStartingPosition [IA07]<br>                           VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                           VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                           VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                           VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><br>                      VA evt_mnTam [IA07] = [VA evt_mnPosFin [IA07]]-[VA evt_mnTMPPosAnt [IA07]]<br>                      VA evt_szTMPReg [TXVC] = substr([BF szModelo [WSTPVAL]], [VA evt_mnTMPPosAnt [IA07]], [VA evt_mnTam [IA07]])<span class='comment'><br>                      // Não avança dois, pois precisa do EndOfRec ("}{") para pesquisar o szTMPRec</span><br>                      VA evt_mnTMPPosAnt [IA07] = VA evt_mnPosFin [IA07]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca a tagPai para saber onde incluir o registro no XML</span><br>                      VA evt_mnTMPPosIni [IA05] = VA evt_mnZero [UKID]<br>                      VA evt_mnTMPSegAnt [UKID] = VA evt_mnZero [UKID]<br>                      VA evt_mnTMPSegAtu [UKID] = VA evt_mnUm [UKID]<br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:127' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:127:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_szTMPTagPai [ASID] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca a tag para substituir a tipReg e incluir a endTag</span><br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:132' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:132:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_szTMPTag [UKTAG5] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca a tagTip (Atributo, Elemento, ...)</span><br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:137' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:137:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_szTMPTagTipo [TSTS] = VA evt_szRetCpo [CNLS]<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca a QtdCol</span><br>                      VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:142' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:142:hide' style='display: inline;'><span class='parameters'><br>                           BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                           VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                           VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                           VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                           VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                           VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                           VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><br>                      VA evt_mnTMPQtdCol [IA05] = [VA evt_szRetCpo [CNLS]]<span class='comment'><br>                      //</span><br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:145' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is equal to ("CE","E")<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:145:hide' style='display: inline;'><span class='comment'><br>                           // é um campo que está separado no TXT e deve ser incluído num outro registro</span><span class='comment'><br>                           // nesse caso, não gera as tags de grupo e incluirá pela OpenTag do grupo</span><br>                           VA evt_szXMLReg [XMLCMPST] = &#60;NULL&#62;</div><br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:149' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:149:hide' style='display: inline;'><span class='comment'><br>                           // substituir o tipReg (A, B, ...) pela respectiva tag (infNFe, ide, ...)</span><span class='comment'><br>                           // montar a Tag de abertura desse registro</span><br>                           VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szOpenTag [TYPT]], [VA evt_szTMPTag [UKTAG5]])<br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:153' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is not equal to("A","AE")<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:153:hide' style='display: inline;'><span class='comment'><br>                                // Elementos</span><br>                                VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                           End If</div><br>                      End If<span class='comment'><br>                      //</span><span class='comment'><br>                      // ===========================================================================</span><span class='comment'><br>                      // Loop para montar as tag dos campos</span><br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:161' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>While VA evt_mnTMPQtdCol [IA05] is greater than VA evt_mnZero [UKID]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:161:hide' style='display: inline;'><span class='comment'><br>                           //</span><span class='comment'><br>                           // Busca o conteúdo da tag no TXT</span><br>                           VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:165' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:165:hide' style='display: inline;'><span class='parameters'><br>                                BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                                VA evt_mnTXTPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                                VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                                VA evt_szRetCpo [CNLS] &#60;- szConteudo_CNLS [CNLS]<br>                                VA evt_szTXTReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                                VA evt_mnTXTSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                                VA evt_mnTXTSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><span class='comment'><br>                           //</span><span class='comment'><br>                           //</span><span class='comment'><br>                           // Busca o título da tag no Template</span><br>                           VA evt_szBlank [DTA1] = &#60;Blank&#62;<br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:170' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>BuscaCampoRegistro(N55760Z1.BuscaCampoRegistro)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:170:hide' style='display: inline;'><span class='parameters'><br>                                BF cSeparador [AA01] -&#62; cSeparador_EV01 [EV01]<br>                                VA evt_mnTMPPosIni [IA05] &#60;&#62; mnPosicaoInicial_IA05 [IA05]<br>                                VA evt_szBlank [DTA1] &#60;&#62; szCampo_DTA1 [DTA1]<br>                                VA evt_szChave [UKTAG5] &#60;- szConteudo_CNLS [CNLS]<br>                                VA evt_szTMPReg [TXVC] -&#62; szRegistro_TXVC [TXVC]<br>                                VA evt_mnTMPSegAtu [UKID] &#60;&#62; mnSegmento_UKID [UKID]<br>                                VA evt_mnTMPSegAnt [UKID] &#60;&#62; mnUltimoSegmento_UKID [UKID]</span></div><span class='comment'><br>                           //</span><br>                           VA evt_cCharAux [AA01] = substr([VA evt_szChave [UKTAG5]], [VA evt_mnZero [UKID]], [VA evt_mnUm [UKID]])<span class='comment'><br>                           //</span><span class='comment'><br>                           // tag iniciada com * indica que é obrigatória, mesmo que nula (idEstrangeiro)</span><br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:175' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szRetCpo [CNLS] is equal to or empty "@"<br>                           And VA evt_cCharAux [AA01] is not equal to "*"<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:175:hide' style='display: inline;'><span class='comment'><br>                                // não carrega uma tag nula e não obrigatória</span></div><br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:177' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:177:hide' style='display: inline;'><br>                               <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:178' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szRetCpo [CNLS] is equal to or empty "@"<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:178:hide' style='display: inline;'><br>                                     VA evt_szRetCpo [CNLS] = &#60;NULL&#62;</div><br>                                End If<br>                               <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:181' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_cCharAux [AA01] is equal to "*"<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:181:hide' style='display: inline;'><span class='comment'><br>                                     // retira o * do início da tag</span><br>                                     VA evt_mnLength [IA07] = length([VA evt_szChave [UKTAG5]])<br>                                     VA evt_mnLength [IA07] = [VA evt_mnLength [IA07]]-[VA evt_mnUm [UKID]]<br>                                     VA evt_szChave [UKTAG5] = substr([VA evt_szChave [UKTAG5]], [VA evt_mnUm [UKID]], [VA evt_mnLength [IA07]])</div><br>                                End If<span class='comment'><br>                                //</span><br>                               <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:188' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is equal to ("A","AE")<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:188:hide' style='display: inline;'><span class='comment'><br>                                     // Atributos</span><br>                                    <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:190' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_mnTXTSegAtu [UKID] is greater than VA evt_mnUm [UKID]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:190:hide' style='display: inline;'><br>                                          VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_cBlank [AA01]])</div><br>                                     End If<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szChave [UKTAG5]])<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szAttrOpen [AA02]])<span class='comment'><br>                                     //</span><br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szRetCpo [CNLS]])<span class='comment'><br>                                     //</span><br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_cAttrClose [AA01]])</div><br>                               <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:199' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>Else<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:199:hide' style='display: inline;'><span class='comment'><br>                                     // Elementos</span><br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szOpenTag [TYPT]])<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szChave [UKTAG5]])<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])<span class='comment'><br>                                     //</span><br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szRetCpo [CNLS]])<span class='comment'><br>                                     //</span><br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szOpenEndTag [AA02]])<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szChave [UKTAG5]])<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                                End If<span class='comment'><br>                                //</span><br>                               <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:212' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is equal to "AE"<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:212:hide' style='display: inline;'><br>                                     VA evt_szTMPTagTipo [TSTS] = "G"<br>                                     VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                                End If<span class='comment'><br>                                //</span></div><br>                           End If<span class='comment'><br>                           //</span><br>                           VA evt_mnTMPQtdCol [IA05] = [VA evt_mnTMPQtdCol [IA05]]-[VA evt_mnUm [UKID]]<span class='comment'><br>                           //</span></div><br>                      End While<span class='comment'><br>                      //</span><br>                      VA evt_szChave [UKTAG5] = concat([VA evt_szCloseTag [TYPT]], [VA evt_szOpenTag [TYPT]])<br>                      VA evt_szChave [UKTAG5] = concat([VA evt_szChave [UKTAG5]], [VA evt_szTMPTagPai [ASID]])<br>                      VA evt_szChave [UKTAG5] = concat([VA evt_szChave [UKTAG5]], [VA evt_szCloseTag [TYPT]])<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:226' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:226:hide' style='display: inline;'><span class='parameters'><br>                           BF szXML [XMLCMPST] -&#62; szSourceString [TXVC]<br>                           VA evt_szChave [UKTAG5] -&#62; szStringToFind [TXVC]<br>                           VA evt_mnZero [UKID] -&#62; mnStartingPosition [IA07]<br>                           VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                           "-1" -&#62; mnOccurrence [IA07]<br>                           VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                           VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><br>                      VA evt_mnPosFin [IA07] = [VA evt_mnPosFin [IA07]]+[VA evt_mnUm [UKID]]<br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:228' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is not equal to("CE","E")<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:228:hide' style='display: inline;'><span class='comment'><br>                           // montar a endTag</span><br>                          <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:230' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If VA evt_szTMPTagTipo [TSTS] is equal to ("A","AE")<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:230:hide' style='display: inline;'><span class='comment'><br>                                // Fecha a tag com Atributos</span><br>                                VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                           End If<br>                           VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szOpenEndTag [AA02]])<br>                           VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szTMPTag [UKTAG5]])<br>                           VA evt_szXMLReg [XMLCMPST] = concat([VA evt_szXMLReg [XMLCMPST]], [VA evt_szCloseTag [TYPT]])</div><br>                      End If<span class='comment'><br>                      //</span><span class='comment'><br>                      // guarda a parte final do XML na XMLRegEnd</span><br>                      VA evt_mnLength [IA07] = length([BF szXML [XMLCMPST]])<br>                      VA evt_mnTam [IA07] = [VA evt_mnLength [IA07]]-[VA evt_mnPosFin [IA07]]<br>                      VA evt_szXMLRegEnd [XMLCMPST] = substr([BF szXML [XMLCMPST]], [VA evt_mnPosFin [IA07]], [VA evt_mnTam [IA07]])<span class='comment'><br>                      //</span><span class='comment'><br>                      // fica só com a parte inicial do XML</span><br>                      BF szXML [XMLCMPST] = substr([BF szXML [XMLCMPST]], [VA evt_mnZero [UKID]], [VA evt_mnPosFin [IA07]])<span class='comment'><br>                      //</span><span class='comment'><br>                      // coloca o XMLReg no final do XML</span><br>                      BF szXML [XMLCMPST] = concat([BF szXML [XMLCMPST]], [VA evt_szXMLReg [XMLCMPST]])<span class='comment'><br>                      //</span><span class='comment'><br>                      // coloca o XMLRegEnd no final do XML</span><br>                      BF szXML [XMLCMPST] = concat([BF szXML [XMLCMPST]], [VA evt_szXMLRegEnd [XMLCMPST]])<span class='comment'><br>                      //</span><span class='comment'><br>                      // busca o próximo EndOfRec ("}{") do BF szTXT</span><br>                     <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:254' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>FindStringPositionInString(N55760Z1.FindStringPositionInString)<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:254:hide' style='display: inline;'><span class='parameters'><br>                           BF szTXT [JOBTEXT] -&#62; szSourceString [TXVC]<br>                           VA evt_szEndOfRec [AA02] -&#62; szStringToFind [TXVC]<br>                           VA evt_mnTXTPosAnt [IA07] -&#62; mnStartingPosition [IA07]<br>                           VA evt_mnZero [UKID] -&#62; mnStoppingPosition [IA07]<br>                           VA evt_mnUm [UKID] -&#62; mnOccurrence [IA07]<br>                           VA evt_cNull [EV01] -&#62; cNotCaseSensitive [EV01]<br>                           VA evt_mnPosFin [IA07] &#60;- mnPositionFound [IA07]</span></div><span class='comment'><br>                      // a bsfn devolve VA evt_mnPosFin = -1, quando não encontrar o registro</span></div><br>                 End While<span class='comment'><br>                 //</span></div><br>            End If<span class='comment'><br>            //</span></div><br>       End If<span class='comment'><br>       //</span></div><br>  End If<span class='comment'><br>  //</span><br>  VA evt_szBlank [DTA1] = &#60;Blank&#62;<br> <div id='0a32225b-860b-4b4e-a106-0fd95060abe7:265' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If BF szXML [XMLCMPST] is equal to or empty VA evt_szBlank [DTA1]<div id='0a32225b-860b-4b4e-a106-0fd95060abe7:265:hide' style='display: inline;'><span class='comment'><br>       // O TXT não fio convertido para XML</span><br>       BF szMsgErr [BSSVERR] = concat("#O TXT não foi convertido para XML", [BF szMsgErr [BSSVERR]])</div><br>  End If<span class='comment'><br>  //</span></div></div><div class='section'>EVENTS<div class='objectheader'>NER: MontaLinhaTemplateXML <BR>Event GUID: c93ceb6f-ec79-4539-bed2-2ecd74c7cf11</div><div class='er'><div class='dstrmembers'><B>Data Structure: D5576B11 - Monta a linha do template de conversão para XML             </B><BR>BF szCodModelo [XMLVERS]<BR>BF szModelo [WSTPVAL]<BR>BF cSeparador [AA01]<BR></div>----------------------------------------</BR>Event Level Variables</BR>----------------------------------------</BR>evt_szSeparador [TYPT]<br>evt_szTagVer [SPHD]<br>evt_szVersao [DL02]<br>evt_szTipReg [TTYPE]<br>evt_szTagPai [ASID]<br>evt_szTag [UKTAG5]<br>evt_szTipTag [TSTS]<br>evt_mnQtdCols [UKTAG6]<br>evt_szTmpReg [VTEXT]<br>evt_szEndOfRec [AA02]<br>evt_cBlank [EV01]<br>----------------------------------------</BR><span class='comment'>  //</span><br>  VA evt_cBlank [EV01] = &#60;Blank&#62;<br>  VA evt_szEndOfRec [AA02] = "}{"<span class='comment'><br>  //</span><br> <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:5' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>GetUDC(X0005.GetUDC)<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:5:hide' style='display: inline;'><span class='parameters'><br>       "55" -&#62; szSystemCode [SY]<br>       "XT" -&#62; szRecordTypeCode [RT]<br>       BF szCodModelo [XMLVERS] -&#62; szUserDefinedCode [KY]<br>       VA evt_szVersao [DL02] &#60;- szDescription002 [DL02]<br>       VA evt_szTagVer [SPHD] &#60;- szSpecialHandlingCode [SPHD]</span></div><span class='comment'><br>  //</span><br>  VA evt_szSeparador [TYPT] = substr([VA evt_szTagVer [SPHD]], "0", "1")<br>  BF cSeparador [AA01] = [VA evt_szSeparador [TYPT]]<br> <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:9' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>If BF cSeparador [AA01] is equal to or empty VA evt_cBlank [EV01]<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:9:hide' style='display: inline;'><br>       BF cSeparador [AA01] = "|"<br>       VA evt_szSeparador [TYPT] = "|"</div><br>  End If<span class='comment'><br>  //</span><br>  VA evt_szTagVer [SPHD] = substr([VA evt_szTagVer [SPHD]], "1", "9")<br>  VA evt_szVersao [DL02] = rtrim([VA evt_szVersao [DL02]], [VA evt_cBlank [EV01]])<span class='comment'><br>  //</span><br>  BF szModelo [WSTPVAL] = concat([VA evt_szVersao [DL02]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>  //</span><br> <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:19' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>F5576B12.Select  [Index 1: XMLVersion,Sequence]<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:19:hide' style='display: inline;'><br>       <span class='iokey'>BF szCodModelo [XMLVERS] = TK XML Version [XMLVERS]</span></div><br> <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:20' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>F5576B12.FetchNext  [Index 1: XMLVersion,Sequence]<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:20:hide' style='display: inline;'><br>       VA evt_szTipReg [TTYPE] &#60;- TK Type [TTYPE]<br>       VA evt_szTagPai [ASID] &#60;- TK Serial Number [ASID]<br>       VA evt_szTag [UKTAG5] &#60;- TK Tag 5 String 2/30 [UKTAG5]<br>       VA evt_szTipTag [TSTS] &#60;- TK Tag Status [TSTS]<br>       VA evt_mnQtdCols [UKTAG6] &#60;- TK Tag 6 String 9/3 [UKTAG6]<br>       VA evt_szTmpReg [VTEXT] &#60;- TK Variable Length Text [VTEXT]</div><br> <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:21' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>While SV File_IO_Status is equal to CO SUCCESS<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:21:hide' style='display: inline;'><span class='comment'><br>       //</span><br>       VA evt_szTipReg [TTYPE] = rtrim([VA evt_szTipReg [TTYPE]], [VA evt_cBlank [EV01]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szTipReg [TTYPE]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>       //</span><br>       VA evt_szTagPai [ASID] = rtrim([VA evt_szTagPai [ASID]], [VA evt_cBlank [EV01]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szTagPai [ASID]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>       //</span><br>       VA evt_szTag [UKTAG5] = rtrim([VA evt_szTag [UKTAG5]], [VA evt_cBlank [EV01]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szTag [UKTAG5]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>       //</span><br>       VA evt_szTipTag [TSTS] = rtrim([VA evt_szTipTag [TSTS]], [VA evt_cBlank [EV01]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szTipTag [TSTS]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>       //</span><br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_mnQtdCols [UKTAG6]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szSeparador [TYPT]])<span class='comment'><br>       //</span><br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szTmpReg [VTEXT]])<br>       BF szModelo [WSTPVAL] = concat([BF szModelo [WSTPVAL]], [VA evt_szEndOfRec [AA02]])<span class='comment'><br>       //</span><br>      <div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:45' class='expand2' onclick='ExpandCollapse(this.id);'>-</div>F5576B12.FetchNext  [Index 1: XMLVersion,Sequence]<div id='c93ceb6f-ec79-4539-bed2-2ecd74c7cf11:45:hide' style='display: inline;'><br>            VA evt_szTipReg [TTYPE] &#60;- TK Type [TTYPE]<br>            VA evt_szTagPai [ASID] &#60;- TK Serial Number [ASID]<br>            VA evt_szTag [UKTAG5] &#60;- TK Tag 5 String 2/30 [UKTAG5]<br>            VA evt_szTipTag [TSTS] &#60;- TK Tag Status [TSTS]<br>            VA evt_mnQtdCols [UKTAG6] &#60;- TK Tag 6 String 9/3 [UKTAG6]<br>            VA evt_szTmpReg [VTEXT] &#60;- TK Variable Length Text [VTEXT]</div><span class='comment'><br>       //</span></div><br>  End While<span class='comment'><br>  //</span></div></div></body></html>